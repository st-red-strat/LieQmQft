\section{量子力学の基礎}

量子力学に特徴的な事は、
物理量が単なる数ではなくHilbert空間に作用する
非可換なoperator（演算子、作用素）となる事である。
観測可能な量はHermitian operatorとなるので、
我々はoperatorとして専らlinearな
Hermitianないしunitary operatorを扱う。

\subsection{正準量子化}

\subsubsection{Hilbert空間とOperator}

量子力学に現れるoperator $O$とは、
写像$O: \mathcal{H} \to \mathcal{H}$
すなわち
ある複素vector space $\mathcal{H}$の
元$\ket{\psi}$に作用して
再びvector space の元
$O\ket{\psi} \in \mathcal{H}$
を与えるものである。
例えばidentity operator（恒等演算子、単位演算子）$1$は
任意のvector $\ket{\psi}$に対し
\begin{align}
    1 \ket{\psi} = \ket{\psi}
\end{align}
を与える。

あるoperator $O$が$\mathcal{H}$にlinearに作用している、
あるいはlinearである、とは
\begin{align}
    \text{ For }
        \forall \ket{\psi_1}, \ket{\psi_2}
        \in \mathcal{H}
    \text{ and }
        \forall a,b\in \mathbb{C}
    ,\qquad
        O\Big(
            a \ket{\psi_1}
            +
            b \ket{\psi_2}
        \Big)
    =
        a O \ket{\psi_1}
        +
        b O \ket{\psi_2}
\label{linearity of an operator}
\end{align}
であることを言い、
代数学の言葉では
$\hat{ \mathcal{O} } \in \mathrm{End}(\mathcal{H})
= \mathrm{Hom}(\mathcal{H}, \mathcal{H}) $
あるいは
$
    \xymatrix{
        \mathcal{H}
        \ar@(ul,dl)
        []_{ \hat{\mathcal{O}} }
    }
$
などと書く（$\mathrm{End}, \mathrm{Hom}$はそれぞれ
endomorphism（自己準同型）とhomomorphism（準同型）の意）。
例えば時間反転操作に対応するoperator $T$は
anti-unitary (anti-linearかつunitary)
\begin{align}
    \text{ For }
        \forall \ket{\psi_1}, \ket{\psi_2}
        \in \mathcal{H}
    \text{ and }
        \forall a,b\in \mathbb{C}
    ,\qquad
        T\Big(
            a \ket{\psi_1}
            +
            b \ket{\psi_2}
        \Big)
    =
        a^* T \ket{\psi_1}
        +
        b^* T \ket{\psi_2}
\end{align}
なoperatorの重要な例であるが、
以下では専らlinearなものに話を限る。

量子力学では物理量はoperatorで表され、
解析力学で基本的な力学自由度であった
$\{q\},\{p\}$
さえもoperatorとなっている。
我々は任意の観測量の時間発展が決定論的な
物理法則によって記述されることを仮定するが、
一方で直接観測される量はもちろん実数であるので、
まずはこれらの観測量を
$\{\hat{q}\},\{\hat{p}\}$
のようなoperatorと関係付ける方法を考えなければならない。
以下ではこの方法を
Hilbert空間と呼ばれるvector spaceを用いて与えよう。

内積空間の定義を
\ref{subsubsec: inner product}
で与えた。
Hilbert空間とは内積空間であって完備な
（直感的には、極限が十分に存在する）
ものを言う。
物理学において時間発展は微分方程式で与えられるので、
微分を定義するために
極限が存在する必要があるのである。

量子力学において決定論的な時間発展方程式に従う力学自由度は
Hilbert空間の元である。
このHilbert空間を状態空間と言い、
その元を状態vectorと呼ぶ。
個々の状態vectorの
時間発展はSchr\"odinger方程式
\begin{align}
    i\hbar \dfrac{d}{dt}
        \ket{\psi(t)}
&=
    \hat{H} \ket{\psi(t)}
\label{time dependent Schrodinger eq}
\end{align}
によって与えられる。
ここで$\hbar$は換算Planck定数またはDirac定数と呼ばれ、
Planck定数$h$により
\begin{align}
    \hbar := \dfrac{h}{2\pi}
\end{align}
と定義されるが、
$\hbar$も$h$も共にPlanck定数と呼ぶことも多い。
また、
$\hat{H}$は以下で定義する
Hamiltonian operatorである。

Hamiltonian $\hat{H}$が
時刻$t$に顕わに依存（explicitly dependent）
しないとき、
初期条件$\ket{ \psi(t_0) }$のもとでの
Schr\"odinger方程式
(\ref{time dependent Schrodinger eq})
の一般解は
時間発展（time evolution）operator
\begin{align}
    \hat{U}(t;t')
    :=
    \exp\left(
        \dfrac{1}{i \hbar}
        \int_{t'}^{t}dt
        \hat{H}
    \right)
    =
    \exp\left(
        \dfrac{t - t'}{i \hbar}
        \hat{H}
    \right)
\label{time evolution operator}
\end{align}
を使って
\begin{align}
    \ket{ \psi(t) }
    =
    \hat{U} (t;t_0)
    \ket{ \psi(t_0) }
\label{time dependent solution for Schrodinger eq}
\end{align}
と書ける。

\subsubsection{正準交換関係（CCR: Canonical Commutation Relation）}
\label{subsubsec: CCR}

二つのoperator $\hat{A}, \hat{B}$の間の交換関係を
\begin{align}
    [\hat{A}, \hat{B}] := \hat{A} \hat{B} - \hat{B} \hat{A}
\end{align}
で定義し、$[\hat{A}, \hat{B}] = 0$であるとき
$\hat{A}, \hat{B}$は交換する、または可換であるという。
全く同様に反交換を
\begin{align}
    \{\hat{A}, \hat{B}\} := \hat{A} \hat{B} + \hat{B} \hat{A}
\end{align}
で定義しておく。
量子力学を考えるまで、
あらゆる量は可換であった。
このように全ての量が可換である力学系を
古典力学系と言い、そこに現れる可換な数を$c$-数という。

任意の関数$F(a)$について、
演算子$\hat{x}$の関数$F(\hat{x})$を
（$a=0$周りの）Taylor展開により
\begin{align}
    F(\hat{x}) := \sum_{n=0}^\infty
        \dfrac{1}{n!}
        \dfrac{d^nF(a)}{da^n}\bigg|_{a=0}
        \hat{x}^n
\label{function of operator}
\end{align}
と定義する。
ある古典力学系のHamiltonian $H(\{q\},\{p\})$
が知られているとき、
その正準力学変数$\{q\},\{p\}$を
正準交換関係：
\begin{align}
    [ \hat{q}_i , \hat{p}_j ] = i\hbar \delta_{ij}
\end{align}
を満たすoperatorの組
$ \{\hat{q}\} , \{\hat{p}\} $
で置き換える手続きを正準量子化と呼び、
\begin{align}
    \hat{H}
    &:=
    H(\{\hat{q}\} , \{\hat{p}\})
\end{align}
を得られた量子力学系の
Hamiltonian operator
という。

厳密にはこれだけでは古典的Hamiltonian $H$が
例えば$qp$のような項を持っていたとき、それを
$\hat{p}\hat{q}$で置き換えるのか
$\hat{q}\hat{p} = \hat{p}\hat{q} + i\hbar$で置き換えるのか
といった問題は残る。
これを演算子順序の問題といい、
Hamiltonian operatorのHermiticityや
量子系の持つべき大域的対称性などから
一定の解答を与えることは出来るものの、
異なる演算子順序は物理的に異なる量子系を与えるため
一般に与えられた古典系に対して量子系を一意に定めることは出来ない。
ただし特定の文脈で自然な演算子順序は存在し、
このことは経路積分を扱う際により詳しく議論する。

\subsubsection{ObservablesとHermitian conjugate、Unitary operator}

任意のvector $\ket{\psi} \in \mathcal{H}$の
Hermitian conjugate（エルミート共役） $\ket{\psi}^\dagger$を
内積を使って
\begin{align}
    \ket{\psi}^\dagger
    :=
    \eta(\ket{\psi},\ )
\label{bra vector}
\end{align}
により定め、$\bra{\psi}$とも書く。
元の空間の任意の元
$\ket{\phi} \in \mathcal{H}$
との内積が
\begin{align}
    \ket{\psi}^\dagger \ket{\phi}
    :=
    \braket{\psi|\phi}
    = \eta(\ket{\psi}, \ket{\phi})
    \in \mathbb{C}
\end{align}
のように複素数を与えるため、
内積の線形性から
$\bra{\psi}$は$\mathcal{H}$上の
線形汎関数と見做すことが出来、
Riesz representation theoremから
$\bra{\psi}$のなす集合
$\mathcal{H}^* = \mathrm{Hom} (\mathcal{H}, \mathbb{C})$
は
$\mathcal{H}$の（位相的あるいは線形）双対空間となる。
Hilbert空間の元$\ket{\psi}$をket vector、
その双対空間の元$\bra{\psi}$をbra vectorという。

この定義の下でoperator $\hat{O}$の
Hermitian conjugate $\hat{O}^\dagger$も、
任意のvector $\ket{\psi}, \ket{\phi}$に対して
\begin{align}
    \bra{\psi}
    \hat{O}^\dagger
    \ket{\phi}
    =
    \ket{\psi}^\dagger
    \hat{O}^\dagger
    \ket{\phi}
    &:=
    \Big( \hat{O} \ket{\psi} \Big)^\dagger
    \ket{\phi}
    =
    \Big[
        \bra{\phi} \Big( \hat{O} \ket{\psi} \Big)
    \Big]^*
\end{align}
となるoperatorと定めることが出来る。
このようなoperatorが一意的に存在することも
Riesz representation theoremから保証される。

あるoperator $\hat{O}$が
Hermitian（自己共役、自己随伴）であるとは、
$\hat{O}$が
\begin{align}
    \hat{O} = \hat{O}^\dagger
\end{align}
を満たすことを言う。
量子力学におけるobservable（可換測量）は、
Hermitian operator で表される。

あるoperator $\hat{O}$の
inverse operator（逆演算子、逆作用素）
$\hat{O}^{-1}$
を
\begin{align}
    \hat{O}^{-1} \hat{O} \ket{\psi} &= \ket{\psi}
    \quad\text{for $\forall \ket{\psi}$}
\end{align}
で定義する。
あるoperator $\hat{U}$がunitaryであるとは、
$ \hat{U}^\dagger = \hat{U}^{-1} $
すなわち
\begin{align}
    \hat{U}^\dagger \hat{U} \ket{\psi} &= \ket{\psi}
    \quad\text{for $\forall \ket{\psi}$}
\label{unitary operator}
\end{align}
が成り立つことを言う。
一般にHermitian operator $\hat{O} = \hat{O}^\dagger$に対し
$\exp( i a \hat{O})$（ただし$a \in \mathbb{R}$）はunitaryであり、
例えば、時間発展operator
(\ref{time evolution operator})
はunitary operatorの代表的な例である。

\subsubsection{離散spectrumの固有状態とHermitian operator}

Operatorはvectorに作用して
再びvectorを与えるので、
ある$\hat{O}$に対し
$\ket{\psi} \neq 0$が存在して
\begin{align}
    \hat{O}\ket{\psi} \propto \ket{\psi}
,\quad\text{
    i.e.
    $\exists \lambda\in\mathbb{C}$
    s.t.
}\quad
    \hat{O}\ket{\psi} = \lambda \ket{\psi}
\end{align}
となる特別な状況を考えることが出来る。
このとき、定数$\lambda$を$\ket{\psi}$の固有値（eigenvalue）、
その集合を点spectrumと呼び、
状態vector $\ket{\psi}$は
$\hat{O}$の固有値$\lambda$に属する
固有vectorまたは
固有状態（eigenstate）であると言う。
また、上の等式を固有方程式（特性方程式、永年方程式とも）という。
例えば、Hamiltonianの固有値$E_n$に属する
固有vector $\ket{n}$の時間発展
(\ref{time dependent solution for Schrodinger eq})
は
\begin{align}
    \hat{U}(t_i + t, t_i) \ket{n}
    =
    \exp\left(
        \dfrac{t}{i\hbar} E_n
    \right)
    \ket{n}
\end{align}
と与えられ、
自分自身の位相倍となることが分かる。
特に、あとで
(\ref{complete set of operator eigen vectors})
で議論するように
\begin{align}
    1 = \sum_n \ket{n} \bra{n}
\end{align}
が成り立つので、
任意のvector $\ket{\psi}$を初期条件とする時間発展は
\begin{align}
    \ket{\psi(t)}
    :=
    \hat{U}(t_i + t, t_i)
    \ket{\psi}
    =
    \sum_n \ket{n}
    \exp\left(
        \dfrac{t}{i\hbar} E_n
    \right)
    \braket{ n | \psi }
\label{eigen decomposition of time independent solution}
\end{align}
で与えられることが分かる。
ただしもちろん、この公式を使うためには
全てのenergy固有vectorを求める必要がある。

ある固有値$\lambda$に属する線形独立な
固有vectorが$n$個あるとき
$n$を$\lambda$の縮退度（degeneracy、古くは縮重とも）と呼び、
$n = 1$ならば縮退がない（non-degenerate）、
$n \ge 2$ならば$n$重縮退がある（n-fold degenerate）という。
固有値$\lambda$に属する固有vectorの集合は
vector spaceを為し、これを固有値$\lambda$に対する
固有空間という。

我々が特に興味があるのはobservableを表す
Hermitian operatorであるが、
$\hat{O} = \hat{O}^\dagger$のとき
$\lambda$が実数となること
\begin{align}
    \lambda \braket{\psi | \psi}
    =
    \bra{\psi} \hat{O} \ket{\psi}
    &= \bra{\psi} \hat{O}^\dagger \ket{\psi}
    = \left[ \bra{\psi} \hat{O} \ket{\psi}\right]^*
    = \lambda^* \braket{\psi | \psi}
\notag\\
    \lambda &= \lambda^*
    \quad
    (\ 
        \because
        \ket{\psi} \neq 0
    \ 
    )
\end{align}
および異なる固有値
$\lambda \neq \theta$
に属する固有vector
\begin{align}
    \hat{O} \ket{\psi} = \lambda \ket{\psi}
&,\quad
    \hat{O} \ket{\phi} = \theta \ket{\phi}
\end{align}
が直交すること
\begin{align}
    \lambda
    \braket{\psi|\phi}
    =
    \lambda^*
    \braket{\phi|\psi}^*
    =
    \left[
        \bra{\phi} \hat{O} \ket{\psi}
    \right]^*
    &= \bra{\psi} \hat{O}^\dagger \ket{\phi}
    = \bra{\psi} \hat{O} \ket{\phi}
    = \theta \braket{\psi|\phi}
\notag\\\therefore
    \braket{\psi|\phi}
    &=\braket{\psi|\phi}
    =0
\label{physically distinct states}
\end{align}
が示される。
例えば
$\hat{H}$の固有状態をenergy固有状態、
energy固有状態が持つ固有値をenergyというが、
任意のenergyは実数である。
また、特に最低energyに対応する固有vector
$\ket{0} \neq 0$は
真空（vacuum）または基底状態、
それ以外のenergy固有状態は励起状態（excited state）というが、
真空と励起状態とは直交する。

\subsubsection{連続spectrumの「固有状態」}

与えられたoperatorが連続spectrum（連続固有値）を持つ場合、
数学的には上の意味での固有vectorを定義できない。
Gelfand triple（Gelfandの$3$つ組）
とか呼ばれるものを用いれば
形式的に「連続固有値に対応する固有vector」を正当化することも可能だが、
この場合にはHilbert空間とその双対空間に対応が付かなくなり、
与えられたket vectorに対して
(\ref{bra vector})のようにbra vectorを与えることも一般には出来なくなる。
以下ではGelfand tripleなど使わずにあたかも
連続spectrumの「固有状態」が存在するかのように扱うが、
数学的にはspectral decomposition
(\ref{projection operator for continuous spectrum})
の意味で解釈する。

\subsubsection{同時固有状態}

互いに可換な$n$個のoperator
$\hat{A}_1, \hat{A}_2, \dots, \hat{A}_n$
と、固有値$\lambda_i$に属する
$\hat{A}_i$の固有vector $\ket{\psi} \neq 0$
があるとしよう。
可換性$[\hat{A}_i, \hat{A}_j] = 0$から
\begin{align}
    \lambda_i \hat{A}_j \ket{\psi}
    &=
    \hat{A}_j \lambda_i \ket{\psi}
    =
    \hat{A}_j \hat{A}_i \ket{\psi}
    =
    \hat{A}_i \hat{A}_j \ket{\psi}
\end{align}
となるが、この式は
$\hat{A}_j \ket{\psi}$
が再び$\hat{A}_i$の固有値$\lambda_i$に対する
固有空間の元である事を意味する。
特に、縮退がない場合は
ある固有値
$\lambda_i$に属するvectorが定数倍を除いて一意に定まるため、
$\hat{A}_j \ket{\psi}$も
$\ket{\psi}$に比例しているはずである。
すなわち、$\ket{\psi}$は$\hat{A}_i$だけでなく
$\hat{A}_j$の固有vectorにもなっている。
$\lambda_i$に$m$重縮退がある場合でも、
固有空間の基底
$\ket{\psi_1}, \ket{\psi_2}, \dots, \ket{\psi_m}$
を適切に取ることにより
やはり全ての$\ket{\psi_k}$が
$\hat{A}_j$の固有vectorにもなるよう出来る事が示される
（ただし、$k$ごとに$\hat{A}_j$の固有値は
異なってよい）。

このように互いに可換なoperatorのうち一方の固有vectorが
同時に他方の固有vectorとなるように出来、
そのようなvectorを同時（simultaneous）固有vectorという。

\subsubsection{観測値とOperatorの関係、状態vectorの命名規則、物理的状態空間}

ここまで抽象的な状態vectorと
実際に観測される物理量との関係については
一切説明していない。
ここで初めてそれらの関係を与えよう。
量子力学的な物理系の状態が
vector $\ket{\psi}$
で表されているとき、
物理量$\hat{A}$の期待値は
\begin{align}
    \braket{A} :=
    \dfrac{
        \bra{\psi} \hat{A} \ket{\psi}
    }{
        \braket{\psi|\psi}
    }
\end{align}
と表される。
ここで言う期待値や確率とは、
同一の状態（どのようなときに同一と見做すかは後述）
を無数に集めて物理量の測定実験を繰り返したとき、
そのうちどれだけの割合でどのような測定結果が得られるか、という意味である。
\footnote{
    測定をたった1回だけ行い
    「確率いくらでどのような値が得られた」
    と主張する事に意味はないだろう。
    量子力学の枠組みはそのような単発の測定については何も語らない。
}
$\hat{A}$のspectral decompositionを
連続spectrum と点spectrum に分け、
対応するspectrumの固有空間への
projection operator $\hat{P}$を用いて
\begin{align}
    \hat{A} &=
    \sum_n { \hat{P}_n a_n }
    +
    \int d \hat{P} (a) a
\end{align}
のように書くと、
identity operatorとの関係
（これを完全性関係という）
\begin{align}
    1 =
    \sum_n \hat{P}_n
    +
    \int d \hat{P} (a)
\label{spectral decomposition of identity}
\end{align}
を用いて
\begin{align}
    \ket{\psi} =
    \sum_n \hat{P}_n \ket{\psi}
    +
    \int d \hat{P} (a) \ket{\psi}
\end{align}
が成り立つ。
実際に観測される結果は演算子$\hat{A}$の
固有値のいずれかであり、
全く同一の状態 vector $\ket{\psi}$で表される物理系を
十分多く用意したときの観測値は
\begin{enumerate}
    \item{点spectrum $a_n$が確率
    $
    \dfrac{
        \bra{\psi} \hat{P}_n \ket{\psi}
    }{
     \braket{\psi|\psi}
    }
    $}
    \item{連続spectrum $a$が確率密度
    $
    \dfrac{
        \bra{\psi} d \hat{P}(a) \ket{\psi}
    }{
     \braket{\psi|\psi}
    }
    $}
\end{enumerate}
で与えられるのである。

これらの規則を見ると、状態vector $\ket{\psi}$を
定数（たとえば$a \in \mathbb{C}$）倍だけ
再定義
$\ket{\psi} \mapsto a \ket{\psi}$
してもnormが伴って
$\braket{\psi|\psi} \mapsto |a|^2 \braket{\psi|\psi}$
と変化するため、
物理法則が予言する個々の観測量の期待値や確率は
一切変化しない事に気付くであろう。
実際vectorのnormは物理的情報を持っておらず、
従ってvector $\ket{\psi}$と$a \ket{\psi}$は
物理的に区別されるべき異なる状態ではない。
よって常に
$a = \dfrac{1}{\sqrt{ \braket{\psi|\psi} }}$
による再定義で$\braket{\psi|\psi} = 1$
としておくのが便利である。
このようなvectorの再定義を規格化（normalization）と言い、
以下では状態vectorは規格化されているものとする。
状態vectorを規格化してもなお、
$a=e^{i\theta}, \theta\in \mathbb{R}$
のような場合は$\ket{\psi}$と
$e^{i\theta}\ket{\psi}$は
独立な状態を表さない。
このようなoverallの位相も物理的情報を持たない
（もちろん複数のvectorの相対的な位相は意味を持つが）ため、
物理的状態は単にHilbert空間の元ではなく、
それらを規格化し、更に位相だけの違いは同一視した
射線（ray）と呼ばれるobjectにより表される。

物理的に区別できないvectorについて上のように述べたが、
更に我々は任意のoperatorについて同じ固有値を持つvectorは
どのような物理量ないし実験によっても区別できないため全く同一の状態と見做す。
量子力学の黎明期には
「実は我々が気付いていないだけで、
これらの状態は物理的に異なりうるのだ」
とするhidden variable theoryに基づき
Einstein-Podolsky-Rosen(EPR) paradoxなどが提案された事もあるが、
Aspect（アラン・アスペ）の実験などで
Bell inequalityの破れが実証されたことにより
hidden variable theoryは今では明確に否定されている。

物理的に明確に区別できる
（つまりあるHermitian operatorについて
異なる固有値を持つ）
状態を表す状態vector
は互いに直交する事を
(\ref{physically distinct states})
で示した。
一般にある量子系において、
線形独立なHermitian operatorのうち
可換に取れるもののmaximalな個数が$n$であるとき、
そのようなoperator
$\hat{O}_1,\hat{O}_2,\dots,\hat{O}_n$
の同時固有vectorは
（どのoperatorについて議論しているのか明らかな場合には）対応する固有値
$\lambda_1, \lambda_2, \dots , \lambda_n$を用いて
$\ket{\lambda_1, \lambda_2, \dots , \lambda_n}$
と名付けるのが普通であり、
このvectorに対応するrayが
（互いに独立な）物理的状態を表すのである。
連続spectrumに対しては前述の通り固有vectorは存在しないが、
後述のように
(\ref{projection operator for continuous spectrum})
にて類似の記法の正当化を与える。

改めてrayの集合を物理的状態空間あるいは単に状態空間（state space）
と呼ぶことにしよう。
ある物理的状態とそれを表すrayまたは状態vectorも区別せず、
これら全てを単に状態と呼ぶことにする。
以下で規格化などによる同一視を行わないHilbert空間を直接扱うことはなく、
そのため議論にvectorのnormが関わることもないので、
以前の用語との混乱は生じない。

\subsubsection{DiracのBracket記法と連続固有状態の規格化}

これまでは$\ket{\psi}$のような記号を
単に状態vectorを表すものと扱っていたが、
Diracはこれを更に便利にする記法を導入した。
$\hat{A}$の固有値$a_n$に対する
固有vectorを$\ket{a_n}$と略記し、
固有空間に$m$重縮退がある場合には
適当な正規直交基底$\ket{a_n,i}(i=1,\dots,m)$を取る。
ここで、対応する固有空間へのprojection operatorを
\begin{align}
    \hat{P}_n &=: \sum_{i=1}^m \ket{a_n,i}\bra{a_n,i}
\\
    d \hat{P}(a) &=: da \ket{a}\bra{a}
\label{projection operator for continuous spectrum}
\end{align}
のように書くというのである。
前述の通り数学的には連続spectrumに対して固有vectorは存在しないが、
上は単にspectral decompositionの略記法だと思えばよい。
点spetrumと連続spectrumとを形式的に区別せずに書けるため、
物理学者には非常に重宝がられている記法である。

この記法を用いると、ある
点spectrum $a_n$
または
連続spectrum $a$
が観測される確率または確率密度は
\begin{subequations}
\begin{align}
    \bra{ \psi }
        \hat{P}_n
    \ket{ \psi }
    &=
    \sum_i
    \braket{ \psi | a_n, i }
    \braket{ a_n, i | \psi }
    =
    \sum_i
    \bigg|
        \braket{ a_n, i | \psi }
    \bigg|^2
\\
    \bra{ \psi }
        d \hat{P}
    \ket{ \psi }
    &=
    d a
    \braket{ \psi | a }
    \braket{ a | \psi }
    =
    d a
    \Big|
        \braket{ a | \psi }
    \Big|^2
\label{probability density for continuous spectrum}
\end{align}
\end{subequations}
と書ける。
連続に分布する実数の中から
ある一つの値を選び出す確率は
常に$0$であることに注意しよう。
従って連続spectrumの中から
ちょうど実数$a$だけが観測される確率も$0$であり、
(\ref{probability density for continuous spectrum})
における$da$は区間$(a, a + da)$に含まれる
いずれかの実数が観測される確率、
の意で解釈するべきである。

$\braket{ a_n | \psi },
\braket{ a | \psi }$の様な量を
確率振幅（probability amplitude）と呼ぶ。
一般にあるoperator $\hat{A}$の
固有状態$\ket{a}$は
対応する固有値$a$を確率$1$で与えるが、
例えば$\hat{A}$が
Hamiltionian operator $\hat{H}$と
交換しない場合や、
交換するHamiltonianに対してであっても
摂動が加わった場合などは、
対応する固有値$a$が得られる確率は時間発展と共に
$1$から変化していく。
これは$\ket{a}$を初期条件とする
Schr\"odinger方程式
(\ref{time dependent Schrodinger eq})の解
$\ket{\psi_a(t)}$が
再び$\hat{A}$の固有値$a$に属する固有状態になるとは限らないからで、
この場合は時刻$t$に固有値$a'$が観測される確率は
$\Big| \braket{ a' | \psi_a(t) } \Big|^2$
で与えられる。
これは物理的には$a$に属する固有状態$\ket{a}$が
時間発展によって別の固有値$a'$に属する
固有状態$\ket{a'}$に遷移する確率
（遷移確率、transition probability）と
解釈することが出来、
従ってこの文脈では
$\braket{ a' | \psi_a(t) }$を
遷移振幅（transition amplitude）と呼ぶ。

なお、連続spectrumに属する固有状態は一般にnormが有限でないが、
この場合は異なる固有値$x, y$に属する
固有状態$\ket{x}, \ket{y}$の内積が
\begin{align}
    \braket{x|y} = \delta(x-y)
\label{continuous spectrum normalization}
\end{align}
である事を指して規格化されていると言うことにする。
ただし、ここに現れたDirac delta関数はもちろん
(\ref{projection operator for continuous spectrum})に現れる
spectral measureのもとで積分して$1$を与えるようなものである。

\subsubsection{Hermitian operatorと完全性}

内積空間において、規格化されたvector
$\ket{e_1},\ket{e_2},\dots$
が互いに直交する
\begin{align}
    \braket{e_i | e_j} &= \delta_{ij}
\end{align}
場合、その集合を正規直交系（orthonormal system）という。
vectorが必ずしも規格化されていない場合は単に直交系(normal system)という。
あるHilbert空間$\mathcal{H}$の
互いに線形独立な元による正規直交系
$\ket{e_1},\ket{e_2},\dots$を取る。
任意のvector
$\ket{\psi} \in \mathcal{H}$が
\begin{align}
    \ket{\psi}
    &=\sum_n c_n \ket{e_n}
\end{align}
のように一意的に展開できる場合、
$\ket{e_n}$の集合を$\mathcal{H}$の
正規直交完全系（CONS、orthonormal complete set）
または正規直交基底という。
正規直交性から
\begin{align}
    c_n &=
    \sum_m c_m \delta_{nm}
    =\sum_m c_m \braket{e_n|e_m}
    = \bra{e_n} \sum_m c_m \ket{e_m}
    = \braket{e_n | \psi}
\end{align}
が従うため、上の式は
\begin{align}
    \ket{\psi}
    &=\sum_n \ket{e_n} \braket{e_n | \psi}
    \quad\text{for $\forall \ket{\psi}$}
\notag\\
\therefore
    1
    &=
    \sum _n \ket{e_n}\bra{e_n}
\end{align}
と書いても同じことである。
ここで$1$はidentity operatorを意味する。
等式はnormに関する収束
\begin{subequations}
\begin{align}
    &\lim_{N\to\infty}\bigg|\bigg|
        \ket{\psi} - \ket{\psi_N}
    \bigg|\bigg|^2
    = 0
\label{convergence of norm}
\\
    &\ket{\psi_N}
    :=
    \sum_{n=1}^N \ket{e_n} \braket{e_n | \psi}
\end{align}
\end{subequations}
を意味している。
完全系はvector spaceの基底の概念によく似ているが、
基底には必要ない内積という付加的な構造を定義に用いており、
特にvector spaceの基底は$n$について有限和しか許さないのに対し、
完全系は$n$についての無限和も許している点で相違している。

あるoperator $\hat{O}$のtraceは、
正規直交完全系$\ket{e_n}$を用い
\begin{align}
    \tr\ \hat{O}
    &:=
    \sum_n\bra{e_n} \hat{O} \ket{e_n}
\end{align}
で定義される。
適当な条件の下で、
この量は正規直交完全系の選び方によらない。
また、同様の条件の下で
traceの巡回性（cyclicality）
\begin{align}
    \tr\left(
        \hat{A}\hat{B}
    \right)
    =
    \tr\left(
        \hat{B}\hat{A}
    \right)
\end{align}
が成り立つ。

適当なHermitian operator
$\hat{O} = \hat{O}^\dagger$
が与えられたとき、
その全ての固有vector
$\ket{\lambda_n}$の集合が完全系をなす事を仮定する。
これは、適当な状態$\ket{\psi}$のもとで
物理量$\hat{O}$を観測した際には、
必ず固有値$\lambda_n$のいずれかが
観測される必要があるためである。
ただしここで言う完全系は$\hat{O}$の連続固有状態まで含めて
\begin{align}
    1&=
    \sum_{\forall n,i=1}^m \ket{a_n,i}\bra{a_n,i}
    +
    \int da \ket{a}\bra{a}
\label{complete set of operator eigen vectors}
\end{align}
と書き、上で述べたidentityのspectral decomposition
(\ref{spectral decomposition of identity})
の意味で解釈する。

このような記法のもとでは、状態$\ket{\psi}$
のもとである固有値$a_n$または$a$が観測される確率は
\begin{enumerate}
    \item{点spectrum $a_n$対し確率
    \begin{align}
        \bra{\psi} \hat{P}_n \ket{\psi}
        &=
            \sum_{1\le i \le m}
        \braket{\psi | a_n,i}
        \braket{a_n,i | \psi}
% \notag\\&=
        =
            \sum_{1\le i \le m}
            \Big|
                \braket{a_n,i | \psi}
            \Big|^2
    \end{align}
    }
    \item{連続spectrum $a$に関しては確率密度
    \begin{align}
        \bra{\psi} d \hat{P}(a) \ket{\psi}
        &=
        da \braket{\psi | a}\braket{a | \psi}
    =
        da
            \Big|
                \braket{a | \psi}
            \Big|^2
    \end{align}
    }
\end{enumerate}
のように内積を使って自然に与えられることになる。

\subsubsection{生成消滅演算子、Hilbert空間の無次元性}

さて、ここまでoperatorがどのようなHilbert空間$\mathcal{H}$に
作用しているか意図的に考えてこなかった。
$n$自由度系で正準交換関係
\begin{align}
    [ \hat{q}_i , \hat{p}_j ] &= i\hbar \delta_{ij}
\end{align}
が$\mathcal{H}$上に実現されているとし、
生成消滅演算子（creation and annihilation operator、
頼むからannihilationはアニヒレーションではなく
アナイレーションと発音して欲しい。
昇降演算子（raising and lowering operator）、
はしご演算子（ladder operator）などとも言う）を
\begin{subequations}
\begin{align}
    \hat{a}_i :=\ &
    \dfrac{1}{\sqrt{2\hbar}}
    \left(
        \sqrt{
            m\omega
        }\ \hat{q}_i
        +
        \dfrac{i}{\sqrt{m\omega}}
        \ \hat{p}_i
    \right)
\label{annihilation operator definition}
\\
    \hat{a}^\dagger_i =\ &
    \dfrac{1}{\sqrt{2\hbar}}
    \left(
        \sqrt{
            m\omega
        }\ \hat{q}_i
        -
        \dfrac{i}{\sqrt{m\omega}}
        \ \hat{p}_i
    \right)
\end{align}
\end{subequations}
で定義しよう。
これは単に$\{\hat{q}\}, \{\hat{p}\}$から
$\{\hat{a}\}, \{\hat{a}^\dagger\}$への
線形変換を与え、
逆変換は
\begin{subequations}
\begin{align}
    \hat{q}_i &=
    \dfrac{1}{2}\sqrt{
        \dfrac{2\hbar}{m\omega}
    }
    \left(
        \hat{a}_i + \hat{a}^\dagger_i
    \right)
\\
    \hat{p}_i &=
    \dfrac{1}{2i}\sqrt{
        2\hbar m\omega
    }
    \left(
        \hat{a}_i - \hat{a}^\dagger_i
    \right)
\end{align}
\end{subequations}
で与えられる。
正準交換関係ももちろん
$\{\hat{a}\}, \{\hat{a}^\dagger\}$
で書き直すことが出来、
\begin{align}
    [\hat{a}_i, \hat{a}^\dagger_j]
    &=\delta_{ij}
\label{creation annihilation operator}
\end{align}
が得られる。
$ \mathcal{H} $が有限次元だとすると、
(\ref{creation annihilation operator})の両辺の
traceを取ることで
\begin{align}
    \delta_{ij}
    \dim \mathcal{H}
    &=
    \delta_{ij}
    \tr (1)
    =
    \tr \left(
        [\hat{a}_i, \hat{a}^\dagger_j]
    \right)
    =
    \tr \left(
        \hat{a}_i \hat{a}^\dagger_j
    \right)
    -
    \tr \left(
        \hat{a}^\dagger_j \hat{a}_i
    \right)
    =
    \tr \left(
        \hat{a}_i \hat{a}^\dagger_j
    \right)
    -
    \tr \left(
        \hat{a}_i \hat{a}^\dagger_j
    \right)
    = 0
\end{align}
と矛盾が導かれるため、
正準交換関係が成り立つ限り
$\mathcal{H}$は無限次元でなければならない。
実は複素数列$a_n (n=0,1,\dots)$であって
$\sum_{n=0}^\infty |a_n|^2$
が収束するようなものの集合を
$l^2$と書くと、
可分な（つまり加算個の正規直交基底で張れる）
無限次元Hilbert空間は「$1$つしかない」こと、
すなわちそれらは全て$l^2$に同型であることが知られている。

この他に、同種粒子を$2$つ以上含む多粒子系では統計性と呼ばれるものを気にする必要があるが、
当面の間は同種粒子を含まない系のみを扱うことにする。
例えば次節で扱う$n$次元調和振動子も、
$d$次元空間に$n/d$個の（互いに種類の異なる）粒子が存在する系、
あるいは$n$次元空間内に粒子が$1$つだけ存在する系と解釈されたい。
また、考えている粒子が持つspin自由度を考える必要もあるが、
これを理解するためには先に
\ref{subsubsec: angular momentum}節で角運動量の代数を学ぶ必要があるだろう。

\subsubsection{調和振動子の例、Fock space}

$n$次元調和振動子を正準量子化してみよう。
$\{\hat{q}\}, \{\hat{p}\}$は可換測な物理量なのでHermitianであることを仮定しており、
\begin{align}
    \hat{H} &= \sum_{k=1}^n \bigg(
        \dfrac{ \hat{p}_k^2 }{2m}
    +
        \dfrac{ m\omega^2 }{2} \hat{q}_k^2
    \bigg)
\\
    [ \hat{q}_i , \hat{p}_j ] &= i\hbar \delta_{ij}
\end{align}
から
$\hat{H}$のHermiticityも自然に従う。
公式(\ref{A,BC to B(A,C) + (A,B)C})を使って
\begin{subequations}
\begin{align}
    [\hat{q}_i, \hat{H}] &= i\hbar \dfrac{ \hat{p}_i }{m}
\\
    [\hat{p}_j, \hat{H}] &= - i \hbar\ m\omega^2 \hat{q}_j
\end{align}
\end{subequations}
が得られる。
これらが調和振動子の正準方程式
(\ref{hamiltonian e.o.m for harmonic oscillator})
に非常によく類似している事に注意しよう
（より詳しくは
(\ref{Heisenberg e.o.m})
を参照）。

このままでは議論を進めるのが難しいが、
必ずしもHermitianではない無次元量
$\{\hat{a}\}, \{\hat{a}^\dagger\}$
への変数変換を考えることで見通しが良くなる。
元の変数$\{q\},\{p\}$は容易に消去出来て
\begin{subequations}
\begin{align}
    \hat{H}
    %    &
        &=
        \dfrac{ \hbar\omega }{ 2 }
        \sum_k
        \left(
            \hat{a}^\dagger_k\hat{a}_k
            +
            \hat{a}_k\hat{a}_k^\dagger
        \right)
    %\\
        =
        \hbar\omega
        \sum_k
        \left(
            \hat{N}_k
            +
            \dfrac{ 1 }{ 2 }
        \right)
\\
    \hat{N}_k &:= \hat{a}^\dagger_k\hat{a}_k
\end{align}
\end{subequations}
が得られる。
ただし、
$k$番目の自由度のnumber operator
$\hat{N}_k$を定義した
（\ref{sec: QFT}章で扱う場の量子論の用語を流用して
単に数演算子と呼ばれる事も多いが、
今の場合は粒子数ではなくenergy励起数を表す事に注意。
空間$3$次元の$n$粒子系を記述するためには
正準変数が$6n$個必要だったので、
粒子数が増減するためには
正準変数の個数が変化する必要があるが、
この生成消滅演算子でそれは起こらない）。

生成消滅演算子の交換関係
(\ref{creation annihilation operator})
に気を付けると、
変数変換後のoperatorが
\begin{subequations}
\begin{align}
    [\hat{N}_k,\hat{a}_i]
    &= - \hat{a}_i\delta_{ik}
\label{annihilation operator}
\\
    [\hat{N}_k,\hat{a}^\dagger_j]
    &= + \hat{a}^\dagger_j\delta_{jk}
\label{creation operator}
\end{align}
\label{raising and lowering number operator}
\end{subequations}
なる交換関係を為すことが分かる。
適当なenergy固有状態$ \ket{\psi} \neq 0 $
\begin{align}
    \hat{H} \ket{\psi}
    &=
    E \ket{\psi}
\end{align}
が存在するとき、
状態$\hat{a}_i \ket{\psi}$に$ \hat{H} $
を作用させると
\begin{align}
    \hat{H} \bigg(
        \hat{a}_i \ket{\psi}
    \bigg)
&=
    \left(
        \hat{a}_i \hat{H}
    +
        \left[ \hat{H}, \hat{a}_i \right]
    \right) \ket{\psi}
\notag\\&=
    \left(
        \hat{a}_i E
    - \hbar \omega \hat{a}_i
    \right) \ket{\psi}
\notag\\&=
    \left(
        E - \hbar \omega
    \right)
    \hat{a}_i \ket{\psi}
\end{align}
が得られ、状態$\hat{a}_i \ket{\psi}$は
（もし$0$でないならば）
energy $E - \hbar \omega$に属する
energy固有vector
（ただし規格化されているとは限らない）
であることが分かる。
全く同様に
\begin{align}
    \hat{H} \bigg(
        \hat{a}^\dagger_i \ket{\psi}
    \bigg)
&=
    \left(
        E + \hbar \omega
    \right)
    \hat{a}^\dagger_i \ket{\psi}
\end{align}
であり、
$\hat{a}^\dagger_i, \hat{a}_i$は
$i$番目の自由度のenergy levelを
enrgy量子$\hbar\omega$分だけ上下することが分かる。
これが生成消滅の名の所以である。

興味深いのは、$ \hat{H} $が
正定値なHilbert空間に作用しているという仮定のみから、
Hilbert空間にどのようなenergy固有状態が存在する（あるいはし得る）かの
情報が得られるということである。
$\hat{N}_i$同士は互いに可換なので、
その同時固有状態$\ket{N_1, N_2,\dots, N_n}$
を用意できる。
これは明らかに
$ \hat{H} = \hbar\omega
\sum_k
\left(
    \hat{N}_k
    +
    \dfrac{ 1 }{ 2 }
\right) $
の固有状態でもあり、
$\hat{a}^\dagger_i, \hat{a}_i$が
$\hat{N}_i$のみの固有値を$1$だけ上下する事も
上の議論から明らかであろう。
この状態$\ket{N_1, N_2,\dots, N_n}$によって
$\hat{N}_i$の期待値を取ると
\begin{align}
    N_i &=
    \bra{N_1, N_2,\dots, N_n} N_i \ket{N_1, N_2,\dots, N_n}
\notag\\&=
    \bra{N_1, N_2,\dots, N_n} \hat{N}_i \ket{N_1, N_2,\dots, N_n}
\notag\\&=
    \bra{N_1, N_2,\dots, N_n}
    \hat{a}^\dagger_i\hat{a}_i
    \ket{N_1, N_2,\dots, N_n}
\notag\\&=
    \Big|\Big|
        \hat{a}_i \ket{N_1, N_2,\dots, N_n}
    \Big|\Big|^2 \ge 0
\label{positive definiteness of number operator}
\end{align}
が導かれる。
最後の不等式は単に内積の正定値性から要求されるのだが、
もちろん$N_i < 0$の固有値は不等式に矛盾するため
存在できない。
$N_i = 0$のときには内積の正定値性から
真空条件：
\begin{align}
    \hat{a}_i \ket{N_1, N_2,\dots, N_i = 0,\dots, N_n} = 0
\label{vacuum of number operator}
\end{align}
が成り立つことにもすぐに気付けるであろう。
それ以外の固有値$N_i > 0$に属する状態に$\hat{a}_i$を掛けて得られるvectorはnormが非$0$となるため、
正定値性はこのvectorが$0$ vectorにはなり得ない事
$\hat{a}_i \ket{N_1, N_2,\dots, N_i > 0,\dots, N_n} \neq 0$
も保証する。
また、$0<N_i<1$が存在するとすると
$\hat{a}_i$によって$\hat{N}_i$の固有値を下げたとき
\begin{align}
    \bra{N_1, N_2,\dots, N_n}
        \hat{a}_i^\dagger \hat{N}_i \hat{a}_i
    \ket{N_1, N_2,\dots, N_n}
    &\propto
    N_i - 1 < 0
\end{align}
となり、（比例係数は単にvector
$\hat{a}_i \ket{N_1, N_2,\dots, N_n}$
の規格化から出る正の定数であるため）
正定値性から導かれる不等式に矛盾してしまう。
同様に適当な$p\in\mathbb{N}_+$に対し
$p<N_i<p+1$が存在するときも$\hat{a}_i$を$p+1$回以上作用させれば
正定値性の不等式に矛盾する結果が得られるので、
$\hat{N}_i$の任意の固有値は（存在するならば）非負整数であること、
$N_i = 0$の状態に対しては真空条件から
それ以下の固有値と固有状態を作れないことが分かる。
すなわち$\forall\ i$について$N_i \in \mathbb{N}_{\ge 0}$であり、
energy固有値はこれらを用い
\begin{align}
    E = \hbar\omega
    \left(
    \sum_{k=1}^n
        N_k
    +
        \dfrac{ n }{ 2 }
    \right)
\label{energy spectrum of harmonic oscillator}
\end{align}
と表されることが内積の正定値性のみから導かれたのである。
なお$N = \sum_k N_k$とおくと
真空は$N=0$に対応し、
下から$N+1$番目のenergy準位
$E = \hbar \omega \left(N + \dfrac{n}{2} \right) $
の縮退度$\mathrm{deg}(N)$は
上式を満たす非負整数$(N_1, N_2,\dots, N_n)$の組の数、つまり
\begin{align}
    \mathrm{deg}(N)
    &=
    {}_{N + n-1}C_{N}
    =
    \dfrac{(N+n-1)!}{N!\ (n-1)!}
\end{align}
である。
\footnote{
    高校数学で習うように、
    非負整数$N$を$n$個の非負整数の組$\{N_i\}$に分割する方法の数は、
    $N$個の区別できないもの（例えば石）を$n-1$個の区別できない仕切り（例えば棒）
    で区切る場合にありうる並べ方の数と同じである。
}

さて、$\hat{N}_i$の固有値は（存在するならば）非負整数であり、
これらの同時固有状態がHamiltonian $\hat{H}$の
固有状態を与える事は分かった。
上の議論から得られるもう一つの非自明な条件である
真空条件
(\ref{vacuum of number operator})
を用いて、
今度はその固有状態を具体的に構成してみよう。
既に説明したように物理的状態は
線形独立で可換なHermitian operatorをmaximalな個数だけ取ってきたとき、
それらの同時固有状態として区別される。
$n$次元調和振動子の例では
$n$個のnumber operator $\hat{N}_i$がその可換な組を与えるから、
適当な同時固有状態
$\ket{N_1, N_2,\dots, N_n}$
が少なくとも$1$つ存在することは仮定する。
これが存在すれば、
昇降演算子によって任意の非負整数固有値
$N_i\pm n_i$に属する固有状態
\begin{subequations}
\begin{align}
    \ket{N_1, N_2,\dots,N_i+n_i,\dots, N_n}
    &\propto
    \left(
        \hat{a}_i^\dagger
    \right)^{n_i}
    \ket{N_1, N_2,\dots, N_n}
\\
    \ket{N_1, N_2,\dots,N_i-n_i,\dots, N_n}
    &\propto
    \Big(
        \hat{a}_i
    \Big)^{n_i}
    \ket{N_1, N_2,\dots, N_n}
\end{align}
\end{subequations}
が構成できる事は明らかであろう
（$N_i - n_i > 0$である限りこれらのvectorが
zero-vector $0$とならないことは既に説明した）。
この規格化定数を、
最低固有値$N_i = 0$に属する状態について
\begin{align}
    \hat{a}_i \ket{N_1, N_2,\dots, N_i = 0,\dots, N_n} = 0
\\
    \braket{N_1, N_2,\dots, N_i = 0,\dots, N_n
    |
    N_1, N_2,\dots, N_i = 0,\dots, N_n}
    &=1
\end{align}
が成り立つという条件から計算してみよう。

一般の状態を
規格化定数$A_{n_i}$を用いて
\begin{align}
    \ket{N_1, N_2,\dots,N_i=n_i,\dots, N_n}
    &=
    A_{n_i}
    \left(
        \hat{a}_i^\dagger
    \right)^{n_i}
    \ket{N_1, N_2,\dots,
    N_i = 0,
    \dots, N_n}
\end{align}
と書くと、$n_i = 1$の場合には規格化条件
\begin{align}
    1 &=
    \braket{
        N_1, N_2,\dots,N_i = 1,\dots, N_n
        |
        N_1, N_2,\dots,N_i = 1,\dots, N_n
    }
\notag\\&=
    |A_1|^2
    \bra{N_1, N_2,\dots, N_i = 0,\dots, N_n}
    \hat{a}_i
    \hat{a}_i^\dagger
    \ket{N_1, N_2,\dots, N_i = 0,\dots, N_n}
\notag\\&=
    |A_1|^2
    \bra{N_1, N_2,\dots, N_i = 0,\dots, N_n}
    \bigg(
        \hat{a}_i^\dagger
        \hat{a}_i
        +
        [
        \hat{a}_i
        ,
        \hat{a}_i^\dagger
        ]
    \bigg)
    \ket{N_1, N_2,\dots, N_i = 0,\dots, N_n}
\notag\\&=
    |A_1|^2
    \bra{N_1, N_2,\dots, N_i = 0,\dots, N_n}
    \bigg(
        \hat{N}_i
        +
        1
    \bigg)
    \ket{N_1, N_2,\dots, N_i = 0,\dots, N_n}
\notag\\&=
    |A_1|^2
    \bigg(
        N_i
            \Big|_{N_i=0}
        +
        1
    \bigg)
\end{align}
を課すことで
$|A_1|^2 = 1$が求まる。
一般の$n_i$の場合も
全く同じ議論を繰り返すことで
\begin{align}
    1 &=
    \braket{
        N_1, N_2,\dots,N_i = n_i + 1 ,\dots, N_n
        |
        N_1, N_2,\dots,N_i = n_i + 1 ,\dots, N_n
    }
\notag\\&=
    \dfrac{
        |A_{n_i + 1}|^2
    }{
        |A_{n_i}|^2
    }
    \bra{N_1, N_2,\dots, N_i = n_i ,\dots, N_n}
    \hat{a}_i
    \hat{a}_i^\dagger
    \ket{N_1, N_2,\dots, N_i = n_i ,\dots, N_n}
\notag\\&=
    \dfrac{
        |A_{n_i + 1}|^2
    }{
        |A_{n_i}|^2
    }
    \bigg(
        N_i
            \Big|_{N_i=n_i}
        +
        1
    \bigg)
\notag\\\therefore\qquad
    |A_{n_i + 1}|^2 &=
    \dfrac{1}{
        n_i + 1
    }
    |A_{n_i}|^2
\end{align}
なる漸化式が得られ、
その解は
$|A_{n_i}|^2 = \dfrac{1}{n_i!}$
と求まる。
状態vectorのoverallの位相は情報を持たないのであったから
$A_{n_i} \in \mathbb{R}_{>0}$と取っても一般性を失わず、
一般の規格化された状態vectorが
ただ一つの真空vector
\begin{align}
    \ket{0}:=
    \ket{N_1 = 0, N_2 = 0 ,\dots,
    N_i = 0,
    \dots, N_n = 0}
\end{align}
を用いて
\begin{align}
    \ket{N_1, N_2,\dots,N_i=n_i,\dots, N_n}
    &=
    \dfrac{
        \left(
            \hat{a}_i^\dagger
        \right)^{n_i}
    }{\sqrt{n_i!}}
    \ket{N_1, N_2,\dots,
    N_i = 0,
    \dots, N_n}
\notag\\\therefore
    \ket{N_1, N_2,\dots,N_i,\dots, N_n}
    &=
    \prod_{i=1}^n
    \left(
        \dfrac{
            \left(
                \hat{a}_i^\dagger
            \right)^{N_i}
        }{\sqrt{N_i!}}
    \right)
    \ket{0}
\label{fock basis of harmonic oscillator}
\end{align}
と求まるのである。
なお、このような真空とそこからの励起で書かれるvectorを
Fock基底と言い、Fock基底が張る
vector spaceをFock spaceと呼ぶ。
また、任意のHermitian operatorの固有状態は
完全系を為すのであったから、
$n$次元量子調和振動子を実現する
無限次元複素Hilbert空間は
確かに加算個の基底を持ち、
可分であることが確かめられた。

なお、公式(\ref{creation n-th power commutation})
を使うと
生成消滅演算子のFock基底に対する作用が
規格化も含め
\begin{subequations}
\begin{align}
    \hat{a}_i^\dagger
    \ket{N_1, N_2,\dots,N_i=n_i,\dots, N_n}
    &=
    \sqrt{n_i+1}
    \ket{N_1, N_2,\dots,N_i=n_i+1,\dots, N_n}
\\
    \hat{a}_i
    \ket{N_1, N_2,\dots,N_i=n_i,\dots, N_n}
    &=
    \sqrt{n_i}
    \ket{N_1, N_2,\dots,N_i=n_i-1,\dots, N_n}
\end{align}
\label{Fock basis recurrence relation}
\end{subequations}
のような漸化式を与えると分かる。

\subsubsection{Coherent state}

量子力学では全てのobservableは
Hermitian operatorであったので、
基本的にはその固有状態に興味があった。
時にはnon-Hermitian operatorの固有状態も
興味深い性質を持つので、
$1$自由度の調和振動子系で
$\hat{a}^\dagger, \hat{a}$の固有状態を例に取り
その性質を調べてみよう。
$n$自由度系への拡張は上の議論から容易である。

調和振動子のcoherent状態を
\begin{align}
    \ket{\alpha}
    &:=
    \dfrac{1}{A}
    \exp(\alpha \hat{a}^\dagger)
    \ket{0}
\end{align}
で定義する。$A$は規格化定数で、後で定める。
$\hat{a}^\dagger, \hat{a}$の交換関係
(\ref{creation annihilation operator})から
(\ref{differential by commutator})
を導くのと全く同じ議論を繰り返せて
\begin{align}
    [\hat{a},\hat{a}^\dagger]
    &= 1
\notag\\
    C_{n+1}
    &:=
    [\hat{a},\left(\hat{a}^\dagger\right)^{n+1}]
\notag\\
    &=
    \hat{a}^\dagger
    [\hat{a},\left(\hat{a}^\dagger\right)^{n}]
    +
    [\hat{a},\hat{a}^\dagger]
    \left(\hat{a}^\dagger\right)^{n}
\notag\\
    &= \hat{a}^\dagger C_n
     + \left(\hat{a}^\dagger\right)^{n}
\notag\\
    \therefore\quad
    [\hat{a},\left(\hat{a}^\dagger\right)^{n+1}]
    &=
    C_{n+1} =
    (n+1) \left(\hat{a}^\dagger\right)^{n}
\label{creation n-th power commutation}
\end{align}
が成り立つので、
$\displaystyle
\exp(\alpha \hat{a}^\dagger)
=
\sum_{n=0}^\infty
\dfrac{
    \left(\alpha \hat{a}^\dagger\right)^n
}{n!}
$
との間には
\begin{align}
    [ \hat{a}, \exp(\alpha \hat{a}^\dagger) ]
&=
    \sum_{n=1}^\infty
    \dfrac{
        \alpha^n
    }{n!}
    n \left(\hat{a}^\dagger\right)^{n-1}
%\notag\\&
=
    \sum_{n=1}^\infty
    \dfrac{
        \alpha^n
    }{(n-1)!}
    \left(\hat{a}^\dagger\right)^{n-1}
\notag\\&=
    \alpha
    \sum_{n=0}^\infty
    \dfrac{
        \alpha^n
    }{n!}
    \left(\hat{a}^\dagger\right)^{n}
%\notag\\&=
=
    \alpha
    \exp(\alpha \hat{a}^\dagger)
\label{coherent commutator}
\end{align}
なる交換関係が成り立つ。
真空条件を用いるとcoherent stateは
\begin{align}
    \hat{a}
    \ket{\alpha}
    &=
    \dfrac{1}{A}
    \bigg(
        \exp(\alpha \hat{a}^\dagger)
        \cancel{ \hat{a} }
        +
        [ \hat{a} , \exp(\alpha \hat{a}^\dagger) ]
    \bigg)
    \ket{0}
\notag\\ &=
    \dfrac{1}{A}
    \alpha\exp(\alpha \hat{a}^\dagger)
    \ket{0}
\notag\\ &=
    \alpha
    \ket{\alpha}
\end{align}
を満たし、
$\hat{a}$の固有値$\alpha$に属する固有状態であることが分かる。
$\hat{a}$がnon-Hermitianであることに対応して、
$\alpha$は実数ではなく任意の複素数でよい事に注意しよう。

規格化定数は
\begin{align}
    1
    &=
    \braket{ \alpha | \alpha }
    =
    \dfrac{1}{A^*}
    \bra{0}
    \exp(\alpha^* \hat{a})
    \ket{\alpha}
    =
    \dfrac{1}{A^*}
    \bra{0}
    \exp(\alpha^* \alpha)
    \ket{\alpha}
\notag\\&=
    \dfrac{
        \exp( |\alpha|^2 )
    }{|A|^2}
    \bra{0}
    \exp(\alpha \hat{a}^\dagger)
    \ket{0}
\notag\\&=
    \dfrac{
        \exp( |\alpha|^2 )
    }{|A|^2}
\end{align}
最後の等式では、真空条件
$\bra{0}\hat{a}^\dagger = 0$
および真空が規格化されていること
$\braket{0|0}=1$
を用いた。
規格化定数が正の実数
$A = \exp\left( \dfrac{1}{2} |\alpha|^2 \right)$
になるよう位相を選んで一般性を失わないので、
規格化されたcoherent stateは
\begin{align}
    \ket{\alpha}
    &=
    \exp\left( -\dfrac{1}{2} |\alpha|^2 \right)
    \exp(\alpha \hat{a}^\dagger)
    \ket{0}
\notag\\&=
    \exp\left( -\dfrac{1}{2} |\alpha|^2 \right)
    \sum_{n\ge0}
    \dfrac{
        \left(\alpha \hat{a}^\dagger\right)^n
    }{n!}
    \ket{0}
\notag\\&=
    \exp\left( -\dfrac{1}{2} |\alpha|^2 \right)
    \sum_{n\ge0}
    \dfrac{\alpha^n}{\sqrt{n!}}
    \ket{n}
\end{align}
と書けることが分かる。

\subsubsection{Displacement operator}

上で定義したcoherent stateは、
displacement operator $D(\alpha)$を
\begin{align}
    D(\alpha) &:=
   \exp(
        \alpha\hat{a}^\dagger
        - \alpha^* \hat{a}
    )
\end{align}
で定義するとより系統的に扱うことが出来る。
$[\hat{a}, \hat{a}]=0$であるので、
交換関係
(\ref{coherent commutator})
を証明したのと全く同じ方法で
\begin{align}
    [\hat{a},\left(
        \alpha\hat{a}^\dagger
        - \alpha^* \hat{a}
    \right)^{n+1}]
    &=
    \alpha
    (n+1) \left(
        \alpha\hat{a}^\dagger
        - \alpha^* \hat{a}
    \right)^{n}
\notag\\\therefore\quad
    [\hat{a}, D(\alpha) ]
    &=
    \alpha D(\alpha)
\end{align}
が証明でき、
状態$D(\alpha)\ket{0}$もまた
$\hat{a}$の固有値$\alpha$に属する固有状態
\begin{align}
    \hat{a} D(\alpha)\ket{0}
    &=
    \alpha D(\alpha)\ket{0}
\end{align}
であることが分かる。

このdisplacement operatorはunitaryである
\begin{align}
    D(\alpha)^\dagger D(\alpha) &=
    \exp(
        \alpha^* \hat{a}
        - \alpha \hat{a}^\dagger
    )
    \exp(
        \alpha\hat{a}^\dagger
        - \alpha^* \hat{a}
    )
\notag\\&=
    \exp\Big(
        - (
        \alpha \hat{a}^\dagger
        -
        \alpha^* \hat{a}
        )
    \Big)
    \exp(
        \alpha\hat{a}^\dagger
        - \alpha^* \hat{a}
    )
\notag\\&=
    1
\end{align}
ため状態$D(\alpha)\ket{0}$は規格化されており、
実際に
$[
    \alpha \hat{a}^\dagger,
     - \alpha^* \hat{a}
]
= |\alpha|^2$から
BCH formulaの特別な場合
(\ref{simpler BCH formula})
が使えて
\begin{align}
    D(\alpha) &= \exp\left(
        - \dfrac{1}{2}|\alpha|^2
    \right)
    \exp(\alpha \hat{a}^\dagger)
    \exp( - \alpha^* \hat{a})
\notag\\
    \ket{\alpha} &= D(\alpha) \ket{0}
\end{align}
であることが証明できる。
ただし最後の等式は真空条件$\hat{a}\ket{0}=0$から従う。

\subsubsection{荷電粒子の量子化}

古典的な荷電粒子のHamiltonianを
(\ref{point charge hamiltonian})
で与えていた。
このように点粒子が電磁場と相互作用している場合に粒子を量子化する事を考える。
ただし、量子化されるのはあくまで荷電粒子のみであり、
電磁場を量子化するには（まず場の解析力学を学んだ後）
場の量子論の枠組みを用いなければならない事に注意しよう。
古典的な電磁場と相互作用する
量子力学的荷電粒子のHamiltonian operatorは
\begin{align}
    \hat{H}(\{\hat{x}\},\{\hat{p} - qA\})
  +
    U
  +
  \sum_m
    q_m
    \phi(\hat{\bm{x}}_m)
\label{hamiltonian of quantum mechanical point charge}
\end{align}
のようになる。
ここで、$\hat{x}_i$との正準交換関係を満たすoperatorはあくまで
Lagrangianから自然に導かれる
正準運動量$\hat{p}_j$であり、
力学的運動量$\hat{p}_j - (qA)_j$はもはや正準交換関係を満たさない事に注意しよう。
特に、$\bm{A}(\hat{x})$の位置依存性から
公式(\ref{commutator of function with momentum})
と
関係(\ref{field strength and magnetic field})
を用いることで
\begin{align}
    [\hat{p}_i, \hat{p}_j] &= 0
\notag\\
\Rightarrow
    [\hat{p}_i - (qA)_i,
    \hat{p}_j - (qA)_j]
&=
    - [\hat{p}_i, (qA)_j]
    - [(qA)_i, \hat{p}_j]
=
    [(qA)_j, \hat{p}_i]
    - [(qA)_i, \hat{p}_j]
\notag\\&
=
    i \hbar
    \left[
        \dfrac{ \partial (qA)_j}
        {\partial q_i}
    -
        \dfrac{ \partial (qA)_i}
        {\partial q_j}
    \right]
= i \hbar q \epsilon_{ijk} B_k
\end{align}
となることが分かる。

\subsection{波動関数による量子力学}

\subsubsection{波動関数とoperatorの$\bm{x}$-表示}

ここまで状態vectorとoperatorだけで一切の議論を展開してきた。
しかし、古典論で最も基本的な量であった
粒子の位置$\bm{x}$を中心的に扱って
量子力学を展開したいという向きもあるだろう。
そこで、ある状態$\ket{ \psi }$が与えられたとき
対応する波動関数（wave function）を
\begin{align}
    \psi(\bm{x}) := \braket{ \bm{x} | \psi }
\label{wave function as position rep of ket vector}
\end{align}
で定義する。
ここでもちろん$\ket{ \bm{x} }$は
位置operator $\hat{ q_i }$
（$D$を空間次元として、$i = 1,\dots,D$）の
固有値$x_i$に属する同時固有状態である。
$n$粒子系を考える場合も、
異なる粒子の位置operatorは交換するため
これらの同時固有状態を取ることが出来、
上の定義は
\begin{align}
    \psi(\bm{x}_1, \dots, \bm{x}_n)
    &:=
    \braket{ \bm{x}_1, \dots, \bm{x}_n | \psi }
\end{align}
と容易に拡張される。
任意の$\bm{x}_i$について波動関数を求めることが出来れば、
完全性関係
(\ref{spectral decomposition of identity})
を使うことにより
\begin{align}
    \ket{ \psi }
    =
    \int \prod_{i = 1}^n
    \left(
        d^D x_i
    \right)
    \ket{ \bm{x}_1, \dots, \bm{x}_n }
    \braket{ \bm{x}_1, \dots, \bm{x}_n | \psi }
    =
    \int \prod_{i = 1}^n
    \left(
        d^D x_i
    \right)
    \ket{ \bm{x}_1, \dots, \bm{x}_n }
    \psi( \bm{x}_1, \dots, \bm{x}_n )
\end{align}
と元の状態vectorが復元できるため、
波動関数を位置$\bm{x}_i$の関数として求めることは
状態vectorを求めることと同じである。
以下では状態vectorと対応する状態の波動関数を特に区別しない。

波動関数の物理的意味は、
連続固有値を持つoperator $\bm{q}$の
固有値$\bm{x}$が観測される確率密度が
(\ref{probability density for continuous spectrum})
で与えられていた事から明らかだろう。
すなわち、粒子が位置$\bm{x}$まわりの
微小体積$d^D x$で観測される確率密度は
\begin{align}
    d^D x\ 
    \psi^*(\bm{x}) \psi(\bm{x})
\end{align}
で与えられ、
波動関数$\psi(\bm{x})$はその確率振幅である。

波動関数へのoperatorの作用を考えよう。
vector $\hat{q}_i \ket{\psi}$の波動関数は、
$\hat{q}_i$のHermiticityに気を付けると
\begin{align}
    \bra{ \bm{x} } \hat{q}_i \ket{\psi}
    =
    \bra{ \bm{x} } x_i \ket{\psi}
    =
    x_i \psi( \bm{x} )
\end{align}
と求まる。
$\hat{p}_i \ket{\psi}$の波動関数を求めるには、
連続spectrumに対応する状態が
(\ref{continuous spectrum normalization})
と規格化されていた事を思い出して
\begin{align}
    ( x_i - y_i )
        \bra{ \bm{x} }
        \hat{p}_i
        \ket{ \bm{y} }
&=
    \bra{ \bm{x} }
        x_i
        \hat{p}_i
    \ket{ \bm{y} }
    -
    \bra{ \bm{x} }
        \hat{p}_i
        y_i
    \ket{ \bm{y} }
    \quad
    \text{（$i$について和は取らない）}
\notag\\&=
    \bra{ \bm{x} }
    [ \hat{q}_i, \hat{p}_i ]
    \ket{ \bm{y} }
=
    i \hbar
    \braket{ \bm{x} | \bm{y} }
=
    i \hbar
    \delta( \bm{x} - \bm{y} )
\notag\\&=
        i \hbar
    \int
    \dfrac{
        d^{D} k\ 
    }{
        (2 \pi \hbar)^{D}
    }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
    \quad
    \text{
        (
            $\because$
            Dirac deltaのFourier表示
            (\ref{dirac delta fourier representation})
        )
    }
\notag\\&=
    -
        i \hbar
    \int
    \dfrac{
        d^{D} k\ 
    }{
        (2 \pi \hbar)^{D}
    }
    \dfrac{ x_i - y_i }{ i\hbar }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
    k_i
    \quad(\because \text{
        部分積分、
        $i$について和は取らない
    } )
\notag\\&=
    -
    ( x_i - y_i )
    \int
    \dfrac{
        d^{D} k
    }{
        (2 \pi \hbar)^{D}
    }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
    k_i
\end{align}
に気付けばよい。
従って
\begin{align}
    \bra{ \bm{x} }
        \hat{p}_i
    \ket{ \bm{y} }
    =
    -
    \int
    \dfrac{
        d^{D} k
    }{
        (2 \pi \hbar)^{D}
    }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
    k_i
\end{align}
である。
\footnote{
    $ x_i - y_i $による除算が定義されているのは
    最初と最後の表式だけで、
    途中の式変形についてはこれは定義されていない事に注意しよう。
    例えば、Dirac deltaの性質
    $f(x) \delta(x-a) = f(a) \delta(x-a)$
    を使うと
    $\dfrac{ \delta( \bm{x} - \bm{y} ) }{ x_i - y_i } = \infty$
    となって等式が意味を持たなくなってしまう。

    また、
    左辺で$\hat{p}_i$を$\hat{p}_j$に置き換えると
    \begin{align}
        ( x_i - y_i )
        \bra{ \bm{x} }
        \hat{p}_j
        \ket{ \bm{y} }
    &=
        -
        ( x_i - y_i )
        \delta_{ij}
        \int
        \dfrac{
            d^{D} k
        }{
            (2 \pi \hbar)^{D}
        }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
        k_j
    \end{align}
    が得られ（Kronecker deltaが掛かっているので
    右辺の$i$と$j$は勝手に入れ替えてよい）、
    両辺を$ x_i - y_i $で割ると
    右辺は$\delta_{ij}$に比例するが
    左辺は$i$に依存しないという矛盾が生じる。
    これも上と本質的に同じ理由で、
    本文の式変形では
    そもそも$i$によらずDirac deltaであった右辺を
    部分積分する際に$k_i$の$i$を恣意的に選ぶことにより
    この矛盾を誤魔化している。
}
従って
一般の状態への$\hat{p}_j$の作用は
\begin{align}
    \bra{ \bm{x} }
    \hat{p}_j
    \ket{ \psi }
&=
    \int d^D y
    \bra{ \bm{x} }
    \hat{p}_j
    \ket{ \bm{y} }
    \braket{ \bm{y} | \psi }
\notag\\&=
    -
    \int d^D y
    \int
    \dfrac{
        d^{D} k
    }{
        (2 \pi \hbar)^{D}
    }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
    k_j
    \psi( \bm{y} )
\notag\\&=
    +
    \int d^D y
    \int
    \dfrac{
        d^{D} k
    }{
        (2 \pi \hbar)^{D}
    }
        i \hbar
        \dfrac{ \partial }{ \partial y_i }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
        \psi( \bm{y} )
\notag\\&=
    -
    i \hbar
    \int d^D y
        \dfrac{ \partial }{ \partial y_j }
        \psi( \bm{y} )
    \int
    \dfrac{
        d^{D} k
    }{
        (2 \pi \hbar)^{D}
    }
        e^{
            \frac{1}{i\hbar}
            \bm{k} \cdot ( \bm{x} - \bm{y} )
        }
    \quad(\because \text{部分積分} )
\notag\\&=
    -
        i \hbar
    \int d^D y
        \dfrac{ \partial }{ \partial y_j }
        \psi( \bm{y} )
    \delta( \bm{x} - \bm{y} )
\notag\\&=
    -
        i \hbar
        \dfrac{ \partial }{ \partial x_j }
        \psi( \bm{x} )
\end{align}
と与えられる。
上の証明は任意のvector
$\ket{\psi}$について成り立つので、
例えば$\ket{\psi} = \hat{q} \ket{\phi}$に
$\hat{p}$を作用させた結果なども全く同じ式で与えられる。
結局一般のoperatorも
\begin{subequations}
\begin{align}
    \hat{q}_i
    &\mapsto
    x_i
\\
    \hat{p}_j
    &\mapsto
    - i \hbar
    \dfrac{\partial}{\partial x_j}
\\
    f( \hat{\bm{q}}, \hat{\bm{p}} )
    &\mapsto
    f
    \left( \bm{x}, 
        - i \hbar
        \nabla
    \right)
\end{align}
\label{position representation of operators}
\end{subequations}
のように置き換えればよいことが分かり、
このような表式をoperatorの位置表示
（position representation
座標表示、$\bm{x}$-表示）という。

例として運動量の固有状態を
$\bm{x}$-表示で求めると
\begin{align}
    - i \hbar
    \dfrac{\partial}{\partial x_i}
    \braket{ \bm{x} | \bm{p} }
    &=
    \bra{ \bm{x} }
    \hat{p}_i
    \ket{ \bm{p} }
    =
    p_i
    \braket{ \bm{x} | \bm{p} }
\notag\\\therefore
    \braket{ \bm{x} | \bm{p} }
    &=
    \dfrac{
        \exp\left(
            -
            \dfrac{1}{i\hbar}
            \bm{p} \cdot \bm{x}
        \right)
    }{ (2 \pi \hbar)^{D/2} }
\label{plain wave in qm}
\end{align}
すなわち平面波となる。
ただし規格化定数は規格化条件
\begin{align}
    \delta( \bm{p} - \bm{p}' )
    =
    \braket{ \bm{p} | \bm{p}' }
    =
    \int d^D x
    \braket{ \bm{p} | \bm{x} }
    \braket{ \bm{x} | \bm{p}' }
\end{align}
を満たすよう与えた。
至る所に現れる$\hbar$を隠すため
波数（wave number）vector
$\bm{k} := \dfrac{ \bm{p} }{\hbar}$
を定義すると便利なことが多く、
波数積分$\int d^D k$のもとで規格化された
固有関数は
\begin{align}
    \braket{\bm{x} | \bm{k}}
    =
    \dfrac{
        e^{
            + i
            \bm{k} \cdot \bm{x}
        }
    }{ (2 \pi)^{D/2} }
\end{align}
で与えられる。
運動量$p = |\bm{p}|$は
de Broglie wavelength（ド・ブロイ波長）
$\lambda$と
\begin{align}
    \lambda = \dfrac{h}{p}
    = \dfrac{2 \pi \hbar}{p}
\end{align}
の関係にある事も思い出しておくとよい。
すなわち$\lambda = \dfrac{2 \pi}{|\bm{k}|}$の関係がある。

また、適当なoperatorの固有状態
$\ket{n}$に関する
完全性関係
(\ref{spectral decomposition of identity})
の$\bm{x}$-表示は、
$\ket{n}$の波動関数を$\psi_n( \bm{x} )$として
\begin{align}
    \delta(\bm{x} - \bm{y})
    =
    \braket{ \bm{x} | \bm{y} }
    =
    \bra{ \bm{x} }
        \sum_n
        \ket{n}
        \braket{ n | \bm{y} }
    =
    \sum_n
    \psi_n( \bm{x} )
    \psi_n^*( \bm{y} )
\label{complete set of wave function}
\end{align}
となる。

\subsubsection{調和振動子の例}

$1$次元調和振動子のHamiltonianの固有関数を求めてみよう。
真空条件(\ref{vacuum of number operator})を
annihilation operatorの定義
(\ref{annihilation operator definition})を
使って
$\bm{x}$-表示で書き下してみると、
\begin{subequations}
\begin{align}
    0
    &=
    a \psi_0(x)
\\
    a
    &=
    \dfrac{1}{\sqrt{2\hbar}}
    \left[
        \sqrt{
            m\omega
        }\ x
        +
        \dfrac{i}{\sqrt{m\omega}}
        \left(
            - i \hbar \dfrac{d}{dx}
        \right)
    \right]
\end{align}
\end{subequations}
という一階線形微分方程式が得られる。
もちろんこれは簡単に解けて、
規格化された解は
\begin{subequations}
\begin{align}
    \psi_0 (x)
    &=
    \left(
        \dfrac{m \omega}{\pi \hbar}        
    \right)^{1/4}
    \exp(- \dfrac{m \omega}{2 \hbar} x^2)
\label{vacuum solution of harmonic oscillator}
\\
    1
    &=
    \int dx\ 
        \psi_0 ^* (x)
        \psi_0    (x)
\end{align}
\end{subequations}
と与えられる。
$n$番目の励起状態の
（規格化された）波動関数も、
Fock基底の定義
(\ref{fock basis of harmonic oscillator})
から
\begin{subequations}
\begin{align}
    \psi_n (x)
    &=
    \dfrac{ (a^\dagger)^n }{ \sqrt{n!} }
    \psi_0 (x)
\\
    a^\dagger
    &=
    \dfrac{1}{\sqrt{2\hbar}}
    \left[
        \sqrt{
            m\omega
        }\ x
        -
        \dfrac{i}{\sqrt{m\omega}}
        \left(
            - i \hbar \dfrac{d}{dx}
        \right)
    \right]
\end{align}
\end{subequations}
と容易に求まる。
\ref{hermite polynomial}で扱う
Hermite多項式との関係を具体的に求めることもでき、
直交性(\ref{normality of hermite polynomial})から
\begin{align}
    h_n(y)
    :=
    \dfrac{1}{ \sqrt{n!} (2\pi)^{1/4}}
    H_n(y) \exp(- y^2 / 4)
\end{align}
が正規直交関数系となっている事に気付けば
ただちに
\begin{align}
    \phi_n(x)
    =
    \left(
            \dfrac{2 m \omega}{\hbar}
    \right)^{1/4}
    h_n
    \left(
        y =
        \left(
            \dfrac{2 m \omega}{\hbar}
        \right)^{1/2} x
    \right)
    =
    \dfrac{1}{ \sqrt{n!} }
    \left(
            \dfrac{m \omega}{\pi \hbar}
    \right)^{1/4}
    H_n(y) \exp(- y^2 / 4)
    \bigg|_{
        \displaystyle
        y =
        \left(
            \dfrac{2 m \omega}{\hbar}
        \right)^{1/2}
        x
    }
\end{align}
が得られる。
ただし先頭の係数は置換積分から出る
$dx = dy \dfrac{dx}{dy}$
を打ち消して正規直交性が保たれるように導入した。
特に、生成消滅演算子
\begin{subequations}
\begin{align}
    a
    &=
    \dfrac{1}{2}
    y
    +
    \dfrac{d}{dy}
\\
    a^\dagger
    &=
    \dfrac{1}{2}
    y
    -
    \dfrac{d}{dy}
\end{align}
\end{subequations}
の作用は漸化式
(\ref{hermite polynomial recurrence relation})
を使うと
\begin{align}
    a h_n &= \sqrt{n}\ h_{n-1}
\\
    a^\dagger h_n
    &= \sqrt{n + 1}\ h_{n+1}
\end{align}
すなわち
(\ref{Fock basis recurrence relation})
に帰着することが分かる。

調和振動子のenergy spectrumは
(\ref{energy spectrum of harmonic oscillator})
で、
Schr\"odinger方程式の一般解は
(\ref{time dependent solution for Schrodinger eq})
で与えられていたので、
調和振動子の時間依存するenergy固有状態は
\begin{align}
    \exp( \dfrac{t E_n}{i\hbar} )
    \psi_n (x)
    =
    \exp\left[
        \dfrac{t}{i\hbar}
        \hbar \omega
        \left( n + \dfrac{1}{2} \right)
    \right]
    \psi_n (x)
    =
    \exp\left[
        - i t \omega
        \left( n + \dfrac{1}{2} \right)
    \right]
    \psi_n (x)
\end{align}
と与えられる。
特に、任意の初期条件の下での
調和振動子の時間依存解はその線形結合
(\ref{eigen decomposition of time independent solution})
で与えられる。

\subsubsection{量子力学的荷電粒子と
    位相$\mathrm{U}(1)$変換、
    Gauge対称性}

さて、ここまで電荷を持たない量子力学的粒子の波動関数を議論してきた。
荷電粒子の波動関数も状態vectorの位置表示
(\ref{wave function as position rep of ket vector})
で同様に与えられるし、
当然Hamiltonian
(\ref{hamiltonian of quantum mechanical point charge})
の位置表示も
(\ref{position representation of operators})
の規則に従って
\begin{align}
    H (\{x\},
    \{- i \hbar \nabla - q A\})
  + U
  + \sum_m q_m \phi(\bm{x}_m)
\label{position rep of charged many particle hamiltonian}
\end{align}
のように問題なく与えられる。
何も特別な事はないように思われるが、
ここで一見全く関係ない波動関数の位相について考えてみる。

状態vectorは規格化されていなければならないが、
規格化した後もoverallの位相は定まらないのであった。
波動関数も定義式
(\ref{wave function as position rep of ket vector})
から同じ性質を引き継いでおり、
その位相は物理的に意味を持たないため、
位相分だけ波動関数を再定義しても物理法則
（Schr\"odinger方程式の解、物理量の期待値、etc.）は不変である。
しかし、波動関数は状態vectorとは異なり、
個々の粒子の位置に依存する
（つまり配位空間上の）複素関数と思うこともできる。
例えば波動関数の位相を東大の本郷キャンパスで実になるように取ったとき、
柏キャンパス（あるいはブラジルでも月の裏側でもよいが）において
波動関数の位相をどう取るべきか決まってしまうのは不自然ではないだろうか
\cite{fujikawa gauge review}。
このような議論にどれだけ説得力があるかは一旦置いておいて、
波動関数の位置依存する位相変換のもとで
Schr\"odinger方程式
(\ref{time dependent Schrodinger eq})
が不変になるような拡張を試みてみよう。

まず電荷を持たない$1$粒子の議論から始める。
波動関数の位相変換は
実parapeter $\theta \in \mathbb{R}$
を用いて
\begin{align}
    \psi (t, \bm{x})
\mapsto
    \psi' (t, \bm{x})
:=
    e^{i \theta} \psi (t, \bm{x})
\end{align}
のように書ける。
既に説明したように
Schr\"odinger方程式はこの変換の下で不変
（つまり$\psi$が方程式の解ならば
$\psi'$も必ず解）である。
位置に依存する位相変換とは単に
$\theta$を位置や時間に依存する実関数とした変換
\begin{align}
    \psi (t, \bm{x})
\mapsto
    \psi'' (t, \bm{x})
:=
    e^{i \theta(t, \bm{x})}
    \psi (t, \bm{x})
\end{align}
であって、このもとでSchr\"odinger方程式(\ref{time dependent Schrodinger eq})
の位置表示
\begin{align}
    i\hbar
    \dfrac{\partial \psi}{\partial t}
    (t, \bm{x})
&=
    H (\bm{x}, -i \hbar \nabla)
    \psi (t, \bm{x})
\end{align}
は不変ではない。
運動量operatorの位置表示は微分operatorであるため、
位相が位置に依存している場合には
公式
(\ref{commutator of function with momentum})
から
\begin{align}
    [- i \hbar \partial_i,
    e^{- i \theta(t, \bm{x})} ]
=
    - i \hbar (\partial_i
    e^{- i \theta(t, \bm{x})} )
=
    - i \hbar e^{- i \theta}
    (- i \partial_i \theta)
\end{align}
のようなお釣りが現れてしまうのである。
変換後の$\psi''$が従うSchr\"odinger方程式は
\begin{align}
    i\hbar
    e^{- i \theta}
    \left(
        \dfrac{\partial \psi''}
        {\partial t}
    -
        i
        \dfrac{\partial \theta}
        {\partial t}
        \psi''
    \right)
=
    i \hbar
    \dfrac{\partial \psi}{\partial t}
&=
    H (\bm{x}, - i \hbar \nabla) \psi
=
    e^{- i \theta}
    H (\bm{x}, - i \hbar \nabla
    - \hbar \nabla \theta )
    \psi''
\notag\\ \therefore \quad
    i\hbar
    \dfrac{\partial \psi''}{\partial t}
&=
    \left[
        H (\bm{x}, - i \hbar
        \nabla - \hbar \nabla \theta)
    - \hbar
        \dfrac{\partial \theta}{\partial t}
    \right]
    \psi''
\end{align}
となって元の形に一致しない。

電荷$q$の荷電粒子が$1$つある場合はどうだろうか。
粒子が電荷を持たない場合$q=0$は
Schr\"odinger方程式が不変ではないことを既に見たので、
位相の形を
$e^{i q \theta (t, \bm{x})}$
と再定義して一般性を失わない。
式変形自体は同様にでき、
違いは位相を微分するたびに$q$倍が余計に現れることと
Hamiltonianに電磁potentialが入ること
\begin{align}
    i\hbar
    \dfrac{\partial \psi''}{\partial t}
&=
    \left[
        H (\bm{x},
        - i \hbar \nabla - q \bm{A}
        - \hbar q \nabla \theta)
    + U
    + q \phi(\bm{x})
    - q \hbar
        \dfrac{\partial \theta}{\partial t}
    \right]
    \psi''
\end{align}
であって
今度もやはりSchr\"odinger方程式は不変ではない。
ところが、電磁potentialはgauge変換のもとで不変であったので、
位相変換とgauge変換を同時に行う
\begin{subequations}
\begin{align}
    \psi (t, \bm{x}) &\mapsto
    \psi' (t, \bm{x})
    = e^{i q \theta} \psi (t, \bm{x})
\\
    \phi (t, \bm{x}) &\mapsto
    \phi' (t, \bm{x}) :=
    \phi (t, \bm{x}) - \hbar
    \dfrac{\partial \theta}{\partial t} (t, \bm{x})
\\
    A_i (t, \bm{x}) &\mapsto
    A_i' (t, \bm{x}) :=
    A_i (t, \bm{x}) + \hbar
    \partial_i \theta (t, \bm{x})
\end{align}
\end{subequations}
を行ったときに限り、
Schr\"odinger方程式は
\begin{align}
    i\hbar
    \dfrac{\partial \psi'}{\partial t}
&=
    \left[
        H (\bm{x},
        - i \hbar \nabla - q \bm{A}')
    + U
    + q \phi' (\bm{x})
    \right]
    \psi'
\end{align}
となって元の形に一致するのである。
詳しくはgauge場の理論で学ぶことになるが、
これは電磁場が位相変換の$\mathrm{U}(1)$対称性のgauge化に伴うgauge粒子と解釈できる事を反映している。

荷電粒子が複数ある場合に議論を一般化する時には注意が必要だ。
$m$番目の粒子の電荷を$q_m$、
位置を$\bm{x}_m$としたとき、
電磁potentialはあくまで時空の関数
$\phi(\bm{x}), \bm{A} (\bm{x})$
であり、
Hamiltonianに現れる
$\phi(t, \bm{x}_m),
\bm{A} (t, \bm{x}_m)$は
時空の関数を特定の粒子の位置で評価したものである。
一方で波動関数
$\psi(t, \{\bm{x}\})
= \psi(t, \bm{x}_1, \bm{x}_2, \dots)$
は配位空間上の関数であって時空の関数ではない。
$\theta$が配位空間上の関数なのか時空上の関数なのか見定めるためには、
gauge変換があくまで時空の関数として
電磁potentialを変換する操作である事に気を付ければよい。
時空の関数に配位空間の関数の微分を足すような操作は、
そもそもgauge変換にはなっていないのである。
位相変換の多粒子系への正しい一般化は、
時空上の関数
$\theta (t, \bm{x})$を使って
\begin{subequations}
\begin{align}
    \psi (t, \{\bm{x}\}) &\mapsto
    \psi' (t, \{\bm{x}\})
    = e^{i \sum_m q_m \theta(t, \bm{x}_m)}
    \psi (t, \{\bm{x}\})
\\
    \phi (t, \bm{x}) &\mapsto
    \phi' (t, \bm{x}) :=
    \phi (t, \bm{x}) - \hbar
    \dfrac{\partial \theta}{\partial t} (t, \bm{x})
\\
    A_i (t, \bm{x}) &\mapsto
    A_i' (t, \bm{x}) :=
    A_i (t, \bm{x}) + \hbar
    \partial_i \theta (t, \bm{x})
\end{align}
\end{subequations}
と書け、このもとで量子力学的な荷電粒子の
多粒子系のHamiltonian
(\ref{position rep of charged many particle hamiltonian})
を用いた
Schr\"odinger方程式は
\begin{align}
    i\hbar
    \dfrac{\partial \psi'}{\partial t}
    (t, \{\bm{x}\})
&=
    \left[
      H (\{\bm{x}_m\},
        \{- i \hbar \nabla_m
        - q_m \bm{A}' (\bm{x}_m)\})
      + U
      + \sum_m q_m \phi' (\bm{x}_m)
    \right]
    \psi'
    (t, \{\bm{x}\})
\end{align}
のように確かに不変となっている。

\subsection{経路積分量子化とFeynman ruleによる摂動論}

\subsubsection{Feynman Kernel}

時刻$t_i$に位置$\bm{x}_i$で観測され
$ \ket{ \psi(t_i) } = \ket{ \bm{x}_i }$
すなわち
\begin{align}
    \psi(t_i, \bm{x})
    =
    \braket{ \bm{x} | \psi(t_i) }
    =
    \delta( \bm{x} - \bm{x}_i )
\end{align}
を満たす量子力学的粒子が、
時刻$t_f$に位置$\bm{x}_f$で観測され
$\phi_f(\bm{x}) := \delta(\bm{x} - \bm{x}_f)$
となる遷移振幅をFeynman kernel
（ファインマン核）といい、
時間発展operator
(\ref{time evolution operator})を使って
\begin{align}
    K( t_f, \bm{x}_f ; t_i, \bm{x}_i )
&:=
    \braket{ \phi_f | \psi(t_f) }
=
    \bra{ \bm{x}_f }
    \hat{U}(t_f, t_i)
    \ket{ \bm{x}_i }
\end{align}
と書ける。
一般の始状態（initial state）
$\psi_I( \bm{x} ) = \braket{ \bm{x} | \psi_I }$と
終状態（final state）
$\psi_F( \bm{x} ) = \braket{ \bm{x} | \psi_F }$
についても、
遷移振幅は
\begin{align}
    A_{FI}(t)
    &=
    \bra{\psi_F}
        \hat{U} ( t_i + t ; t_i )
    \ket{\psi_I}
\notag\\&=
    \bra{\psi_F}
        \int d^D y
        \ket{ \bm{y} }
        \bra{ \bm{y} }
    \hat{U} ( t_i + t ; t_i )
        \int d^D z
        \ket{ \bm{z} }
    \braket{ \bm{z} | \psi_I}
\notag\\&=
    \int d^D y\ 
        d^D z\ 
    \psi_F^*( \bm{y} )
        K( t_i + t, \bm{y} ; t_i, \bm{z} )
    \psi_I  ( \bm{z} )
\label{transition amplitude with feynman kernel}
\end{align}
と書ける。
この意味で、Feynman kernelは
積分変換のkernelになっている。

さて、Feynman kernelを具体的に求めれば
任意の遷移振幅が積分変換で分かるとなれば、
当然これを計算したくなるだろう。
定義式から
\begin{align}
    K( t, \bm{x} ; t_i, \bm{x}_i )
&=
    \bra{ \bm{x} }
        \hat{U}(t, t_i)
    \ket{ \bm{x}_i }
\notag\\&=
    \bra{ \bm{x} }
        \exp\left(
            \dfrac{ t - t_i }{ i\hbar }
            \hat{H}(\hat{q}, \hat{p})
        \right)
    \ket{ \bm{x}_i }
\notag\\&=
    \exp\left(
        \dfrac{ t - t_i }{ i\hbar }
        H
        \left(
            x,
            -i \hbar
            \dfrac{\partial}{\partial x}
        \right)
    \right)
    \braket{ \bm{x} | \bm{x}_i }
\notag\\&=
    \exp\left(
        \dfrac{ t - t_i }{ i\hbar }
        H
        \left(
            x,
            -i \hbar
            \dfrac{\partial}{\partial x}
        \right)
    \right)
    \delta( \bm{x} - \bm{x}_i )
\label{feynman kernel w.r.t. wave function complete set}
\end{align}
が分かるが、
指数関数から出る
$\dfrac{\partial}{\partial x}$の無限乗が
Dirac deltaに掛かるような計算は極力したくない。
例えば、もしHamiltonianの全ての
固有値と固有状態が分かっているなら、
Hamiltonianの固有状態に関して
完全性関係
(\ref{complete set of wave function})を使って
\begin{align}
    K( t, \bm{x} ; t_i, \bm{x}_i )
    &=
    \exp\left(
        \dfrac{ t - t_i }{ i\hbar }
        H
        \left(
            x,
            -i \hbar
            \dfrac{\partial}{\partial x}
        \right)
    \right)
    \sum_n
    \psi_n( \bm{x} )
    \psi_n^*( \bm{x}_i )
\notag\\&=
    \sum_n
    \psi_n^*( \bm{x}_i )
    \exp\left(
        \dfrac{ t - t_i }{ i\hbar }
        E_n
    \right)
    \psi_n( \bm{x} )
\end{align}
などと計算する事も出来る
\footnote{
    自由粒子$H = \dfrac{p^2}{2m}$の場合であれば
    平面波
    (\ref{plain wave in qm})がそのまま
    Hamiltonianの固有状態にもなっているので、
    単にFresnel積分(\ref{fresnel integral})
    を実行すればよくて
    \begin{align}
        K( t, \bm{x} ; t_i, \bm{x}_i )
    &=
        \int d^D p\ 
        \psi_p^*( \bm{x}_i )
        \exp\left(
            \dfrac{ t - t_i }{ i\hbar }
            E_p
        \right)
        \psi_p( \bm{x} )
    =
        \int d^D p\ 
        \dfrac{
            \exp\left(
                +
                \dfrac{1}{i\hbar}
                \bm{p} \cdot \bm{x}_i
            \right)
        }{ (2 \pi \hbar)^{D/2} }
            \exp\left(
            \dfrac{ t - t_i }{ i\hbar }
            \dfrac{ \bm{p}^2 }{ 2m }
        \right)
        \dfrac{
            \exp\left(
                -
                \dfrac{1}{i\hbar}
                \bm{p} \cdot \bm{x}
            \right)
        }{ (2 \pi \hbar)^{D/2} }
    \notag\\&=
        \int 
        \dfrac{
            d^D p
        }{ (2 \pi \hbar)^{D} }
            \exp\left(
                -
                \dfrac{ i ( t - t_i ) }{ 2 m \hbar }
                \bm{p}^2
            -
                \dfrac{1}{i\hbar}
                \bm{p} \cdot (\bm{x} - \bm{x}_i)
            \right)
    \notag\\&=
        \int 
        \dfrac{
            d^D p
        }{ (2 \pi \hbar)^{D} }
            \exp\left(
                -
                \dfrac{ i ( t - t_i ) }{ 2 m \hbar }
                \left[
                    \bm{p}
                -
                    \dfrac{ m }{ ( t - t_i ) }
                    (\bm{x} - \bm{x}_i)
                \right]^2
                -
                \dfrac{ m }{ 2 i \hbar (t - t_i) }
                (\bm{x} - \bm{x}_i)^2
            \right)
    \notag\\&=
        \dfrac{ 1 }{ (2 \pi \hbar)^{D} }
        \left(
            \dfrac{ 2 \pi \hbar m }{ i ( t - t_i ) }
        \right)^{\frac{D}{2}}
        \exp\left(
            -
            \dfrac{ m }{ 2 i \hbar (t - t_i) }
            (\bm{x} - \bm{x}_i)^2
        \right)
    \notag\\&=
        \left(
            \dfrac{ m }{ 2 \pi i \hbar ( t - t_i ) }
        \right)^{\frac{D}{2}}
        \exp\left(
            -
            \dfrac{ m }{ 2 i \hbar (t - t_i) }
            (\bm{x} - \bm{x}_i)^2
        \right)
    \label{feynman kernel for free particle}
    \end{align}
    と求まる。
    Schr\"odinger方程式の形を考えると当然だが、
    これは拡散方程式のGreen関数と同じ形をしている。
}
であろうが、
以下では別の方法を考える。

\subsubsection{Hamiltonian Path Integral}

粒子の位置観測の間隔を$T := t_f - t_i$として、
時間$\delta t := \dfrac{ T }{ N }$ごとに
完全系$\displaystyle
    1 = \int d^D {x_i}
        \ket{ \bm{x}_i }
        \bra{ \bm{x}_i }
$を挟むこと
\begin{align}
    K( t_f, \bm{x}_f ; t_i, \bm{x}_i )
&=
    \bra{ \bm{x}_f }
        \exp\left(
            \dfrac{ 1 }{ i\hbar }
            \int_{t_i}^{t_f} dt
            \hat{H}
        \right)
    \ket{ \bm{x}_i }
\notag\\&=
    \bra{ \bm{x}_f }
    \exp\left(
        \dfrac{1}{i\hbar}
        \int_{t_i + (N-1) \delta t}
            ^{t_f = t_i + N \delta t}
        dt \hat{H}
    \right)
    \int d^D x_{N-1}
        \ket{ \bm{x}_{N-1} }
        \bra{ \bm{x}_{N-1} }
\notag\\&\qquad\qquad
    \exp\left(
        \dfrac{1}{i\hbar}
        \int_{t_i + (N-2) \delta t}
            ^{t_i + (N-1) \delta t}
        dt \hat{H}
    \right)
    \int d^D x_{N-2}
        \ket{ \bm{x}_{N-2} }
        \bra{ \bm{x}_{N-2} }
\notag\\&\dots
    \int d^D x_{n+1}
        \ket{ \bm{x}_{n+1} }
        \bra{ \bm{x}_{n+1} }
    \exp\left(
        \dfrac{1}{i\hbar}
        \int_{t_i + n \delta t}
            ^{t_i + (n+1) \delta t}
        dt \hat{H}
    \right)
    \int d^D x_n
        \ket{ \bm{x}_n }
        \bra{ \bm{x}_n }
\notag\\&\qquad\dots
    \int d^D x_2
        \ket{ \bm{x}_2 }
        \bra{ \bm{x}_2 }
    \exp\left(
        \dfrac{1}{i\hbar}
        \int_{t_i + \delta t}
        ^{t_i + 2 \delta t}
        dt \hat{H}
    \right)
    \int d^D x_1
        \ket{ \bm{x}_1 }
\notag\\&\qquad
        \bra{ \bm{x}_1 }
    \exp\left(
        \dfrac{1}{i\hbar}
        \int_{t_i}
        ^{t_i + \delta t}
        dt \hat{H}
    \right)
    \ket{ \bm{x}_i }
\notag\\&=
    \left[
        \prod_{n=1}^{N-1}
        \int d^D x_n
    \right]
    \left[
        \prod_{m=0}^{N-1}
        \bra{ \bm{x}_{m+1} }
        \exp\left(
            \dfrac{1}{i\hbar}
            \int_{t_i + m \delta t}
            ^{t_i + (m+1) \delta t}
            dt \hat{H}
        \right)
        \ket{ \bm{x}_m }
    \right]
\end{align}
を考える。
ただし$x_0 := x_i,\ x_N := x_f$とした。
ここで、被積分関数に現れる因子
$\displaystyle
\bra{ \bm{x}_{m+1} }
    \exp\left(
        \dfrac{1}{i\hbar}
        \int_{t_i + m \delta t}
        ^{t_i + (m+1) \delta t}
        dt \hat{H}
    \right)
\ket{ \bm{x}_m }$
はbra-ketで挟まれており、
単なる複素数であるから、
積の順番を気にする必要はない。

また、$\hat{H}$が$t$に顕わに依存しない場合は
\begin{align}
    \exp\left(
        \dfrac{1}{i\hbar}
        \int_{t_i + m \delta t}
        ^{t_i + (m+1) \delta t}
        dt \hat{H}
    \right)
&=
    \exp\left(
        \dfrac{
            \delta t
        }{i\hbar}
        \hat{H}
    \right)
\end{align}
が成り立つが、
$t$に顕わに依存する場合でも
$N \to \infty$の極限では
$\delta t$は非常に小さいので、
上式が成り立つとして問題ないだろう。
このとき
\begin{align}
    K( t_f, \bm{x}_f ; t_i, \bm{x}_i )
    &=
    \lim_{ N \to \infty }
    \left[
        \prod_{n=1}^{N-1}
        \int d^D x_n
    \right]
    \left[
        \prod_{m=0}^{N-1}
        \bra{ \bm{x}_{m+1} }
        \exp\left(
            \dfrac{
                \delta t
            }{i\hbar}
            \hat{H}
        \right)
        \ket{ \bm{x}_m }
    \right]
\end{align}
を得る。
さて、運動量についても同様に完全系を挟んで
\begin{align}
    K( t_f, \bm{x}_f ; t_i, \bm{x}_i )
    &=
    \lim_{ N \to \infty }
    \left[
        \prod_{n=1}^{N-1}
        \int
            d^D x_n
    \right]
    \left[
        \prod_{m=0}^{N-1}
        \int d^D p_m
        \bra{ \bm{x}_{m+1} }
        \exp\left(
            \dfrac{
                \delta t
            }{i\hbar}
            \hat{H}
        \right)
        \ket{ \bm{p}_m }
        \braket{ \bm{p}_m | \bm{x}_m }
    \right]
\end{align}
となるが、
（非相対論的で、電磁場と相互作用のない粒子の）
Hamiltonianが
$H =
    \dfrac{ \bm{p}^2 }{ 2m }
    +
    V( \bm{x} )$
の形に書けていたことを思い出すと、
固有vectorに掛かるoperatorを
固有値で置き換えることが出来て
\begin{align}
    &
    \int d^D p_m
    \bra{ \bm{x}_{m+1} }
        \exp\left(
            \dfrac{
                \delta t
            }{i\hbar}
            \hat{H}
        \right)
    \ket{ \bm{p}_m }
    \braket{ \bm{p}_m | \bm{x}_m }
\notag\\&=
    \int d^D p_m
    \braket{ \bm{x}_{m+1} | \bm{p}_m }
    \exp\left[
        \dfrac{
            \delta t
        }{i\hbar}
        \left(
            \dfrac{ \bm{p}^2_m }{ 2m }
            +
            V( \bm{x}_{m+1} )        
        \right)
    \right]
    \braket{ \bm{p}_m | \bm{x}_m }
\notag\\&=
    \int
    \dfrac{ d^D p_m }{ (2 \pi \hbar)^{D} }
    \exp\left[
        \dfrac{ 1 }{i\hbar}
        \left\{
            \delta t
            \left(
                \dfrac{ \bm{p}^2_m }{ 2m }
            +
                V( \bm{x}_{m+1} )        
            \right)
            +
            \bm{p}_m \cdot
            \left(
                \bm{x}_{m}
                -
                \bm{x}_{m+1}
            \right)
        \right\}
    \right]
\end{align}
と分かる。
ここで
$\hat{\bm{p}}$の固有状態の$\bm{x}$-表示
(\ref{plain wave in qm})
を使った。
以上をまとめると
\begin{align}
    K( t_f, \bm{x}_f ; t_i, \bm{x}_i )
    =
    \lim_{ N \to \infty }
        \int
        \dfrac{ d^D p_0 }{ (2 \pi \hbar)^{D} }
    &
    \exp\left[
        \dfrac{ 1 }{i\hbar}
        \left\{
            \delta t
            \left(
                \dfrac{ \bm{p}^2_0 }{ 2m }
            +
                V( \bm{x}_{1} )
            \right)
            +
            \bm{p}_0 \cdot
            \left(
                \bm{x}_{0}
                -
                \bm{x}_{1}
            \right)
        \right\}
    \right]
\notag\\\times
    \prod_{n=1}^{N-1}
    \int
    \dfrac{ d^D x_n d^D p_n }{ (2 \pi \hbar)^{D} }
    &
    \exp\left[
        \dfrac{ 1 }{i\hbar}
        \left\{
            \delta t
            \left(
                \dfrac{ \bm{p}^2_n }{ 2m }
            +
                V( \bm{x}_{n+1} )
            \right)
            +
            \bm{p}_n \cdot
            \left(
                \bm{x}_{n}
                -
                \bm{x}_{n+1}
            \right)
        \right\}
    \right]
\end{align}
を得る。

この方法で
正準量子化で鬱陶しかった変数の非可換性は完全に除かれ、
$c$-数のみによる遷移振幅の表式を得たことになる。
この$p$と$x$の積分を含む表式の経路積分を
Hamiltonian経路積分という。

\subsubsection{Feynman Path Integral}

さて、Fresnel積分(\ref{fresnel integral})により
この$p$積分を実行することも出来て、
\begin{align}
    &\int
    \dfrac{ d^D p_n }{ (2 \pi \hbar)^{D} }
    \exp\left[
        \dfrac{ 1 }{i\hbar}
        \left\{
            \delta t
            \left(
                \dfrac{ \bm{p}^2_n }{ 2m }
            +
                V( \bm{x}_{n+1} )
            \right)
            +
            \bm{p}_n \cdot
            \left(
                \bm{x}_{n}
                -
                \bm{x}_{n+1}
            \right)
        \right\}
    \right]
\notag\\=
    &\int
    \dfrac{ d^D p_n }{ (2 \pi \hbar)^{D} }
    \exp\left[
        \dfrac{ \delta t }{i\hbar}
        \left(
            \dfrac{ \bm{p}^2_n }{ 2m }
        +
            V( \bm{x}_{n+1} )
        +
            \bm{p}_n \cdot
            \dfrac{ 1 }{\delta t}
            \left(
                \bm{x}_{n}
            -
                \bm{x}_{n+1}
            \right)
        \right)
    \right]
\notag\\=
    &\int
    \dfrac{ d^D p_n }{ (2 \pi \hbar)^{D} }
    \exp\left[
        - i
        \dfrac{ \delta t }{\hbar}
        \left(
            \dfrac{ 1 }{ 2m }
            \left\{
                \bm{p}_n
            +
                \dfrac{ m }{\delta t}
                \left(
                    \bm{x}_{n}
                -
                    \bm{x}_{n+1}
                \right)
            \right\}^2
        +
            V( \bm{x}_{n+1} )
        -
            \dfrac{ m }{2 \delta t^2}
            \left(
                \bm{x}_{n+1}
            -
                \bm{x}_{n}
            \right)^2
        \right)
    \right]
\notag\\=
    &
    \dfrac{ 1 }{ (2 \pi \hbar)^{D} }
    \left(
        \dfrac{2 \pi \hbar m}{ i \delta t }
    \right)^{\frac{D}{2}}
    \exp\left[
        \dfrac{ \delta t }{i\hbar}
        \left(
            V( \bm{x}_{n+1} )
            -
            \dfrac{ m }{2 \delta t^2}
            \left(
                \bm{x}_{n+1}
            -
                \bm{x}_{n}
            \right)^2                
        \right)
    \right]
\notag\\=
    &
    \left(
        \dfrac{m}{ 2 \pi i \hbar \delta t }
    \right)^{\frac{D}{2}}
    \exp\left[
        \dfrac{ i \delta t }{\hbar}
        \left(
            \dfrac{m}{2}
            \left[
                \dfrac{
                    \bm{x}_{n+1}
                -
                    \bm{x}_{n}    
                }{\delta t}
            \right]^2
        -
            V( \bm{x}_{n+1} )
        \right)
    \right]
\end{align}
からFeynman kernelの$x$積分のみの表式
\begin{align}
    K( t_f, \bm{x}_f ; t_i, \bm{x}_i )
    &=
    \lim_{ N \to \infty }
    \left[
        \prod_{n=1}^{N-1}
        \int d^D x_n
    \right]
\notag\\&\qquad
    \prod_{n=0}^{N-1}
    \left(
        \dfrac{m}{ 2 \pi i \hbar \delta t }
    \right)^{\frac{D}{2}}
    \exp\left[
        \dfrac{ i \delta t }{\hbar}
        \left(
            \dfrac{m}{2}
            \left[
                \dfrac{
                    \bm{x}_{n+1}
                -
                    \bm{x}_{n}    
                }{\delta t}
            \right]^2
        -
            V( \bm{x}_{n+1} )
        \right)
    \right]
\notag\\&=
    \lim_{ N \to \infty }
    \left(
        \dfrac{m}{ 2 \pi i \hbar \delta t }
    \right)^{\frac{D}{2}}
    \left[
        \prod_{n=1}^{N-1}
        \int
        d^D x_n
        \sqrt{
            \dfrac{m}{2 \pi i \hbar \delta t}
        }
    \right]
\notag\\&\qquad
    \prod_{n=0}^{N-1}
    \exp\left[
        \dfrac{ i \delta t }{\hbar}
        \left(
            \dfrac{m}{2}
            \left[
                \dfrac{
                    \bm{x}_{n+1}
                -
                    \bm{x}_{n}    
                }{\delta t}
            \right]^2
        -
            V( \bm{x}_{n+1} )
        \right)
    \right]
\end{align}
が得られる。
測度
$d^D x_n
\sqrt{
    \dfrac{m}{2 \pi i \hbar \delta t}
}
$
は無次元であり、
位置についての確率密度を与える
Feynman kernelは、全体としては
$(\text{長さ})^{-D}$の次元を持っている。
$p$についての積分を済ませてしまった場合の
この表示をLagrangian経路積分や
Feynman経路積分と呼ぶ。

\subsubsection{Path Integralの実行}

さて、さらに計算を進める上で、
もし$x_{m+1} - x_{m}$が有限の大きさを
持っていたらどうなるだろうか。
$N$を無限大に飛ばす極限で
$\delta t$は$0$になるから、
$
    \dfrac{m}{2}
    \left[
        \dfrac{
            \bm{x}_{m+1} - \bm{x}_{m}
        }{\delta t}
    \right]^2
$
という項は非常に大きくなってしまう。
これに係数$i$が掛かって
指数関数の肩に乗っているのだから、
被積分関数は$N \to \infty$の極限で
非常に激しく振動してしまい、
積分値は$0$となるだろう
（Riemann-Lebesgue lemmaを想像して欲しい）。

よって$\bm{x}_{m+1} - \bm{x}_{m}$
が有限の大きさを持つような場合は
積分値に寄与せず、
$\bm{x}_{m+1} - \bm{x}_{m}$が無限小、
$
    \dfrac{m}{2}
    \left[
        \dfrac{
            \bm{x}_{m+1} - \bm{x}_{m}
        }{\delta t}
    \right]^2
$
が有限の場合のみを考えなければいけないことが分かる。
$\bm{x}_{m}$はただの完全系展開のparameterであったので、
本来は時間変数$t$とは全く関係がない筈なのだが、
この観点に加えて
$\bm{x}_{m}$の完全系が時刻
$t = t_i + m \delta t$
の位置に挿入されていたことを思い出すと、
$\bm{x}_{m}$を
時間$t = t_i + m \delta t$の連続関数
$\bm{x}(t)$と見做し、
$\dfrac{
    \bm{x}_{m+1} - \bm{x}_{m}
}{\delta t}
$を
$\bm{x}(t)$の時間微分$\dot{\bm{x}}$
と見做すこともやぶさかではない筈だ。
古典的に作用を無限大にする
（kinetic energyが無限大となる）ような経路は、
量子論的にも禁じられるのである。

同様に、$V(\bm{x}_{m})$も
時間変数$t$の滑らかな関数である$\bm{x}(t)$
に対して定義された関数$V(\bm{x}(t))$
であると思うことが出来る。
$V$が$\bm{x}_{m}$と$\bm{x}_{m+1}$に対して
非対称に定義されていることが気になる場合は、
$\bm{p}$の完全系を挟むより前に
potentialを
$V = \dfrac{1}{2} V + \dfrac{1}{2} V $
のように半分に分け、
一方の項だけ
中の演算子を
$\dfrac{1}{2}V(\bm{x}_{m})$
と固有値に置き換えてしまえばよい。

あるいは、
正準交換関係をうまく使って
演算子の積の順番を変えることができる。
特に、Weyl順序と呼ばれる演算子順序を取ることで
$V(\bm{x}) := V
\left(
    \dfrac{ \bm{x}_m + \bm{x}_{m+1} }{2}
\right)$
となるように$V$を定義することが出来る。
これを中点処方と言い、
$N \to \infty$
の連続極限を考える上では最も自然な定義だと言える。
fermionの場合には
正規順序や反正規順序を取っても良い。

$\bm{x}$が$t$の連続関数だと思うと
\begin{align}
    &
    \prod_{n=0}^{N-1}
    \exp\left[
        \dfrac{ i \delta t }{\hbar}
        \left(
            \dfrac{m}{2}
            \left[
                \dfrac{
                    \bm{x}_{n+1}
                -
                    \bm{x}_{n}    
                }{\delta t}
            \right]^2
        -
            V( \bm{x}_{n+1} )
        \right)
    \right]
\notag\\&=
    \exp\left[
        \sum_{n=0}^{N-1}
        \dfrac{ i \delta t }{\hbar}
        \left(
            \dfrac{m}{2}
            \dot{ \bm{x} }^2
        -
            V( \bm{x} )
        \right)
    \right]
\notag\\&=
    \exp\left[
        \dfrac{ i }{\hbar}
        \int_{t_i}^{t_f} dt
        L
    \right]
\notag\\&=
    \exp\left(\dfrac{i}{\hbar}S \right)
\end{align}
のように変形が出来るから、
Feynman kernelは
\begin{align}
    K( t_f, \bm{x}_f ; t_i, \bm{x}_i )
    &=
    \lim_{ N \to \infty }
    \left(
        \dfrac{m}{ 2 \pi i \hbar \delta t }
    \right)^{\frac{D}{2}}
    \left[
        \prod_{n=1}^{N-1}
        \int
        d^D x_n
        \sqrt{
            \dfrac{m}{2 \pi i \hbar \delta t}
        }
    \right]
    \exp\left(\dfrac{i}{\hbar}S \right)
\notag\\&
    =:
    \int_{\bm{x}(t_i) = \bm{x}_i}
        ^{\bm{x}(t_f) = \bm{x}_f}
        \mathcal{D} x(t)
    \exp\left(\dfrac{i}{\hbar}S \right)
\label{path integral representation of feynman kernel}
\end{align}
のように書ける。
ここでもちろん、$L, S$はそれぞれ
古典的Lagrangianと作用である。

結局、経路積分により系の時間発展を求めるには、
時間の連続関数
$\bm{x}(t)$のうち、
境界条件$t = t_i, t_f$で
$\bm{x} = \bm{x}_f, \bm{x}_f$
を満たす全てに渡って
因子$\exp\left(\dfrac{i}{\hbar}S \right)$
を足し上げればよいということが分かる。

\subsubsection{調和振動子の例}
\label{classical analysis of harmonic oscillator}

source項$qJ$を持つ$1$次元調和振動子のLagrangian
\begin{align}
    L_{cl}
    &:=
    \frac{1}{2}m\dot{q}^2
    -
    \frac{1}{2}m\omega^2q^2
    +
    qJ(t)
\label{harmonic oscillator lagrangian with source}
\end{align}
を考える
（source項を導入する御利益については
\ref{with source term}で説明する。
普通の調和振動子に戻るには単に
$J(t) = 0$の場合を考えればよい）。
対応する古典運動方程式は
\begin{align}
    0
    &=
    \frac{d}{dt}
    \frac{\partial L_{cl}}{\partial \dot{q}}
    -
    \frac{\partial L_{cl}}{\partial q}
\notag\\&=
    \frac{d}{dt}
    \left(
        m\dot{q}
    \right)
    -
    \left(
        -
        m\omega^2q
        +
        J(t)
    \right)
\notag\\&=
    m\ddot{q}
    +
    m\omega^2q
    -
    J(t)
\end{align}
なので、
斉次方程式$0 = m \ddot{q} + m \omega^2 q$
の一般解
$q(t) = A \sin \omega (t - \alpha)$
に
特別解$\displaystyle
    q(t) = \int_{t_i}^t
    d\tau
    \dfrac{ \sin \omega (t-\tau) }{
        m \omega
    }
    J(\tau)
$
\footnote{
    これは
    \begin{align}
        \dot{q}
    &=
        \dfrac{ \sin \omega (t-t) }{ m \omega }
        J(t)
        +
        \int_{t_i}^t d\tau
            \dfrac{ \cos \omega (t-\tau) }{ m }
            J(\tau)
    =
        \int_{t_i}^t d\tau
            \dfrac{ \cos \omega (t-\tau) }{ m }
            J(\tau)
    \end{align}
    より
    \begin{align}
        \ddot{q}
        &=
        \dfrac{ \cos \omega (t-t) }{ m }
        J(t)
        +
        \int_{t_i}^t d\tau
        \dfrac{ - \omega \sin \omega (t-\tau) }{m}
        J(\tau)
    \notag\\&=
        \dfrac{J(t)}{m}
        -
        \omega^2\int_{t_i}^t d\tau
        \dfrac{ \sin \omega (t-\tau) }{m \omega}
        J(\tau)
    \notag\\&=
        \dfrac{ J(t) }{m}
        -
        \omega^2 q
    \end{align}
    を確かに満たす。
}
を足して、一般解は
\begin{align}
    q_{cl}(t)
    &=
    A \sin \omega (t-\alpha)
    +
    \int_{t_i}^t d\tau
    \dfrac{ \sin \omega (t-\tau) }{m\omega}
    J(\tau)
\end{align}
と与えられる。

振動子が$t=t_i$で位置$q=q_i$、
$t=t_f$で位置$q=q_f$にあったならば、
定数$A, \alpha$を求めて
\begin{align}
    q_{cl}(t)
    &=
    \frac{
        q_f \sin \omega (t - t_i)
        +
        q_i \sin \omega (t_f - t)
    }{ \sin \omega (t_f - t_i) }
    -
    \frac{ \sin \omega (t - t_i) }{
        \sin \omega(t_f - t_i)
    }
    \int_{t_i}^{t_f} d\tau
    \frac{ \sin \omega (t_f-\tau) }{m\omega}
    J(\tau)
\notag\\&\qquad
    +
    \int_{t_i}^t d\tau
    \frac{ \sin \omega (t-\tau)}{m\omega}
    J(\tau)
\label{classical solution to harmonic oscillator with source}
\end{align}
と書けることが分かる。
右辺の$\sin\omega(t_f - t)$は
角の合成の逆を使って
$a \sin \omega(t - t_i) + b \cos \omega(t - t_i)$
の形に分解できるので、
第$1, 2$項の和は角の合成により$A\sin\omega (t-\alpha)$の形で書けるためである。

さて、この系を経路積分で量子化し、
Feynman kernelを求めることを考える。
新しい変数として古典解からのずれ
$x := q - q_{cl}$
を導入すると話が簡単になる。
$x$は$t=t_i, t_f$でそれぞれ$x=0$を満たし、
$x$で書き直したLagrangianは
\begin{align}
    L
    &:=
    \frac{1}{2}m
    \left[
        \frac{d(q_{cl}+x)}{dt}
    \right]^2
    -
    \frac{1}{2}m\omega^2(
        q_{cl} + x
    )^2
    +
    (
        q_{cl} + x
    )
    J(t)
\notag\\&=
    \frac{1}{2}m
    \dot{q}_{cl}^2
    -
    \frac{1}{2}m\omega^2
        q_{cl}^2
    +
        q_{cl}
        J(t)
    +
    \frac{1}{2}m(
        2 \dot{q}_{cl} \dot{x}
        +
        \dot{x}^2
    )
    -
    \frac{1}{2}m\omega^2(
        2q_{cl}x + x^2
    )
    +
    xJ(t)
\notag\\&=
    L_{cl}
    +
    \left(
        \frac{1}{2}m
        \dot{x}^2
        -
        \frac{1}{2}m
        \omega^2x^2
    \right)
    +
    \left(
        m\dot{q}_{cl} \dot{x}
        -
        m\omega^2 q_{cl}
        x + x J(t)
    \right)
\end{align}
のようになる。
ここで、作用
\begin{align}
    S
    &:=
    \int_{t_i}^{t_f}dt\ L
\notag\\&=
    S_{cl} [J]
    +
    \int_{t_i}^{t_f} dt
    \left(
        \frac{1}{2} m \dot{x}^2
        -
        \frac{1}{2} m \omega^2 x^2
    \right)
    +
    \int_{t_i}^{t_f}dt
    \left(
        m \dot{q}_{cl} \dot{x}
        -
        m\omega^2q_{cl} x
        +
        xJ(t)
    \right)
\end{align}
は境界条件（$x$は$t=t_i, t_f$でそれぞれ$x=0$）より部分積分
\begin{align}
    \int_{t_i}^{t_f}dt
    \left(
        m\dot{q}_{cl} \dot{x}
    \right)
&=
    \bigg[
        m \dot{q}_{cl} x
    \bigg]_{t=t_i}^{t=t_f}
    -
    \int_{t_i}^{t_f} dt
    \left(
        m \ddot{q}_{cl} x
    \right)
=
    -
    \int_{t_i}^{t_f} dt
    \left(
        m \ddot{q}_{cl} x
    \right)
\end{align}
できて、
$q_{cl}$が運動方程式
$0 = m \ddot{q}_{cl} + m \omega^2 q_{cl} - J(t)$
を満たすことより
\begin{align}
    S
    &=
    S_{cl} [J]
    +
    \int_{t_i}^{t_f} dt
    \left(
        \frac{1}{2} m \dot{x}^2
        -
        \frac{1}{2} m \omega^2 x^2
    \right)
    -
    \int_{t_i}^{t_f} dt
    \left(
        m \ddot{q}_{cl}
        +
        m \omega^2 q_{cl}
        -
        J(t)
    \right)
    x
\notag\\&=
    S_{cl} [J]
    +
    \frac{1}{2} m
    \int_{t_i}^{t_f} dt
    \left(
        \dot{x}^2
        -
        \omega^2 x^2
    \right)
\end{align}
と書き直せ、
さらに古典解
(\ref{classical solution to harmonic oscillator with source})
の時間微分
\begin{align}
    \dot{q}_{cl}(t)
    &=
    \omega
    \frac{
        q_f \cos \omega (t - t_i)
        -
        q_i \cos \omega (t_f - t)
    }{ \sin \omega (t_f - t_i) }
    -
    \omega
    \frac{ \cos \omega (t - t_i) }{
        \sin \omega(t_f - t_i)
    }
    \int_{t_i}^{t_f} d\tau
    \frac{ \sin \omega (t_f-\tau) }{m\omega}
    J(\tau)
\notag\\&\qquad
    +
    \omega
    \int_{t_i}^t d\tau
    \frac{ \cos \omega (t-\tau)}{m\omega}
    J(\tau)
\notag\\&=
    \frac{ \omega }{ \sin \omega (t_f - t_i) }
    \left[
    \left(
        q_f
    -
        \int_{t_i}^{t_f} d\tau
        \frac{ \sin \omega (t_f-\tau) }{m\omega}
        J(\tau)
    \right)
    \cos \omega (t - t_i)
    -
        q_i \cos \omega (t_f - t)
    \right]
\notag\\&\qquad
    +
    \int_{t_i}^t d\tau
    \frac{ \cos \omega (t-\tau)}{m}
    J(\tau)
\label{time derivative of classical solution of harm osci with source}
\end{align}
すなわち
\begin{subequations}
\begin{align}
    \dot{q}_{cl} (t_i)
    &=
    \dfrac{ \omega }{ \sin \omega (t_f - t_i) }
    \left[
    \left(
        q_f
    -
        \int_{t_i}^{t_f} d\tau
        \frac{ \sin \omega (t_f-\tau) }{m\omega}
        J(\tau)
    \right)
    -
        q_i \cos \omega (t_f - t_i)
    \right]
\\
    \dot{q}_{cl} (t_f)
    &=
    \frac{ \omega }{ \sin \omega (t_f - t_i) }
    \left[
    \left(
        q_f
   - 
        \int_{t_i}^{t_f} d\tau
        \frac{ \sin \omega (t_f-\tau) }{m\omega}
        J(\tau)
    \right)
    \cos \omega (t_f - t_i)
    -
        q_i
    \right]
\notag\\&\qquad
    +
    \int_{t_i}^{t_f} d\tau
    \frac{ \cos \omega (t_f - \tau)}{m}
    J(\tau)
\end{align}
\label{boundary value of time derivative of classical solution of harm osci with source}
\end{subequations}
を使って
$S_{cl} [J]$の部分も
\begin{align}
    S_{cl} [J]
    &=
    \int_{t_i}^{t_f} dt
    \left[
        \frac{1}{2}m
        \dot{q}_{cl}^2
    -
        \frac{1}{2} m \omega^2
        q_{cl}^2
    +
        q_{cl}
        J(t)
    \right]
\notag\\&=
    \left[
        \frac{1}{2}m
        q_{cl}
        \dot{q}_{cl}
    \right]_{t_i}^{t_f}
    +
    \int_{t_i}^{t_f} dt\ 
    q_{cl}
    \left[
    -
        \frac{1}{2} m
        \ddot{q}_{cl}
    -
        \frac{1}{2} m \omega^2
        q_{cl}
    +
        J(t)
    \right]
\notag\\&=
    \frac{1}{2} m
    \bigg(
        q_f
        \dot{q}_{cl}(t_f)
    -
        q_i
        \dot{q}_{cl}(t_i)
    \bigg)
    +
    \int_{t_i}^{t_f} dt\ 
        q_{cl}
        \frac{1}{2}
        J(t)
\label{classical action of harm osci with source}
\end{align}
と計算できる。

求めるFeynman kernelの経路積分表示は
\begin{align}
    K[J]( t_f, q_f ; t_i, q_i )
    &=
    \int_{q(t_i) = q_i}^{q(t_f) = q_f}
        \mathcal{D} q(t)
    \exp\left(
        \dfrac{i}{\hbar} S
    \right)
\notag\\&=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
    \int_{x(t_i) = 0}^{x(t_f) = 0}
        \mathcal{D} x(t)
    \exp\left(
        -
        \dfrac{ i }{\hbar}
        \int_{t_i}^{t_f} dt\ 
        x
        \dfrac{ m }{2}
        \left[
            \left(
                \dfrac{d}{dt}
            \right)^2
            +
            \omega^2
        \right]
        x
    \right)
\label{harmonic oscillator action operator matrix}
\end{align}
となるが、
operator $
    \dfrac{ m }{2}
    \left[
    \left(
        \dfrac{d}{dt}
    \right)^2
+
    \omega^2
    \right]
$の固有関数
\begin{align}
    \dfrac{ m }{2}
    \left[
        \left(
            \dfrac{d}{dt}
        \right)^2
        +
        \omega^2
    \right]
    \phi_n(t)
    =
    \lambda_n
    \phi_n(t)
\end{align}
であって
境界条件$x(t_i) = 0, x(t_f) = 0$を満たすものは
\begin{align}
    \phi_n(t)
    &=
    \sqrt{ 
        \dfrac{
            2
        }{
            t_f - t_i
        }
    }
    \sin \omega_n (t - t_i)
    ,
    &&
    \omega_n
    =
    \dfrac{n \pi}{t_f - t_i}
    &&
    (n = 1, 2, \dots)
    &&
    \lambda_n
    =
    \dfrac{ m }{2}
    (
        \omega^2
    -
        \omega_n^2
    )
\end{align}
であるので、これで$x(t)$を展開し
\begin{align}
    x(t)
    =
    a_n
    \phi_n(t)
\end{align}
と書こう。
明らかに
\begin{align}
    \int_{t_i}^{t_f} dt\ 
    x
    \dfrac{ m }{2}
    \left[
        \left(
            \dfrac{d}{dt}
        \right)^2
        +
        \omega^2
    \right]
    x
    &=
    \sum_{n,m}
    \int_{t_i}^{t_f} dt\ 
    a_n \phi_n
    \bigg[
        \lambda_m
    \bigg]
    a_m \phi_m
\notag\\&=
    \sum_{n,m}
        a_n a_m
        \lambda_m
    \int_{t_i}^{t_f} dt\ 
    \phi_n
    \phi_m
\notag\\&=
    \sum_{n,m}
        a_n a_m
        \lambda_m
    \delta_{nm}
    =
    \sum_{n}
    a_n^2
    \lambda_n
\end{align}
より、
任意の関数についての積分は、
この係数$a_n$についてのFresnel積分
(\ref{fresnel integral})
\begin{align}
    K[J]( t_f, q_f ; t_i, q_i )
    &=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
        \dfrac{ \partial ( x(t) ) }
            { \partial (a_n) }
    \prod_{n=1}^\infty
    \left[
        \int d a_n
    \right]
    \exp\left(
        -
        \dfrac{ i }{\hbar}
        \sum_{n}
        a_n^2
        \lambda_n
    \right)
\notag\\&=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
        \dfrac{ \partial ( x(t) ) }
            { \partial (a_n) }
    \prod_{n=1}^\infty
    \left[
        \int d a_n
        \exp\left(
            -
            \dfrac{ i }{\hbar}
            a_n^2
            \lambda_n
        \right)
    \right]
\notag\\&=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
        \dfrac{ \partial ( x(t) ) }
            { \partial (a_n) }
    \prod_{n=1}^\infty
    \sqrt{
        \dfrac{\pi \hbar}{i \lambda_n}
    }
\notag\\&=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
        \dfrac{ \partial ( x(t) ) }
            { \partial (a_n) }
    \sqrt{
        \prod_{n=1}^\infty
        \dfrac{2 \pi i \hbar}{
            m \omega_n^2 \left(
                1 - \dfrac{ \omega^2 }{ \omega_n^2 }
            \right)
        }
    }
\end{align}
として実現できるだろう。
ここで$\dfrac{ \partial ( x(t) ) }{ \partial (a_n) }$は
$x(t)$から$a_n$への変数変換による
Jacobianである。
さて、公式
(\ref{infinite product of sine})
より
\begin{align}
    \prod_{n=1}^\infty
    \left(
        1 - \dfrac{ \omega^2 }{ \omega_n^2 }
    \right)
    =
    \prod_{n=1}^\infty
    \left(
        1
        -
        \dfrac{
            \omega^2 (t_f - t_i)^2
        }{ \pi^2 n^2 }
    \right)
    =
    \dfrac{
        \sin \omega (t_f - t_i)
    }{ \omega (t_f - t_i) }
\end{align}
であるので、
\begin{align}
    K[J]( t_f, q_f ; t_i, q_i )
    &=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
        \dfrac{ \partial ( x(t) ) }
            { \partial (a_n) }
    \sqrt{
        \dfrac{
            \omega (t_f - t_i)
        }{
            \sin \omega (t_f - t_i)
        }
        \prod_{n=1}^\infty
        \dfrac{
            2 \pi i \hbar
        }{
            m \omega_n^2
        }
    }
\end{align}
を得る。

最後に$\dfrac{ \partial ( x(t) ) }{ \partial (a_n) }$
を求める。
明らかに
$\dfrac{ \partial ( x(t) ) }{ \partial (a_n) }$
は$J(t)$にも$\omega$にもよらないので、
$J(t) = 0, \omega = 0$の場合の
$\dfrac{ \partial ( x(t) ) }{ \partial (a_n) }$
を求めればよい。
classical action
(\ref{classical action of harm osci with source})
が$J(t) = 0$で消えることに気を付けると、
$\omega = 0$のFeynman kernelは自由粒子のそれ
(\ref{feynman kernel for free particle})
で境界条件を$x_i = x_f = 0$と置いたもの
（$\dfrac{ \partial ( x(t) ) }{ \partial (a_n) }$は
$q_i, q_f$とは関係ない事に注意しよう。
どのような$q_i, q_f$に対しても、
$x(t)$の定義は必ず$x_i = x_f = 0$を与える）
に一致しなければならないので
\begin{align}
    \dfrac{ \partial ( x(t) ) }{ \partial (a_n) }
    \sqrt{
        \prod_{n=1}^\infty
        \dfrac{
            2 \pi i \hbar
        }{
            m \omega_n^2
        }
    }
    =
    \left(
        \dfrac{ m }{ 2 \pi i \hbar ( t_f - t_i ) }
    \right)^{\frac{1}{2}}
    \exp\left(
        -
        \dfrac{ m }{ 2 i \hbar (t - t_i) }
        (x_f - x_i)^2
    \right)
    =
    \left(
        \dfrac{ m }{ 2 \pi i \hbar ( t_f - t_i ) }
    \right)^{\frac{1}{2}}
\end{align}
と求まり、
結局調和振動子のFeynman kernelは
\begin{align}
    K[J]( t_f, q_f ; t_i, q_i )
    &=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
    \sqrt{
        \dfrac{
            \omega (t_f - t_i)
        }{
            \sin \omega (t_f - t_i)
        }
    }
    \left(
        \dfrac{ m }{ 2 \pi i \hbar ( t - t_i ) }
    \right)^{\frac{1}{2}}
\notag\\&=
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
    \left(
        \dfrac{ 
            m \omega
        }{
            2 \pi i \hbar
            \sin \omega (t_f - t_i)
        }
    \right)^{\frac{1}{2}}
\label{feynman kernel of harmonic oscillator with source}
\end{align}
である。

\subsubsection{Euclidean経路積分}

どのような経路が経路積分に寄与するかについて、
上ではRiemann-Lebesgue lemmaなど持ち出して
怪しい議論をしたが、
虚時間$\tau := i t$を導入することで
もう少し厳密な議論が可能となる。
Euclid化されたLagrangianと作用を
\begin{subequations}
\begin{align}
    L_E
    &:=
    - L \Big|_{t = - i \tau}
    =
    \left(
        \dfrac{ d q }{ d \tau }
    \right)^2
    +
    V(q)
\\
    S
    &=
    \int dt L
    =
    i \int d\tau L_E
    =: i S_E
\end{align}
\end{subequations}
としておくと、
Feynman kernelの経路積分は
\begin{align}
    K( t_f, q_f ; t_i, q_i )
    &=
    \int_{q(t_i) = q_i}^{q(t_f) = q_f}
        \mathcal{D} q(t)
    \exp\left(
        \dfrac{i}{\hbar} S
    \right)
=
    \int_{q(t_i) = q_i}^{q(t_f) = q_f}
        \mathcal{D} q(t)
    \exp\left(
        -
        \dfrac{ S_E }{\hbar}
    \right)
\end{align}
となり、potentialが$q$の$2$次以上なら
Gaussian積分より早く収束するため、
数学的に厳密に定義できる。

実時間$t$から虚時間$\tau = i t$へ移ることを指して
Wick rotation（Wick回転）という言うこともある。
Feynman kernelが$t_f - t_i$の解析関数ならば
Wick回転は一種の解析接続と考えることが出来るが、
多くの場合には実時間$t$での経路積分がそもそも実行可能でないため、
虚時間における経路積分によって実時間での量子力学が定められていると考えたほうが良い。

\subsubsection{Euclidean Feynman Kernel、
    時間発展、
    分配関数、
    統計力学系との関係
}

さて、operator formalismでFeynman kernelを見てみよう。
(\ref{feynman kernel w.r.t. wave function complete set})
と同じことを波動関数ではなく状態vectorの完全系で行っても
\begin{align}
    K(t + t_i, \bm{x}; t_i, \bm{x}_i)
    &=
    \bra{ \bm{x} }
        \hat{U} (t + t_i, t_i)
    \ket{ \bm{x}_i }
    =
    \bra{ \bm{x} }
        \sum_n
            \ket{n}
            \bra{n}
        \exp(
            \dfrac{ t }{ i \hbar }
            \hat{ H }
        )
    \ket{ \bm{x}_i }
\notag\\&
    =
    \sum_n
    \psi_n( \bm{x} )
        \exp(
            \dfrac{ t }{ i \hbar }
            E_n
        )
    \psi_n^*( \bm{x}_i )
\end{align}
と当然同じ結果を与えるが、
ここで虚時間$\tau = i t$に移ると何が起こるだろうか。
\begin{align}
    K(t + t_i, \bm{x}; t_i, \bm{x}_i)
    &=
    \sum_n
    \psi_n( \bm{x} )
        \exp(
            -
            \dfrac{ \tau }{ \hbar }
            E_n
        )
    \psi_n^*( \bm{x}_i )
    =:
    K_E ( \tau; \bm{x}, \bm{x}_i )
\end{align}
となり、時間発展$t \to \infty$と共に
基底状態$ E = E_0 $以外Feynman kernelへの寄与は
指数関数的に小さくなることが分かる。

特に興味がある量の一つは
分配関数（canonical partition function）$Z$で、
虚時間$\tau$とBoltzmann constant $k_B$を使って
温度$T := \dfrac{\hbar}{k_B \tau}$
及び
逆温度$ \beta := \dfrac{1}{k_B T}
= \dfrac{\tau}{\hbar} $
を定義することにより
\begin{align}
    Z( \beta )
    &:=
    \tr
    \hat{U} (t + t_i, t_i)
    =
    \int d^D x
    \bra{ \bm{x} }
        \hat{U} (t + t_i, t_i)
    \ket{ \bm{x} }
\notag\\&
    =
    \sum_n
    \int d^D x
    \braket{ \bm{x} | n }
        \exp(
            -
            \dfrac{ \tau }{ \hbar }
            E_n
        )
    \braket{ n | \bm{x} }
\notag\\&
    =
    \int d^D x
    K_E ( \tau; \bm{x}_f = \bm{x},
        \bm{x}_i = \bm{x} )
\label{P.B.C. path int and partition function}
\end{align}
と定義される。
周期的境界条件（periodic boundary condition、P.B.C.）
$\bm{x}_f = \bm{x}(t_f) = \bm{x}(t_i) = \bm{x}_i$
を課して
時間$\tau$だけ時間発展させたFeynman kernelの空間積分が
逆温度$\beta = \dfrac{\tau}{\hbar}$での
canonical ensemble（カノニカル分布）
分配関数と一致する事が見て取れる。
もちろん
他の表式ではFeynman kernelとの関係を見にくいというだけで、
空間的に周期境界条件が課されていることを
明示することに拘らなければ、
最初から
Hamiltonianの固有状態を使ってtraceを取ることで
\begin{align}
    Z( \beta )
    &=
    \tr
        \exp(
            - \beta \hat{H}
        )
    =
    \sum_n
    \bra{n}
        \exp(
            -
            \beta E_n
        )
    \ket{n}
    =
    \sum_n
    \exp(
        -
        \beta E_n
    )
\end{align}
のように書くこともできる。
この意味で、Hamiltonian $\hat{H}$と
虚時間周期$\tau$を持つ
量子力学系の時間発展を求めることと、
同じHamiltonian $\hat{H}$を持ち
逆温度$\beta = \dfrac{\tau}{\hbar}$の熱浴に接した
有限温度統計力学系のcanonical分配関数を求めることは
実は等価である。
このため、量子力学系で無限に長い時間
$t \to \infty$の時間発展を考えることを
ゼロ温度極限（zero-temperature limit）と言ったり、
逆に周期境界条件を課して有限時間だけ時間発展させた系を
有限温度系（finite-temperature system）と言ったりする。
この文脈では、
自由energy（Helmholtz free energy）
\begin{align}
    F
    :=
    -
    \dfrac{1}{\beta}
        \log Z
\end{align}
や内部energy（internal energy）
\begin{align}
    U
    &:=
    \dfrac{\partial}
        { \partial \beta }
        ( \beta F )
    =
    -
    \dfrac{\partial}
        { \partial \beta }
        \log Z
    =
    k_B T^2
    \dfrac{\partial}
        { \partial T }
        \log Z
\notag\\&
    =
    -
    \dfrac{1}{Z}
    \dfrac{\partial}{\partial \beta}
    \sum_n
    \exp(
        -
        \beta E_n
    )
    =
    -
    \dfrac{1}{Z}
    \sum_n
    E_n
    \exp(
        -
        \beta E_n
    )
\end{align}
あるいは、
およそcanonical ensemble統計力学に対して定義できる
全ての熱力学量
\begin{subequations}
\begin{align}
    S &:= - \dfrac{\partial F}{\partial T}
        \bigg|_V
    &&\text{エントロピー（entropy）}
\\
    P &:= - \dfrac{\partial F}{\partial V}
        \bigg|_T
    &&\text{圧力（pressure）}
\\
    C_V &:= \dfrac{\partial U}{\partial T}
        \bigg|_V
    =
    \dfrac{\partial }{\partial T}
    \left[
        k_B T^2
        \dfrac{\partial}
            { \partial T }
            \log Z
    \right]_V
\notag\\&
    =
    T \dfrac{\partial S}{\partial T}
        \bigg|_V
    &&\text{定積比熱（specific heat at constant volume）}
\end{align}
\end{subequations}
などを量子系に対して定義することができる。
ここで$V$はもちろん、粒子が存在できる空間の体積である。
特に、ゼロ温度極限$\tau \to \infty$で
内部energy $U$が基底energy $E_0$に近づく事は重要だろう。

\subsubsection{Generating FunctionalとSource Term}
\label{with source term}

与えられた始状態$\ket{ \phi_I }$
と
終状態$\ket{ \phi_F }$に対し、
生成汎関数（generating functional）
$W_{FI}[J](t)$を
source付きのFeynman kernel
$K[J](t_i + t, \bm{x}; t_i, \bm{x}_i)$を用いて
\begin{align}
    W_{FI}[J](t)
    :=
    \int d^D x_f d^D x_i\ 
        \phi_F^*( t_i + t, \bm{x}_f)
        \phi_I  ( t_i    , \bm{x}_i)
        K[J](t_i + t, \bm{x}_f; t_i, \bm{x}_i)
\end{align}
と定義する。
Feynman kernelを用いた遷移振幅の表式
(\ref{transition amplitude with feynman kernel})
と見比べることで、
特に$J(t)=0$と置いた場合には
時間$t$で始状態$\phi_I$から終状態$\phi_F$へ遷移する
確率振幅
$W_{FI}[J=0](t) = A_{FI}(t)$と
解釈できることが分かるだろう。

調和振動子の場合にはsource付きのFeynman kernelを
(\ref{feynman kernel of harmonic oscillator with source})
で求めていた。
これを使ってゼロ温度極限$t \to \infty$での
真空から真空への遷移に関する生成汎関数
\begin{align}
    W[J]
    :=
    \lim_{t \to \infty}
    W_{00}[J](t)
\end{align}
を求めよう。
まず、古典解
(\ref{classical solution to harmonic oscillator with source})
\begin{align}
    q_{cl}(t)
    &=
    \frac{
        q_f \sin \omega (t - t_i)
        +
        q_i \sin \omega (t_f - t)
    }{ \sin \omega (t_f - t_i) }
    -
    \frac{ \sin \omega (t - t_i) }{
        \sin \omega(t_f - t_i)
    }
    \int_{t_i}^{t_f} d\tau
    \frac{ \sin \omega (t_f-\tau) }{m\omega}
    J(\tau)
\notag\\&\qquad
    +
    \int_{t_i}^t d\tau
    \frac{ \sin \omega (t-\tau)}{m\omega}
    J(\tau)
\end{align}
およびその時間微分
(\ref{boundary value of time derivative of classical solution of harm osci with source})
\begin{subequations}
\begin{align}
    \dot{q}_{cl} (t_i)
    &=
    \dfrac{ \omega }{ \sin \omega t }
    \left[
    \left(
        q_f
    -
        \int_{t_i}^{t_i + t} d\tau
        \frac{ \sin \omega (t_i + t - \tau) }{m\omega}
        J(\tau)
    \right)
    -
        q_i \cos \omega t
    \right]
\\
    \dot{q}_{cl} (t_f = t_i + t)
    &=
    \frac{ \omega }{ \sin \omega t }
    \left[
    \left(
        q_f
    -
        \int_{t_i}^{t_i + t} d\tau
        \frac{ \sin \omega (t_i + t - \tau) }{m\omega}
        J(\tau)
    \right)
    \cos \omega t
    -
        q_i
    \right]
\notag\\&\qquad
    +
    \int_{t_i}^{t_i + t} d\tau
    \frac{ \cos \omega (t_i + t - \tau)}{m}
    J(\tau)
\end{align}
\end{subequations}
を古典的作用
(\ref{classical action of harm osci with source})
に代入すると、
\begin{align}
    S_{cl} [J]
    &=
    \frac{1}{2} m
    \bigg(
        q_f
        \dot{q}_{cl}(t_f)
    -
        q_i
        \dot{q}_{cl}(t_i)
    \bigg)
    +
    \int_{t_i}^{t_i + t} d\tau\ 
        q_{cl}(\tau)
        \frac{1}{2}
        J(\tau)
\notag\\&
    =
    \frac{1}{2}
    \frac{ m \omega }{ \sin \omega t }
    \bigg(
        q_f
        \left[
            \left(
                q_f
            -
                \int_{t_i}^{t_i + t} d\tau
                \frac{ \sin \omega (t_i + t - \tau) }{m\omega}
                J(\tau)
            \right)
            \cos \omega t
        -
            q_i
        \right]
\notag\\&\qquad\qquad
    -
        q_i
        \left[
            \left(
                q_f
            -
                \int_{t_i}^{t_i + t} d\tau
                \frac{ \sin \omega (t_i + t - \tau) }{m\omega}
                J(\tau)
            \right)
        -
            q_i \cos \omega t
        \right]
    \bigg)
\notag\\&\qquad
    +
        \frac{q_f}{2}
        \int_{t_i}^{t_i + t} d\tau
        \cos \omega (t_i + t - \tau)
        J(\tau)
\notag\\&\qquad
    +
    \frac{1}{2}
    \int_{t_i}^{t_i + t} d\tau\ 
    \bigg[
        \frac{
            q_f \sin \omega (\tau - t_i)
        +
            q_i \sin \omega (t_i + t - \tau)
        }{ \sin \omega t }
\notag\\&\qquad\qquad
    -
        \frac{ \sin \omega (\tau - t_i) }{
            \sin \omega t
        }
        \int_{t_i}^{t_i + t} d\tau'
        \frac{ \sin \omega (t_i + t - \tau') }{m\omega}
        J(\tau')
\notag\\&\qquad\qquad
    +
        \int_{t_i}^\tau d\tau'
        \frac{ \sin \omega (\tau - \tau')}{m\omega}
        J(\tau')
    \bigg]
    J(\tau)
\end{align}
が得られる。
真空の波動関数
(\ref{vacuum solution of harmonic oscillator})
は
\begin{align}
    \phi_0  (t, q)
    &=
    \left(
        \dfrac{m \omega}{\pi \hbar}        
    \right)^{1/4}
    \exp(
        - \dfrac{m \omega}{2 \hbar} q^2
        -
        \dfrac{i t \omega}{2}
    )
\end{align}
であった
\footnote{
    ここではSchr\"odinger方程式を解くための
    波動関数の境界条件を指定しているだけであり、
    Feynman kernelが時間発展operatorの役割をするので
    本来ここに時間依存性を入れる必要はない。
    実際、以下では$t = t_i, t_f$の2つの時刻での
    波動関数しか使わない。

    そもそも、任意の時間での波動関数を知っていなければならないとすると
    source項によってHamiltonianに$-qJ$の項が加わる事を考慮して解の形を
    \begin{align}
        \phi_0  (t, q)
        &=
        \left(
            \dfrac{m \omega}{\pi \hbar}        
        \right)^{1/4}
        \exp(
            - \dfrac{m \omega}{2 \hbar} q^2
            -
            \dfrac{i t \omega}{2}
        -
            \dfrac{1}{i \hbar}
            \int_{t_i}^t d\tau
            q(\tau)
            J(\tau)
        )
    \end{align}
    と変えなければならないはずであるが、
    operatorであるはずの$q$を時間の実数関数と扱っている
    $q(\tau)$をどう解釈すれば良いかはよく分からない。
    $\tau \neq t$であるにも関わらず、
    $\hat{q}$と同じoperatorであるとして
    $\bm{x}$-表示して良いのだろうか。

    物理的にはこれは相互作用描像を採用している事に相当するのだが、
    あまりにもこれが気になる読者は、
    時間依存する波動関数ではなく
    単にHamiltonianの固有関数を用いて
    以下に続く計算を行ってよい。
    単に位相$\exp(i t \omega / 2)$分
    結果が変わるだけである。
}
から、
真空間の遷移振幅に対応する生成汎関数は
\begin{align}
    W_{00}[J](t)
    &=
    \int d q_f d q_i\ 
        \phi_0^*( t_i + t, q_f)
        \phi_0  ( t_i    , q_i)
    K[J](t_i + t, q_f; t_i, q_i)
\notag\\&
    =
    \left(
        \dfrac{ 
            m \omega
        }{
            2 \pi i \hbar
            \sin \omega t
        }
    \right)^{1 / 2}
    \int d q_f d q_i\ 
        \phi_0^*( t_i + t, q_f)
        \phi_0  ( t_i    , q_i)
    \exp\left(
        \dfrac{i}{\hbar} S_{cl} [J]
    \right)
\notag\\&
    =
    \left(
        \dfrac{ 
            m \omega
        }{
            2 \pi i \hbar
            \sin \omega t
        }
    \right)^{1 / 2}
    \int d q_f d q_i\ 
        \left(
            \dfrac{m \omega}{\pi \hbar}        
        \right)^{1/2}
        \exp(
            - \dfrac{m \omega}{2 \hbar}
            \bigg[
                q_i^2
                +
                q_f^2
            \bigg]
            +
            \dfrac{i t \omega}{2}
        )
        \exp\left(
            \dfrac{i}{\hbar} S_{cl} [J]
        \right)
\notag\\&
    =
    \dfrac{m \omega}{
        \pi \hbar
        ( 2 i \sin \omega t )^{1 / 2}
    }
    \exp\left(
        \dfrac{i t \omega}{2}
        +
        E
    \right)
    \int d q_f d q_i\ 
        \exp\left(
            - A (q_i^2 + q_f^2)
            - 2 B q_i q_f
            - 2 C q_f
            - 2 D q_i
        \right)
\notag\\&
    =
    \dfrac{m \omega}{
        \pi \hbar
        ( 2 i \sin \omega t )^{1 / 2}
    }
    \exp\left(
        \dfrac{i t \omega}{2}
        +
        E
    \right)
    \sqrt{
        \dfrac{\pi}{A}
    }
    \int d q_i\ 
        \exp\left(
            - A q_i^2
            - 2 D q_i
            + \dfrac{(B q_i + C)^2}{A}
        \right)
\notag\\&
    \qquad
    \text{
        $\because$
        $\Re A \ge 0$
        より
        Fresnel積分
        (\ref{fresnel integral})
    }
\notag\\&
    =
    \dfrac{m \omega}{
        \pi \hbar
        ( 2 i \sin \omega t )^{1 / 2}
    }
    \exp\left(
        \dfrac{i t \omega}{2}
        +
        E
    \right)
    \sqrt{
        \dfrac{\pi}{A}
    }
    \sqrt{
        \dfrac{\pi}{ A - \dfrac{B^2}{A} }
    }
    \exp\left(
        \dfrac{C^2}{A}
        +
        \dfrac{
            \left(
                D - \dfrac{BC}{A}
            \right)^2
        }{
            A - \dfrac{B^2}{A}
        }
    \right)
\notag\\&
    \qquad
    \text{
        $\because$
        $\Re (A^2 - B^2) \ge 0 $
        より再び
        Fresnel積分
        (\ref{fresnel integral})
    }
\notag\\&
    =
    \dfrac{m \omega}{
        \hbar
        ( 2 i \sin \omega t )^{1 / 2}
    }
    \dfrac{1}{ \sqrt{A^2 - B^2} }
    \exp\left(
        \dfrac{i t \omega}{2}
        +
        E
        +
        \dfrac{C^2}{A}
        +
        \dfrac{
            \left(
                AD - BC
            \right)^2
        }{
            A (A^2 - B^2)
        }
    \right)
\notag\\&
    =
    \dfrac{m \omega}{
        \hbar
        [
            2 i \sin \omega t 
            (A^2 - B^2)
        ]^{1 / 2}
    }
    \exp\left(
        \dfrac{i t \omega}{2}
        +
        E
        +
        \dfrac{
            A
            \left(
                C^2 + D^2
            \right)
        -
            2 BCD
        }{
            A^2 - B^2
        }
    \right)
\end{align}
と書ける。
ただし$A, B, C, D, E$は
\begin{subequations}
\begin{align}
    A(t)
    &:=
    \dfrac{m \omega}{2 \hbar}
    -
    \dfrac{i}{\hbar}
    \dfrac{m \omega \cos \omega t}{2 \sin \omega t}
=
    \dfrac{m \omega}{2 \hbar}
    \bigg[
        1
    -
        i
        \dfrac{\cos \omega t}{\sin \omega t}
    \bigg]
=
    \dfrac{m \omega}{2 \hbar}
    \dfrac{- i e^{i \omega t} }{\sin \omega t}
\\
    B(t)
    &:=
    -
    \dfrac{1}{2}
    \dfrac{i}{\hbar}
    \dfrac{- m \omega}{\sin \omega t}
    =
    \dfrac{m \omega}{2 \hbar}
    \dfrac{ i }{\sin \omega t}
\\
    C(t)
    &:=
    -
    \frac{1}{2}
    \dfrac{i}{\hbar}
    \dfrac{1}{2}
    \int_{t_i}^{t_i + t} d\tau
    \left\{
    -
        \dfrac{m \omega}{\sin \omega t}
            \dfrac{
                \sin \omega (t_i + t - \tau)
            }{m \omega}
        \cos \omega t
    +
        \cos \omega (t_i + t - \tau)
    +
        \dfrac{\sin \omega (\tau - t_i)}{\sin \omega t}
    \right\}
    J(\tau)
\notag\\&=
    -
    \dfrac{i}{4 \hbar}
    \int_{t_i}^{t_i + t} d\tau
    \dfrac{
    -
        \sin \omega (t_i + t - \tau)
        \cos \omega t
    +
        \sin \omega t
        \cos \omega (t_i + t - \tau)
    +
        \sin \omega (\tau - t_i)
    }{\sin \omega t}
    J(\tau)
\notag\\&=
    \dfrac{1}{4 i \hbar}
    \int_{t_i}^{t_i + t} d\tau
    \dfrac{
    -
        \sin \omega (t_i - \tau)
    +
        \sin \omega (\tau - t_i)
    }{\sin \omega t}
    J(\tau)
\notag\\&=
    \dfrac{1}{2 i \hbar}
    \dfrac{
        1
    }{\sin \omega t}
    \dfrac{
        e^{- i \omega t_i}
            F
        -
        e^{+ i \omega t_i}
            F^*
    }{ 2i }
=
    \dfrac{1}{2 i \hbar}
    \dfrac{
        \Im[ e^{- i \omega t_i}
            F ]
    }{\sin \omega t}
\\
    D(t)
    &:=
    -
    \dfrac{1}{2}
    \dfrac{i}{\hbar}
    \dfrac{1}{2}
    \int_{t_i}^{t_i + t} d \tau
    \left\{
        \dfrac{m \omega}{\sin \omega t}
        \dfrac{
            \sin \omega (t_i + t - \tau)
        }{m \omega}
    +
        \dfrac{
            \sin \omega (t_i + t - \tau)
        }{\sin \omega t}
    \right\}
    J(\tau)
\notag\\&=
    \dfrac{1}{2 i \hbar}
    \int_{t_i}^{t_i + t} d \tau
        \dfrac{
            \sin \omega (t_i + t - \tau)
        }{\sin \omega t}
    J(\tau)
=
    \dfrac{1}{2 i \hbar}
    \dfrac{
        \Im[ e^{i \omega (t_i + t)}
            F^* ]
    }{\sin \omega t}
\\
    E(t)
    &:=
    \dfrac{i}{\hbar}
    \dfrac{1}{2}
    \int_{t_i}^{t_i + t} d\tau
    \left\{
    -
    \int_{t_i}^{t_i + t} d\tau'
        \dfrac{\sin \omega (\tau - t_i)}{\sin \omega t}
        \dfrac{\sin \omega (t_i + t - \tau')}{m \omega}
    +
    \int_{t_i}^{\tau} d\tau'
        \dfrac{\sin \omega (\tau - \tau')}{m \omega}
    \right\}
    J(\tau) J(\tau')
\notag\\&
    =
    \dfrac{i}{2 \hbar m \omega}
    \int_{t_i}^{t_i + t} d\tau
    J(\tau) J(\tau')
    \bigg\{
    \int_{t_i}^{\tau} d\tau'
        \sin \omega (\tau - \tau')
\notag\\&\qquad
    -
    \dfrac{
        \int_{\tau}^{t_i + t} d\tau'
            \sin \omega (\tau - t_i)
            \sin \omega (t_i + t - \tau')
    +
        \int_{t_i}^{\tau} d\tau'
            \sin \omega (\tau - t_i)
            \sin \omega (t_i + t - \tau')
    }{\sin \omega t}
    \bigg\}
\notag\\&
    =
    \dfrac{i}{2 \hbar m \omega}
    \int_{t_i < \tau' < \tau < t_i + t}
        d\tau d\tau'
    J(\tau) J(\tau')
\notag\\&\qquad
    \dfrac{
            \sin \omega (\tau - \tau')
            \sin \omega t
        -
            \sin \omega (\tau - t_i)
            \sin \omega (t_i + t - \tau')
        -
            \sin \omega (\tau' - t_i)
            \sin \omega (t_i + t - \tau)
    }{\sin \omega t}
\notag\\&
    =
    \dfrac{i}{2 \hbar m \omega}
    \int_{t_i < \tau' < \tau < t_i + t}
        d\tau d\tau'
    J(\tau) J(\tau')
    \bigg\{
    \dfrac{
        -
            \cos \omega (\tau - \tau' + t)
        +
            \cos \omega (\tau - \tau' - t)
    }{2 \sin \omega t}
\notag\\&\qquad
    +
    \dfrac{
            \cos \omega (\tau + t - \tau')
        -
            \cos \omega (\tau - 2 t_i - t + \tau')
    }{2 \sin \omega t}
\notag\\&\qquad
    +
    \dfrac{
            \cos \omega (\tau' + t - \tau)
        -
            \cos \omega (\tau' - 2 t_i - t + \tau)
    }{2 \sin \omega t}
    \bigg\}
\notag\\&
    =
    \dfrac{i}{2 \hbar m \omega}
    \int_{t_i < \tau' < \tau < t_i + t}
        d\tau d\tau'
    J(\tau) J(\tau')
    \bigg\{
    \dfrac{
            2 \cos \omega (\tau - \tau' - t)
        -
            2 \cos \omega (\tau' - 2 t_i - t + \tau)
    }{2 \sin \omega t}
    \bigg\}
\notag\\&
    =
    \dfrac{1}{i \hbar m \omega}
    \int_{t_i < \tau' < \tau < t_i + t}
        d\tau d\tau'
    J(\tau) J(\tau')
    \bigg\{
    \dfrac{
        \sin \omega (\tau - t_i - t)
        \sin \omega (t_i - \tau')
    }{\sin \omega t}
    \bigg\}
\notag\\&
    =
    \dfrac{1}{i \hbar m \omega \sin \omega t}
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    \theta(\tau - \tau')
    J(\tau) J(\tau')
        \sin \omega (t_i + t - \tau)
        \sin \omega (\tau' - t_i)
\notag\\&
    =
    \dfrac{1}{i \hbar m \omega \sin \omega t}
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    \theta(\tau - \tau')
    J(\tau) J(\tau')
    \dfrac{
        e^{ i \omega (t_i + t - \tau) }
    -
        e^{ - i \omega (t_i + t - \tau) }
    }{2 i}
    \dfrac{
        e^{ i \omega (\tau' - t_i) }
    -
        e^{ - i \omega (\tau' - t_i) }
    }{2 i}
\notag\\&
    =
    \dfrac{i}{4 \hbar m \omega \sin \omega t}
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    \theta(\tau - \tau')
    J(\tau) J(\tau')
\notag\\&\qquad\qquad
    \times
    \bigg[
        e^{ i \omega (t + \tau' - \tau) }
    -
        e^{ i \omega (2 t_i + t - \tau' - \tau) }
    -
        e^{ i \omega (\tau' + \tau - t - 2 t_i) }
    +
        e^{ i \omega (\tau - \tau' - t) }
    \bigg]
\notag\\&
    =
    \dfrac{i}{4 \hbar m \omega \sin \omega t}
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    J(\tau) J(\tau')
\notag\\&\qquad\qquad
    \times
    \bigg[
    \theta(\tau - \tau')
    \bigg(
        e^{ i \omega (t + \tau' - \tau) }
    -
        e^{ i \omega (2 t_i + t - \tau' - \tau) }
    -
        e^{ i \omega (\tau' + \tau - t - 2 t_i) }
    \bigg)
    +
    [ 1 - \theta(\tau' - \tau) ]
        e^{ i \omega (\tau - \tau' - t) }
    \bigg]
\notag\\&
    =
    \dfrac{i}{4 \hbar m \omega \sin \omega t}
    \bigg\{
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    J(\tau) J(\tau')
    \theta(\tau - \tau')
        e^{ i \omega (\tau' - \tau) }
    \dfrac{
        e^{ i \omega t }
    -
        e^{ - i \omega t }
    }{2 i}
    2 i
\notag\\&\qquad\qquad
    +
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    J(\tau) J(\tau')
    \bigg[
    -
    \dfrac{1}{2}
    \bigg(
        e^{ i \omega (2 t_i + t - \tau' - \tau) }
    +
        e^{ i \omega ( - 2 t_i - t + \tau' + \tau) }
    \bigg)
    +
        e^{ i \omega (\tau - \tau' - t) }
    \bigg]
    \bigg\}
\notag\\&
    =
    \dfrac{i}{4 \hbar m \omega \sin \omega t}
    \bigg\{
    2 i
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    J(\tau) J(\tau')
    \theta(\tau - \tau')
        e^{ i \omega (\tau' - \tau) }
    \sin \omega t
\notag\\&\qquad\qquad
    -
    \dfrac{1}{2}
    \bigg(
        e^{ i \omega (2 t_i + t) }
            { F^* }^2
    +
        e^{ i \omega ( - 2 t_i - t) }
            F^2
    \bigg)
    +
        e^{ - i \omega t }
            | F |^2
    \bigg\}
\\
    F(t)
    &:=
    \int_{t_i}^{t_i + t} d\tau\ 
        e^{i \omega \tau}
        J(\tau)
\end{align}
\end{subequations}
と定義した。
$\theta(\tau)$は階段関数
(\ref{definition of step function})である。
これらは
\begin{subequations}
\begin{align}
    A^2 - B^2
    &=
    \left(
        \dfrac{m \omega}{2 \hbar}
        \dfrac{1}{\sin \omega t}
    \right)^2
    \left[
        1
        - e^{2 i \omega t}
    \right]
=
    \left(
        \dfrac{m \omega}{2 \hbar}
    \right)^2
    \dfrac{1}{\sin^2 \omega t}
    \left[
        1
    -
        e^{i \omega t}
    \right]
    \left[
        1
    +
        e^{i \omega t}
    \right]
\notag\\&=
    \left(
        \dfrac{m \omega}{\hbar}
    \right)^2
    \dfrac{
        i
        e^{i \omega t}
    }{\sin^2 \omega t}
    \dfrac{
            e^{- i \omega t/2}
        -
            e^{  i \omega t/2}
    }{2 i}
    \dfrac{
        e^{i \omega t/2}
    +
        e^{- i \omega t/2}
    }{2}
\notag\\&=
    \left(
        \dfrac{m \omega}{\hbar}
    \right)^2
    \dfrac{
    -
        i
        e^{i \omega t}
    }{\sin^2 \omega t}
    \sin \dfrac{\omega t}{2}
    \cos \dfrac{\omega t}{2}
=
    \left(
        \dfrac{m \omega}{\hbar}
    \right)^2
    \dfrac{
    -
        i
        e^{i \omega t}
    }{2 \sin \omega t}
\\
    C^2 + D^2
&:=
    -
    \dfrac{1}{4 \hbar^2 \sin^2 \omega t}
    \bigg\{
        \bigg(
            \dfrac{
            e^{- i \omega t_i}
                F
        -
            e^{+ i \omega t_i}
                F^*
        }{ 2i }
        \bigg)^2
    +
        \bigg(
            \dfrac{
            e^{i \omega (t_i + t)}
                F^*
        -
            e^{- i \omega (t_i + t)}
                F
        }{ 2i }
        \bigg)^2
    \bigg\}
\notag\\&
    =
    \dfrac{
            e^{- 2 i \omega t_i}
                F^2
        -
            2 | F |^2
        +
            e^{+ 2 i \omega t_i}
                {F^*}^2
    +
            e^{2 i \omega (t_i + t)}
                {F^*}^2
        -
            2 | F |^2
        +
            e^{- 2 i \omega (t_i + t)}
                F^2
    }{4 \times 4 \hbar^2 \sin^2 \omega t}
\notag\\&
    =
    \dfrac{
        \bigg(
            1
        +
            e^{- 2 i \omega t}
        \bigg) 
        e^{- 2 i \omega t_i}
            F^2
    +
        \bigg(
            1
        +
            e^{2 i \omega t}
        \bigg) 
        e^{+ 2 i \omega t_i}
            {F^*}^2
    -
        4 | F |^2
    }{4 \times 4 \hbar^2 \sin^2 \omega t}
\\
    BCD
    &=
    \dfrac{m \omega}{2 \hbar}
    \dfrac{ i }{\sin \omega t}
\times
    \dfrac{1}{2 i \hbar \sin \omega t}
    \dfrac{
        e^{- i \omega t_i}
            F
    -
        e^{i \omega t_i}
            F^*
    }{2 i}
\times
    \dfrac{1}{2 i \hbar \sin \omega t}
    \dfrac{
        e^{i \omega (t_i + t)}
            F^*
    -
        e^{- i \omega (t_i + t)}
            F
    }{2 i}
\notag\\&
    =
    \dfrac{m \omega}{32 \hbar^3}
    \dfrac{ i }{\sin^3 \omega t}
    \bigg[
        e^{- i \omega t_i}
            F
    -
        e^{i \omega t_i}
            F^*
    \bigg]
    \bigg[
        e^{i \omega (t_i + t)}
            F^*
    -
        e^{- i \omega (t_i + t)}
            F
    \bigg]
\notag\\&
    =
    \dfrac{m \omega}{32 \hbar^3}
    \dfrac{ i }{\sin^3 \omega t}
    \bigg[
        e^{i \omega t}
        | F |^2
    -
        e^{- i \omega (2 t_i + t)}
            F^2
    -
        e^{i \omega (2 t_i + t)}
            {F^*}^2
    +
        e^{- i \omega t}
            | F |^2
    \bigg]
\end{align}
\end{subequations}
の関係式を満たすから、
\begin{align}
    A (C^2 + D^2) - 2 BCD
&=
    \dfrac{m \omega}{2 \hbar}
    \dfrac{- i e^{i \omega t} }{\sin \omega t}
    \dfrac{
        \bigg(
            1
        +
            e^{- 2 i \omega t}
        \bigg) 
        e^{- 2 i \omega t_i}
            F^2
    +
        \bigg(
            1
        +
            e^{2 i \omega t}
        \bigg) 
        e^{+ 2 i \omega t_i}
            {F^*}^2
    -
        4 | F |^2
    }{4 \times 4 \hbar^2 \sin^2 \omega t}
\notag\\&\qquad
    - 2
    \dfrac{m \omega}{32 \hbar^3}
    \dfrac{
        i e^{i \omega t}
    }{\sin^3 \omega t}
    \bigg[
        | F |^2
    -
        e^{- 2 i \omega (t_i + t)}
            F^2
    -
        e^{ 2 i \omega t_i}
            {F^*}^2
    +
        e^{- 2 i \omega t}
            | F |^2
    \bigg]
\notag\\&
    =
    \dfrac{m \omega}{32 \hbar^3}
    \dfrac{ - i e^{i \omega t} }{\sin^3 \omega t}
    \bigg\{
        \bigg(
            1
        +
            e^{- 2 i \omega t}
        \bigg)
        e^{- 2 i \omega t_i}
            F^2
    +
        \bigg(
            1
        +
            e^{2 i \omega t}
        \bigg) 
        e^{+ 2 i \omega t_i}
            {F^*}^2
    -
        4 | F |^2
    \notag\\&\qquad
    + 2
        \bigg[
            | F |^2
        -
            e^{- 2 i \omega (t_i + t)}
                F^2
        -
            e^{2 i \omega t_i}
                {F^*}^2
        +
            e^{- 2 i \omega t}
                | F |^2
        \bigg]
    \bigg\}
\notag\\
    \dfrac{
        A ( C^2 + D^2 )
    -
        2 BCD
    }{
        A^2 - B^2
    }
&=
    \dfrac{1}{16 \hbar m \omega \sin^2 \omega t}
    \bigg\{
        \bigg(
            1
    -
            e^{- 2 i \omega t}
        \bigg)
        e^{- 2 i \omega t_i}
            F^2
\notag\\&\qquad
    +
        \bigg(
            e^{2 i \omega t}
        -
            1
        \bigg) 
        e^{+ 2 i \omega t_i}
            {F^*}^2
    - 2
        \bigg(
            1
        -
            e^{- 2 i \omega t}
        \bigg)
        | F |^2
    \bigg\}
\notag\\&
    =
    \dfrac{
            1
        -
            e^{- 2 i \omega t}
    }{16 \hbar m \omega \sin^2 \omega t}
    \bigg\{
        e^{- 2 i \omega t_i}
            F^2
    +
        e^{+ 2 i \omega (t_i + t)}
            {F^*}^2
    - 2
        | F |^2
    \bigg\}
\notag\\&
    =
    \dfrac{
        2 i
        e^{- i \omega t}
    }{16 \hbar m \omega \sin \omega t}
    \bigg\{
        e^{- 2 i \omega t_i}
            F^2
    +
        e^{+ 2 i \omega (t_i + t)}
            {F^*}^2
    - 2
        | F |^2
    \bigg\}
\notag\\
    E
    +
    \dfrac{
        A ( C^2 + D^2 )
    -
        2 BCD
    }{
        A^2 - B^2
    }
&=
    \dfrac{i}{16 \hbar m \omega \sin \omega t}
    \bigg\{
    8 i
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    J(\tau) J(\tau')
    \theta(\tau - \tau')
        e^{ i \omega (\tau' - \tau) }
    \sin \omega t
\notag\\&\qquad\qquad
    -
    2
        e^{ i \omega (2 t_i + t) }
            { F^* }^2
    - 2
        e^{ i \omega ( - 2 t_i - t) }
            F^2
    + 4
        e^{ - i \omega t }
            | F |^2
    \bigg\}
\notag\\&\qquad
        +
        \dfrac{
            2 i
            e^{- i \omega t}
        }{16 \hbar m \omega \sin \omega t}
        \bigg\{
            e^{- 2 i \omega t_i}
                F^2
        +
            e^{+ 2 i \omega (t_i + t)}
                {F^*}^2
        - 2
        | F |^2
    \bigg\}
\notag\\&
    =
    \dfrac{i}{16 \hbar m \omega \sin \omega t}
    \bigg\{
    8 i
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    J(\tau) J(\tau')
    \theta(\tau - \tau')
        e^{ i \omega (\tau' - \tau) }
    \sin \omega t
\notag\\&\qquad\qquad
    -
    2
        e^{ i \omega (2 t_i + t) }
            { F^* }^2
    - 2
        e^{ i \omega ( - 2 t_i - t) }
            F^2
    + 4
        e^{ - i \omega t }
            | F |^2
\notag\\&\qquad
        +
            2
            e^{i \omega (- t - 2 t_i)}
                F^2
        +
            2
            e^{i \omega (2 t_i + t)}
                {F^*}^2
        - 4
            e^{- i \omega t}
                | F |^2
    \bigg\}
\notag\\&
    =
    -
    \dfrac{1}{2 \hbar m \omega}
    \int_{t_i}^{t_i + t}
        d\tau
    \int_{t_i}^{t_i + t}
        d\tau'
    J(\tau) J(\tau')
    \theta(\tau - \tau')
        e^{ i \omega (\tau' - \tau) }
\end{align}
であって、
結局求めたかった生成汎関数は
\begin{align}
    W_{00}[J](t)
    &=
    \dfrac{m \omega}{
        \hbar
        [
            2 i \sin \omega t 
            (A^2 - B^2)
        ]^{1 / 2}
    }
    \exp\left(
        \dfrac{i t \omega}{2}
        +
        E
        +
        \dfrac{
            A
            \left(
                C^2 + D^2
            \right)
        -
            2 BCD
        }{
            A^2 - B^2
        }
    \right)
\notag\\&
    =
    e^{ - i \omega t / 2 }
    \exp\bigg(
        \dfrac{i t \omega}{2}
        -
        \dfrac{1}{2 \hbar m \omega}
        \int_{t_i}^{t_i + t}
            d\tau
        \int_{t_i}^{t_i + t}
            d\tau'
        J(\tau) J(\tau')
        \theta(\tau - \tau')
            e^{ i \omega (\tau' - \tau) }
    \bigg)
\notag\\&
    =
    \exp\bigg(
        \dfrac{i}{4 \hbar}
        \int_{t_i}^{t_i + t}
            d\tau
        \int_{t_i}^{t_i + t}
            d\tau'
        J(\tau) J(\tau')
            D_F (\tau - \tau')
    \bigg)
\label{generating functional of harmonic oscillator}
\end{align}
と書ける。
ここで
\begin{align}
    D_F (\tau - \tau')
    &:=
    \dfrac{ i }{m \omega}
    \bigg[
        \theta(\tau - \tau')
        e^{ - i \omega (\tau - \tau') }
    +
        \theta(\tau' - \tau)
        e^{ i \omega (\tau - \tau') }
    \bigg]
\notag\\&=
    -
    \dfrac{ i }{m \omega}
    \int
        \dfrac{d \omega'}{2 \pi i}
    \bigg[
        \dfrac{
            e^{ - i (\omega + \omega') (\tau - \tau') }
        }{\omega' + i \epsilon}
    +
        \dfrac{
            e^{ i (\omega + \omega') (\tau - \tau') }
        }{\omega' + i \epsilon}
    \bigg]
\notag\\&=
    -
    \dfrac{ i }{m \omega}
    \int
        \dfrac{d \omega'}{2 \pi i}
    \bigg[
        \dfrac{
            e^{ - i \omega' (\tau - \tau') }
        }{\omega' - \omega + i \epsilon}
    +
        \dfrac{
            e^{ - i \omega' (\tau - \tau') }
        }{- \omega' - \omega + i \epsilon}
    \bigg]
\notag\\&=
    \dfrac{ i }{m \omega}
    \int
        \dfrac{d \omega'}{2 \pi i}
        \dfrac{
            e^{ - i \omega' (\tau - \tau') }
        }{\omega'^2 - (- \omega + i \epsilon)^2}
    \bigg[
        (- \omega' - \omega + i \epsilon)
    +
        (\omega' - \omega + i \epsilon)
    \bigg]
\notag\\&=
    \dfrac{ 2 i }{m \omega}
    \bigg[
        - \omega + i \epsilon
    \bigg]
    \int
        \dfrac{d \omega'}{2 \pi i}
        \dfrac{
            e^{ - i \omega' (\tau - \tau') }
        }{\omega'^2 - (\omega - i \epsilon)^2}
\notag\\&=
    \dfrac{2}{m}
    \int
        \dfrac{d \omega'}{2 \pi}
        \dfrac{
            e^{ - i \omega' (\tau - \tau') }
        }{- \omega'^2 + \omega^2 - i \epsilon}
\end{align}
はFeynman propagator（ファインマン伝播関数）
と呼ばれる量であり、
2つ目の等号には階段関数のFourier表示
(\ref{fourier transformation of step function})
を用いた。
Dirac deltaのFourier表示
(\ref{dirac delta fourier representation})
に気を付けると、
これは調和振動子の作用に現れるoperator
(\ref{harmonic oscillator action operator matrix})
のGreen関数
\begin{align}
    \dfrac{m}{2}
    \left(
        \dfrac{d^2}{dt^2}
        +
        \omega^2
    \right)
    D_F (t)
=
    \left(
        \dfrac{d^2}{dt^2}
        +
        \omega^2
    \right)
    \int
        \dfrac{d \omega'}{2 \pi}
        \dfrac{
            e^{ - i \omega' t }
        }{- \omega'^2 + \omega^2 - i \epsilon}
=
    \int
        \dfrac{d \omega'}{2 \pi}
        \dfrac{
        -
            \omega'^2
        +
            \omega^2
        }{- \omega'^2 + \omega^2 - i \epsilon}
        e^{ - i \omega' t }
= 
    \delta (t)
\end{align}
となっている。

この結果はFeynman kernelの経路積分表示
(\ref{path integral representation of feynman kernel})
まで立ち戻るともう少し系統的に理解できる。
求めた生成汎関数は
\begin{align}
    W_{FI}[J](t)
&=
    \int d^D x_f d^D x_i\ 
        \phi_F^*( t_i + t, \bm{x}_f)
        \phi_I  ( t_i    , \bm{x}_i)
        K[J](t_i + t, \bm{x}_f; t_i, \bm{x}_i)
\notag\\&
=
    \int d^D x_f d^D x_i\ 
        \phi_F^*( t_i + t, \bm{x}_f)
        \phi_I  ( t_i    , \bm{x}_i)
    \int_{x(t_i) = x_i}^{x(t_f) = x_f}
    \mathcal{D} x
    \exp\left(\dfrac{i}{\hbar}S \right)
\notag\\&
=
    \int_{\forall \bm{x}(t)}
    \mathcal{D} x\ 
        \phi_F^*( t_i + t, \bm{x}_f)
    \exp\left(\dfrac{i}{\hbar}S \right)
        \phi_I  ( t_i    , \bm{x}_i)
\notag\\&
=
        \bra{ \phi_F }
    \int_{\forall \bm{x}(t)}
    \mathcal{D} x\ 
    \exp\left(\dfrac{i}{\hbar}S \right)
        \ket{ \phi_I }
\end{align}
と書ける事に気づけば、
真ん中に現れたのはまさに
source付きのGauss積分
(\ref{eq:gaussian-integral-with-source})
の無限次元における類似であって、
特にいまsource付き調和振動子の
作用が(\ref{harmonic oscillator lagrangian with source})により
\begin{align}
        \dfrac{i}{\hbar} S
=
    -
    \dfrac{1}{2}
    \int d \tau
\left[
        x(\tau)
        \dfrac{i}{\hbar}
        m
    \left(
        \dfrac{d^2}{d\tau^2}
        +
        \omega^2
    \right)
    x(\tau)
\right]
    +
    \int d \tau\ 
    x(\tau)
    \dfrac{i}{\hbar}
    J(\tau)
\end{align}
と与えられていたので、
その積分結果
(\ref{generating functional of harmonic oscillator})
が
\begin{align}
    &
    \exp \left[
        \dfrac{1}{2}
        \int d \tau
        \int d \tau'
        \dfrac{i}{\hbar}
        J(\tau')
    \left\{
        \dfrac{i}{\hbar}
        m
        \left(
            \dfrac{d^2}{d\tau^2}
        +
            \omega^2
        \right)
    \right\}^{-1}
        \dfrac{i}{\hbar}
        J(\tau)
    \right]
\notag\\&
=
    \exp \left[
        \dfrac{i}{4 \hbar}
        \int d \tau
        \int d \tau'
        J(\tau')
    \left\{
        \dfrac{m}{2}
        \left(
            \dfrac{d^2}{d\tau^2}
        +
            \omega^2
        \right)
    \right\}^{-1}
        J(\tau)
    \right]
\end{align}
と与えられるのは自然である。

さらに分配関数
(\ref{P.B.C. path int and partition function})
も求めてみよう。
上の生成汎関数$W_{00} [J]$の計算から
波動関数$\phi_0$による寄与を除き
$x := q_i = q_f$
と置けば、
他はほとんど変わらずに計算できて
\begin{align}
    &
    Z [J] (\tau)
=
    \int d x
    K_E ( \tau; q_f = x, q_i = x )
\notag\\&
=
    \left(
        \dfrac{ 
            m \omega
        }{
            2 \pi i \hbar
            \sin \omega t
        }
    \right)^{1 / 2}
    \int d x
    \exp\left(
        - 2 G x^2
        - 2 H x
    \right)
=
    \left(
        \dfrac{ 
            m \omega
        }{
            2 \pi i \hbar
            \sin \omega t
        }
    \right)^{1 / 2}
    \sqrt{ \dfrac{\pi}{2 G} }
    \exp\left(
        \dfrac{ H^2 }{ 2 G }
    \right)
\end{align}
ただし
\begin{align}
    G(t)
&:=
    A(t) - (\text{波動関数の寄与})
    + B (t)
=
    -
    \dfrac{i}{\hbar}
    \dfrac{m \omega \cos \omega t}{2 \sin \omega t}
    -
    \dfrac{1}{2}
    \dfrac{i}{\hbar}
    \dfrac{- m \omega}{\sin \omega t}
\notag\\&
=
    \dfrac{i}{\hbar}
    \dfrac{
        m \omega (1 - \cos \omega t)
    }{2 \sin \omega t}
=
    \dfrac{i}{\hbar}
    \dfrac{
        m \omega
        \sin^2 \dfrac{ \omega t }{2}
    }{\sin \omega t}
\\
    H(t)
&:=
    C(t) + D(t)
=
    \dfrac{1}{4 i \hbar}
    \int_{t_i}^{t_i + t} d\tau
    \dfrac{
        2 \sin \omega (\tau - t_i)
    }{\sin \omega t}
    J(\tau)
+
    \dfrac{1}{2 i \hbar}
    \int_{t_i}^{t_i + t} d \tau
        \dfrac{
            \sin \omega (t_i + t - \tau)
        }{\sin \omega t}
    J(\tau)
\notag\\&
=
    \dfrac{1}{2 i \hbar}
    \int_{t_i}^{t_i + t} d\tau
    \dfrac{
        \sin \omega (\tau - t_i)
    +
        \sin \omega (t_i + t - \tau)
    }{\sin \omega t}
    J(\tau)
\end{align}
となる。
まとめると
\begin{align}
    Z [J] (\tau)
&=
    \left(
        \dfrac{
            m \omega
        }{
            2 \pi i \hbar
            \sin \omega t
        }
        \dfrac{\pi}{
            2
            \dfrac{i}{\hbar}
            \dfrac{
                m \omega
                \sin^2 \dfrac{ \omega t }{2}
            }{\sin \omega t}
        }
    \right)^{1 / 2}
    \exp\left(
        \dfrac{ H^2 }{ 2 G }
    \right)
\notag\\&
=
    \dfrac{ 1 }{
        2 i \sin \dfrac{\omega t}{2}
    }
    \exp\left(
        \dfrac{ H^2 }{ 2 G }
    \right)
=
    \dfrac{ 1 }{
        e^{ i \omega t / 2 }
    -
        e^{ - i \omega t / 2 }
    }
    \exp\left(
        \dfrac{ H^2 }{ 2 G }
    \right)
\end{align}
となり、特に$J = 0$のとき$H = 0$なので
$Z [J = 0] (\tau = i t = \hbar \beta)
=
    \dfrac{ 1 }{
        e^{ \beta \omega / 2 }
    -
        e^{ - \beta \omega / 2 }
    }
$
は統計力学で習う調和振動子の
分配関数をきちんと再現する。

\subsection{量子力学における対称性と保存量}

以下では、量子力学においても対称性や保存則について
古典系に類似する記述が可能である事を見よう。

\subsubsection{$3$次元角運動量の代数}
\label{subsubsec: angular momentum}

Newton力学で角運動量
（angular momentum、
軌道角運動量、orbital angular momentum）は
\begin{subequations}
\begin{align}
    \bm{L} &:= \bm{r} \times \bm{p}
    \\\therefore
    L_i &= \epsilon_{ijk} \ x_j \ p_k
\label{angular momentum definition}
\end{align}
\end{subequations}
と定義され（ただし成分は直交座標系で示した。
また簡単のため議論は$1$粒子系の場合に限る）、
3次元系の回転対称性に付随する保存量であった。
量子力学で対応する演算子はどのような性質を持つか議論しよう。

角運動量演算子を
\begin{align}
    \hat{L}_i &= \epsilon_{ijk} \ \hat{q}_j \ \hat{p}_k
\end{align}
と定義する。
正準交換関係と公式
(\ref{3rd order epsilon to delta2 formula}),
(\ref{A,BC to B(A,C) + (A,B)C})
を使うと
\begin{align}
    &\qquad\qquad\qquad\qquad
    \qquad\qquad
    [
        \hat{L}_i, \hat{L}_j
    ]
    = i \hbar\ \epsilon_{ijk} \hat{L}_k
\label{angular momentum algebra}
\\&\because\quad
    [
        \hat{L}_i, \hat{L}_j
    ]
    =
    [
        \epsilon_{ikl} \ \hat{q}_k \hat{p}_l
        ,
        \epsilon_{jnm} \ \hat{q}_n \hat{p}_m
    ]
    =
    \epsilon_{ikl} \epsilon_{jnm}
    [
        \hat{q}_k \hat{p}_l
        ,
        \hat{q}_n \hat{p}_m
    ]
\notag\\&=
    \epsilon_{ikl} \epsilon_{jnm}
    \bigg(
        \hat{q}_k
        [
            \hat{p}_l
            ,
            \hat{q}_n \hat{p}_m
        ]
    +
        [
            \hat{q}_k
            ,
            \hat{q}_n \hat{p}_m
        ]
        \hat{p}_l
    \bigg)
=
    \epsilon_{ikl} \epsilon_{jnm}
    \bigg(
        \hat{q}_k
        [
            \hat{p}_l
            ,
            \hat{q}_n
        ]
        \hat{p}_m
    +
        \hat{q}_n
        [
            \hat{q}_k
            ,
            \hat{p}_m
        ]
        \hat{p}_l
    \bigg)
\notag\\&=
    i \hbar
    \epsilon_{ikl} \epsilon_{jnm}
    \bigg(
        -
        \hat{q}_k
        \hat{p}_m
        \delta_{ln}
    +
        \hat{q}_n
        \hat{p}_l
        \delta_{km}
    \bigg)
=
    i \hbar
    \bigg(
        -
        \epsilon_{ikl} \epsilon_{jlm}\ 
        \hat{q}_k
        \hat{p}_m
    +
        \epsilon_{ikl} \epsilon_{jnk}\ 
        \hat{q}_n
        \hat{p}_l
    \bigg)
\notag\\&=
    i \hbar
    \bigg(
        -
        \epsilon_{lki} \epsilon_{ljm}\ 
        \hat{q}_k
        \hat{p}_m
    +
        \epsilon_{kil} \epsilon_{knj}\ 
        \hat{q}_n
        \hat{p}_l
    \bigg)
=
    i \hbar
    \bigg(
        -
        \bigg[
            \delta_{kj}\delta_{im}
            -
            \delta_{km}\delta_{ij}
        \bigg]
        \hat{q}_k
        \hat{p}_m
    +
        \bigg[
            \delta_{in}\delta_{lj}
            -
            \delta_{ij}\delta_{ln}
        \bigg]
        \hat{q}_n
        \hat{p}_l
    \bigg)
\notag\\&=
    i \hbar
    \bigg(
        -
        \hat{q}_j
        \hat{p}_i
        +
        \hat{q}_m
        \hat{p}_m
        \delta_{ij}
    +
        \hat{q}_i
        \hat{p}_j
        -
        \hat{q}_l
        \hat{p}_l
        \delta_{ij}
    \bigg)
=
    i \hbar
    \bigg(
        \hat{q}_i
        \hat{p}_j
    -
        \hat{q}_j
        \hat{p}_i
    \bigg)
=
    i \hbar
    \bigg(
        \delta_{in}\delta_{jm}
    -
        \delta_{jn}\delta_{im}
    \bigg)
    \hat{q}_n
    \hat{p}_m
\notag\\&=
    i \hbar \epsilon_{kij} \epsilon_{knm}
    \hat{q}_n
    \hat{p}_m
= i \hbar\ \epsilon_{ijk} \hat{L}_k
\notag
\end{align}
が従う。
(\ref{angular momentum algebra})を
角運動量の代数（
$\mathfrak{so}(3)$代数、
angular momentum algebra）、あるいは
$\mathfrak{su}(2)$代数という。

\subsubsection{$3$次元角運動量の代数の表現}

この代数が正定値なHilbert空間に作用しているということから
再び非自明な条件が得られる事を見よう。
そのためにはnon-Hermitianなoperator
\begin{align}
    \hat{L}_\pm
    &:=
    \hat{L}_x
    \pm
    i \hat{L}_y
\\
    \hat{L}_\mp^\dagger
    &=
    \hat{L}_\pm
\end{align}
を定義しておくと都合がよい。
(\ref{angular momentum algebra})を
$\hat{L}_\pm, \hat{L}_3$で書き直すと
\begin{subequations}
\begin{align}
    [\hat{L}_+, \hat{L}_-]
    &= 2 \hbar \hat{L}_3
\\
    [\hat{L}_3, \hat{L}_\pm]
    &= \pm \hbar \hat{L}_\pm
\label{angular momentum creation annihilation}
\end{align}
\label{angular momentum algebra with L_pm}
\end{subequations}
となり、
(\ref{raising and lowering number operator})
に続く議論と全く同様に
$\hat{L}_\pm$が$\hat{L}_3$の固有値を
$\pm \hbar$だけ上下することが分かる。

角運動量の大きさ
（the square of the magnitude of the orbital angular momentum）
$\hat{\bm{L}}^2$を
\begin{align}
    \hat{\bm{L}}^2
    := \sum_i \hat{L}_i^2
&=
    \dfrac{1}{2}
    \left(
        \hat{L}_+ \hat{L}_-
    +
        \hat{L}_- \hat{L}_+
    \right)
    +
    \hat{L}_3^2
\label{the square of the magnitude of the orbital angular momentum}
\\
    \hat{L}_\pm \hat{L}_\mp
    &=
    \hat{\bm{L}}^2 - \hat{L}_3^2
    \pm \hbar \hat{L}_3
\label{angular momentum raising lowering into l^2 and l_3}
\end{align}
で定義する。
$\hat{\bm{L}}^2$は
$\hat{L}_\pm, \hat{L}_3$の全てと交換するので、
$\hat{\bm{L}}^2$と$\hat{L}_3$の同時固有状態が存在する。
より一般に、
代数の全ての元と交換するような元の集合を中心（center）といい、
Lie algebraが与えられたとき
algebraの元を特定の方法で規格化し二乗和を取ることにより
カシミール演算子（カシミア、Casimir operator、quadratic Casimir invariant）と呼ばれる
（Lie algebraのuniversal enveloping algebra（普遍包絡代数）の）centerの元を
構成することが出来る。

$\hat{\bm{L}}^2$の固有値を$L^2$と書くと、
対応する固有状態$\ket{\psi}$による期待値は$\hat{\bm{L}}$のHermiticityより
\begin{align}
    L^2
&=
    \bra{\psi} \hat{\bm{L}}^2 \ket{\psi}
=
    \sum_i
    \Big|\Big|
        \hat{L}_i \ket{\psi}
    \Big|\Big|^2 \ge 0
\end{align}
のように非負であるため、
無次元の実数parameter $j \ge 0$
（軌道角運動量量子数、orbital angular momentum、方位角量子数、azimuthal quantum number）を用いて
$L^2 = \hbar^2 j (j+1)$
とおいて一般性を失わない。
同様に無次元parameter $m$（磁気量子数、magnetic quantum number）を用い、
$\hat{\bm{L}}^2$と$\hat{L}_3$の同時固有状態$\ket{j,m}$が
\begin{subequations}
\begin{align}
    \hat{\bm{L}}^2 \ket{j,m}
    &=
    \hbar^2 j (j+1) \ket{j,m}
    \quad( j \ge 0 )
\\
    \hat{L}_3 \ket{j,m}
    &=
    \hbar m \ket{j,m}
\\
    \braket{ j', m' | j, m }
    &=
    \delta_{j, j'} \delta_{m, m'}
\end{align}
\end{subequations}
を満たしているとすると、
やはり内積の正定値性と
公式
(\ref{angular momentum raising lowering into l^2 and l_3})
から
\begin{align}
    \hbar^2 j (j+1)
-
    \hbar^2 m^2
\pm \hbar^2 m
&=
    \bra{ j, m } \left(
        \hat{\bm{L}}^2
        -
        \hat{L}_3^2
        \pm \hbar
        \hat{L}_3
    \right)\ket{ j, m }
\notag\\&=
    \Big|\Big|
        \hat{L}_\mp \ket{ j, m }
    \Big|\Big|^2
\ge
    0
\label{positive definiteness of angular momentuum}
\end{align}
なる不等式が導かれる。
これが
(\ref{angular momentum creation annihilation})
により$\hbar m$を$\pm \hbar$だけ上下できる事と矛盾しないため、
調和振動子の場合
(\ref{vacuum of number operator})以下と同様の議論
\begin{enumerate}
    \item{
        $\hbar^2 j (j+1) - \hbar^2 m^2 \pm \hbar^2 m < 0$
        とする固有値$m$は、
        vector $\hat{L}_\mp \ket{ j, m }$のいずれかの
        normを負にするため存在してはいけない。
        ここで、
        \begin{align}
            \hbar^2 j (j+1) - \hbar^2 m^2 \pm \hbar^2 m = 0
        \end{align}
        の解は
        \begin{align}
            m &= \pm \sqrt{ j (j+1) + \dfrac{1}{4} }
            \pm \dfrac{1}{2}
        \notag\\&=
            \pm \left| j + \dfrac{1}{2} \right|
            \pm \dfrac{1}{2}
        \notag\\&=
            \pm \left( j + \dfrac{1}{2} \right)
            \pm \dfrac{1}{2}
        \quad\text{（複号任意、$j \ge 0$）}
        \notag\\&=
                j + 1,\ 
                j,\ 
                - j,\ 
                - j - 1\ 
        \end{align}
        なので、固有値$m$が存在するならば
        \begin{align}
        \begin{cases}
            - j \le m \le j + 1
        \\
            - j - 1 \le m \le j
        \end{cases}
        \quad&\Rightarrow\quad
        - j \le m \le j
        \label{magnetic quantum number range}
        \end{align}
        を満たさなければならないことが分かる。
    }
    \item{
        $\hbar^2 j (j+1) - \hbar^2 m^2 \pm \hbar^2 m = 0$
        を満たす固有値$m = -j, j$
        が存在するならば、
        $ \hat{L}_\mp \ket{ j, m } $（複号同順）
        のnormが$0$なので
        真空条件の類似：
        \begin{subequations}
        \begin{align}
            0 &=
            \hat{L}_- \ket{ j, - j }
        \\
            0 &=
            \hat{L}_+ \ket{ j, j }
        \end{align}
        \end{subequations}
        が成り立たねばならない。
        表現論の言葉では
        前者をhighest weight condition、
        後者をlowest weight conditionといい、
        $\ket{ j, \pm j }$をangular momentum algebraのhighest (lowest) weight stateと呼ぶ。
    }
    \item{
        $\hbar^2 j (j+1) - \hbar^2 m^2 \pm \hbar^2 m > 0$
        を与えるような固有値$m$に対し、
        $ \hat{L}_\mp \ket{ j, m } $
        はnormが非0で$0$ vectorではないので
        \begin{align}
            \hat{L}_\mp \ket{ j, m } \propto \ket{ j, m \mp 1 } \neq 0
        \end{align}
        が分かる。
        もし
        $p, q \in \mathbb{N}_{\ge0}$を用い
        $- j + p < m < - j + p + 1$または
        $j - q - 1 < m < j - q$
        を満たす固有値$m$が存在するとすると、
        \begin{subequations}
        \begin{align}
            \hat{L}_-^{p+1} \ket{ j, m }
            \propto \ket{ j, m - p - 1}
        \quad&\Rightarrow\quad
            - j - 1 < m - p - 1 < -j
        \\
            \hat{L}_+^{q+1} \ket{ j, m }
            \propto \ket{ j, m + q + 1}
        \quad&\Rightarrow\quad
            j < m + q + 1 < j + 1
        \end{align}
        \end{subequations}
        のいずれかが条件
        (\ref{magnetic quantum number range})
        に矛盾する。
        結局、固有値$m$は（存在するならば）必ず
        $p, q \in \mathbb{N}_{\ge0}$を用い
        $m = - j + p$かつ$ m = j - q$と書けなければならない。
        従って$2j = (p-m) + (m+q)
        = p+q$は非負整数であり、
        $m$は$-j$から$j$まで$1$おきの値を取る必要がある。
    }
\end{enumerate}
が成り立つ。

Fock基底を構成したのと同じ方法で
$\hat{L}_3$の全ての固有状態を規格化まで含めて
highest weight stateまたはlowest weight stateから
書き下すことが出来、
\begin{subequations}
\begin{align}
    \ket{ j, m }
    &=
    \sqrt{\dfrac{
        (j \pm m)!
    }{
        (2j)! (j \mp m)!
    }}
    \left(
        \dfrac{\hat{L}_\mp}{\hbar}
    \right)^{j \mp m}
    \ket{ j, \pm j }
\\
    \hat{L}_\pm \ket{ j, m }
    &= \hbar
    \sqrt{(j \mp m)(j \pm m + 1)}
    \ket{ j, m \pm 1 }
\\
    2j \in \mathbb{N}_{\ge0}
    &,\quad
    m = - j, - j + 1, \dots, j - 1, j
\end{align}
\end{subequations}
が得られる。
恐ろしいことに、
内積の正定値性のみから
$j$が整数または半整数でなければならない
ことが分かるのみならず、
逆に整数または半整数$j$を与えれば
$2j +1$個の固有値$m$と
対応する固有状態が全て求まってしまうのである。

この例から分かるように、ある交換関係を満たすoperatorの集合（代数（algebra）または環（ring）と呼ぶ。
両者は厳密には異なる概念だが
物理では特に区別しない事が多い）が与えられた時、
これが自然に作用するvector空間を構成する事は自明ではなく、
そのようなvector空間を代数の表現（representation）という。

\subsubsection{$n$次元角運動量の代数}

外積は$3$次元特有の演算であり、
本来$2$階の反対称tensorであったものを完全反対称tensorによって
vectorのように表したもの
(\ref{3d hodge and axial vector})
なのであった。
従って角運動量を一般の次元で定義するためには、$2$階の反対称tensorを用いる必要がある。

\subsection{角運動量の固有状態と球面調和関数}

角運動量operator
(\ref{angular momentum definition})
を位置表示すると、一般論
(\ref{position representation of operators})
より
\begin{align}
    L_i
=
    \epsilon_{ijk}
    x_j \left(
        - i \hbar \dfrac{\partial}{\partial x_k}
    \right)
=
    - i \hbar\ 
    \epsilon_{ijk}\ 
    x_j\ \partial_k
\end{align}
となる。
角運動量の大きさ
(\ref{the square of the magnitude of the orbital angular momentum})
は
完全反対称tensorの性質
(\ref{3rd order epsilon to delta2 formula})
を使うと
（微分が$L^2$の後に来るであろう
波動関数にも作用するため、
積の微分法を使わなければならない事、
及び
$\displaystyle
\delta_{kk} = \sum_{k = 1}^3 1
= 3$
に気を付けて）
\begin{align}
    L^2
    &= L_i L_i
=
    (- i \hbar\ 
    \epsilon_{ijk}\ 
    x_j\ \partial_k)
    (- i \hbar\ 
    \epsilon_{inm}\ 
    x_n\ \partial_m)
=
    - \hbar^2
    \epsilon_{ijk}
    \epsilon_{inm}
    x_j \partial_k
    (x_n \partial_m)
\notag\\&
=
    - \hbar^2
    (\delta_{jn} \delta_{km}
    - \delta_{jm} \delta_{kn})
    x_j \partial_k
    (x_n \partial_m)
=
    - \hbar^2
    [
        x_j \partial_k
        (x_j \partial_k)
    -
        x_j \partial_k
        (x_k \partial_j)
    ]
\notag\\&
=
    - \hbar^2
    [
        x_j
        (
            \delta_{jk} \partial_k
        +
            x_j \partial_k \partial_k
        )
    -
        x_j
        (
            \delta_{kk} \partial_j
        +
            x_k \partial_j \partial_k
        )
    ]
\notag\\&
=
    - \hbar^2
    [
        \bm{x} \cdot \nabla
    +
        \bm{x}^2
        \Delta
    -
        3 \bm{x} \cdot \nabla
    -
        x_j (x_k \partial_k) \partial_j
    ]
\notag\\&
=
    - \hbar^2
    [
        \bm{x}^2
        \Delta
    -
        2 \bm{x} \cdot \nabla
    -
        \{
            x_j \partial_j
            (x_k \partial_k)
        -
            x_j \delta_{jk} \partial_k
        \}
    ]
\notag\\&
=
    - \hbar^2
    [
        \bm{x}^2
        \Delta
    -
        \bm{x} \cdot \nabla
    -
        (\bm{x} \cdot \nabla)^2
    ]
\end{align}
となるが、$3$次元極座標では
$r = \sqrt{x^2 + y^2 + z^2},
\theta = \arctan
\dfrac{\sqrt{x^2 + y^2}}{z},
\phi = \arctan \dfrac{x}{y}
$
であるため
\begin{align}
&
    \bm{x} \cdot \nabla
=
    x_i
    \dfrac{\partial \phi_j}
        {\partial x_i}
    \dfrac{\partial}{\partial \phi_j}
=
    x_i
    \left[
        \dfrac{\partial r}
            {\partial x_i}
        \dfrac{\partial}{\partial r}
    +
        \dfrac{\partial \theta}
            {\partial x_i}
        \dfrac{\partial}{\partial \theta}
    +
        \dfrac{\partial \phi}
            {\partial x_i}
        \dfrac{\partial}{\partial \phi}
    \right]
\notag\\&
=
    \left[
        r \cos \theta
        \dfrac{r \cos \theta}{r}
    +
        r \sin \theta \cos \phi
        \dfrac{r \sin \theta \cos \phi}{r}
    +
        r \sin \theta \sin \phi
        \dfrac{r \sin \theta \sin \phi}{r}
    \right]
    \dfrac{\partial}{\partial r}
\notag\\&\qquad
    +
    \left[
        r \cos \theta
        \dfrac{
            - \dfrac{
                \sqrt{x^2 + y^2}
            }{z^2}
        }{
            1 + \dfrac{x^2 + y^2}{z^2}
        }
    +
        r \sin \theta \cos \phi
        \dfrac{
            \dfrac{ y }{z \sqrt{x^2 + y^2}}
        }{
            1 + \dfrac{x^2 + y^2}{z^2}
        }
    +
        r \sin \theta \sin \phi
        \dfrac{
            \dfrac{ x }{z \sqrt{x^2 + y^2}}
        }{
            1 + \dfrac{x^2 + y^2}{z^2}
        }
    \right]
    \dfrac{\partial}{\partial \theta}
\notag\\&\qquad
    +
    \left[
        r \cos \theta
        \cdot 0
    +
        r \sin \theta \cos \phi
        \dfrac{
            - \dfrac{ x }{y^2}
        }{
            1 + \dfrac{x^2}{y^2}
        }
    +
        r \sin \theta \sin \phi
        \dfrac{
            \dfrac{ 1 }{y}
        }{
            1 + \dfrac{x^2}{y^2}
        }
    \right]
    \dfrac{\partial}{\partial \phi}
\notag\\&
=
    \dfrac{ r^2 }{ r }
    \dfrac{\partial}{\partial r}
    +
    \left[
        r \cos \theta
        \dfrac{
            - r \sin \theta
        }{ r^2 }
    +
        r \sin \theta \cos \phi
        \dfrac{\left(
            \dfrac{
                r \sin \theta
                \cos \phi\ 
                r \cos \theta
            }{
                r \sin \theta
            }
        \right)}{ r^2 }
    +
        r \sin \theta \sin \phi
        \dfrac{\left(
            \dfrac{
                r \sin \theta
                \sin \phi\ 
                r \cos \theta
            }{r \sin \theta}
        \right)}{ r^2 }
    \right]
    \dfrac{\partial}{\partial \theta}
\notag\\&\qquad
    +
    \left[
        r \sin \theta \cos \phi
        \dfrac{
            - r \sin \theta
            \sin \phi
        }{ r^2 \sin^2 \theta }
    +
        r \sin \theta \sin \phi
        \dfrac{
            r \sin \theta
            \cos \phi
        }{
            r^2 \sin^2 \theta
        }
    \right]
    \dfrac{\partial}{\partial \phi}
\notag\\&
=
    r
    \dfrac{\partial}{\partial r}
    +
    \left[
        - \cos \theta
        \sin \theta
    +
        \cos \phi\ 
            \sin \theta \cos \phi\ 
            \cos \theta
    +
        \sin \phi\ 
            \sin \theta \sin \phi\ 
            \cos \theta
    \right]
    \dfrac{\partial}{\partial \theta}
% \notag\\&\qquad
    +
    \left[
        - \cos \phi
        \sin \phi
    +
        \sin \phi
        \cos \phi
    \right]
    \dfrac{\partial}{\partial \phi}
\notag\\&
=
    r \dfrac{\partial}{\partial r}
\end{align}
が成り立つ。
従って角運動量operatorとLaplacianの間に
\begin{align}
    - \dfrac{L^2}{\hbar^2}
&=
    r^2 \Delta
    -
        r \dfrac{\partial}{\partial r}
    -
        \left(
            r \dfrac{\partial}{\partial r}
        \right)^2
=
    r^2 \Delta
    -
        2 r
        \dfrac{\partial}{\partial r}
    -
        r^2
        \dfrac{\partial^2}{\partial r^2}
\notag\\\therefore
\quad
    \Delta
&=
    \dfrac{\partial^2}{\partial r^2}
    +
    \dfrac{2}{r}
    \dfrac{\partial}{\partial r}
    +
    \dfrac{1}{r^2}
    \left(
        -
        \dfrac{\bm{L}}{i \hbar}
    \right)^2
\end{align}
の関係があり、
$\bm{x}$-表示の
角運動量の大きさoperator
$\bm{L}^2$は
球Laplacian $\Delta_{S^2}$
(\ref{spherical Laplacian})
に他ならないこと
\begin{align}
    \Delta_{S^2}
=
    \left(
        -
        \dfrac{\bm{L}}{i \hbar}
    \right)^2
=
    \epsilon_{ijk}
    x_j \partial_k
    (\epsilon_{inm}
    x_n \partial_m)
\end{align}
が分かる。

\subsection{Operatorの代数とその表現}

調和振動子(\ref{positive definiteness of number operator})や
角運動量(\ref{positive definiteness of angular momentuum})の
例からも分かることだが、
\begin{enumerate}
    \item operatorの集合があって特定の交換関係を満たすこと
    \item それらのoperatorの、
        正定置なvector spaceへの作用が定まっていること
\end{enumerate}
の2つは全く異なり、
交換関係を満たしながらvector spaceに作用する為には
vector spaceが様々な条件
（非整数固有値に対応する固有vectorがないなど）を満たす必要がある。
実際にそのような条件を満たすvector spaceを見付け、
そのvector space上でのoperatorの作用を定める事を、
『operator algeraの表現を構成する』と言う。
以下ではもう少し数学的な定義からこれを見てみよう。

\subsubsection{環（ring）と代数（algebra）}

集合
